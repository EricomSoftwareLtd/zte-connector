const a0_0xcf5bbe=a0_0x5861;(function(_0x5cc345,_0x3c7421){const _0x29269b=a0_0x5861,_0x32e122=_0x5cc345();while(!![]){try{const _0x5e5cd9=-parseInt(_0x29269b(0x1f8))/0x1*(parseInt(_0x29269b(0x185))/0x2)+parseInt(_0x29269b(0xc6))/0x3+parseInt(_0x29269b(0x1de))/0x4+parseInt(_0x29269b(0x23b))/0x5*(parseInt(_0x29269b(0x1fd))/0x6)+parseInt(_0x29269b(0x240))/0x7+parseInt(_0x29269b(0x243))/0x8+-parseInt(_0x29269b(0xdd))/0x9;if(_0x5e5cd9===_0x3c7421)break;else _0x32e122['push'](_0x32e122['shift']());}catch(_0x2d22cf){_0x32e122['push'](_0x32e122['shift']());}}}(a0_0x43c5,0xb722f));const CLIENT_VERSION=a0_0xcf5bbe(0xed),CLIENT_PLATFORM=a0_0xcf5bbe(0x228);import a0_0x192e53 from'util';import a0_0x25ac65 from'child_process';function a0_0x43c5(){const _0x1a3152=['\x20>\x20','promisify','keepAlive','17911152rYMnqH','systemctl\x20daemon-reload','reconnecting\x20...','stdout','setPacFile','contains','Saved\x20','systemVersion','healthCheckPath','*****\x20Using\x20hardwired\x20command\x20line\x20*****','sudo\x20wg\x20show\x20ztedge\x20dump','Import\x20a\x20configuration\x20file\x20generated\x20by\x20the\x20provisioning\x20portal.\x20Authentication\x20is\x20done\x20during\x20import.\x0a','https://','utf8','upgrade','SIGTERM','4.0.10','Error\x20launching\x20external\x20browser:\x20','writeHead','#\x20systemInfo\x20=\x20','Unable\x20to\x20set\x20PAC\x20file:\x20','caCertificates','code','Cannot\x20resolve\x20','----\x20POST\x20','inform','Process\x20upgrade\x20isService=','.zerotrustedge.com:8444/api/client/getlogininformation','statusMessage','Connector\x20started','cannot\x20generate\x20keypair','monitorPid','You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20If\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a','No\x20saved\x20profiles','env','AllowedIps\x20=\x20','tenant','mkdir','Show\x20the\x20current\x20tunnel\x20status','Tunnel\x20started','import\x20<file>\x20[<user>]','sudo\x20iptables\x20-D\x20POSTROUTING\x20-t\x20nat\x20-o\x20','user','homedir','authenticationToken','Tunnel\x20not\x20launched','platform','cloud','--ca-certificates\x20<certs>','hostname','.zerotrustedge.com:8444/api/v1/ztedge/client/${api}/','Tunnel\x20did\x20not\x20start.\x20\x20Install\x20openresolv\x20with\x20\x27sudo\x20apt\x20install\x20openresolv\x27','Password\x20for\x20','qa-zteapi.ericomcloud.net','Tunnel\x20is\x20not\x20active','Invalid\x20username\x20or\x20password','Create\x20a\x20service\x20named\x20\x22ztedge\x22\x20which\x20will\x20control\x20the\x20specified\x20connection.\x0a','writeFile','To\x20be\x20used\x20as\x20a\x20cloud-native\x20connector','Run\x20connection\x20in\x20the\x20background','finish','/api/v1/ztedge/client/${api}/','getClientSettingsFrequencySec','connector','map','authenticationInfo','--ignoreCertificateErrors','Use\x20MASQUERADE\x20to\x20','sendGatewayIp','Exiting\x20ztedge-client','Will\x20match\x20an\x20existing\x20profile\x20based\x20on\x20the\x20supplied\x20<cloudId>\x20and\x20<user>.\x0a','Starting\x20service\x20.','defaultInterface','Tunnel\x20not\x20functioning\x20properly.\x20No\x20handshake.\x20\x20Perhaps\x20a\x20connectivity\x20problem\x20to\x20the\x20POP','Stopping\x20tunnel','ZTE_UPGRADE_FILE','hide','how\x20long\x20the\x20connection\x20should\x20be\x20down\x20(sec)\x20for\x20health\x20check\x20failure','Address\x20=\x20','push','join','Authorization\x20failed\x20(unknown\x20reason)','Got\x20http\x20response\x20','Requires\x20ztedge\x20server\x20version\x20>=\x203.5','sudo\x20resolvconf\x20-d\x20ztedge','\x20seconds\x20...\x20','headers','browser','floor','/clientLogout','healthCheckTimeout','\x20--device-name\x20','3.5.0','location','now','Stop\x20the\x20currently\x20running\x20tunnel\x0a','force','session_state','Did\x20not\x20receive\x20authentication\x20information','sleepTill','Aborting\x20ztedge-client','do\x20not\x20enable\x20and\x20start\x20the\x20service','message','gatewayDns','allowExcessArguments','----\x20GET\x20','status','startsWith','string','serverPublicKey','ip\x20route\x20show\x20default','public','dirname','createService','post','statusCode','authentication\x20redirect\x20error:\x20','--device-name\x20<name>','SHORT_TIMES','resolvconf:\x20command\x20not\x20found','health\x20check\x20path','private','installerCommandLine','question','/health','parse','Would\x20you\x20like\x20to\x20upgrade\x20now\x20(y/n)\x20?\x20','incoming\x20UDP\x20port','userMessage','authenticationURL','launchFromToken','connectionAllowed','\x20up\x20\x22','cloud-native','readFile','ListenPort\x20=\x20','Shutdown\x20connector\x20routing','clientSettings','product','debug','\x20not\x20found.','Endpoint\x20=\x20','::/0','pid','replace','ztedge-client','ztedge','split','dev-zteapi.ericomcloud.net','toString','gsettings\x20get\x20org.gnome.system.proxy\x20mode','${api}','ignore\x20certificate\x20errors','/tmp/zte-upgrade.log','username\x20is\x20required\x20for\x20a\x20pre-3.5\x20server\x20and/or\x20if\x20a\x20password\x20is\x20required\x20to\x20authenticate','-\x20\x20create\x20a\x20profile\x20with\x20\x22sudo\x20ztedge-client\x20new\x20tenant\x20user\x20[--connector]\x20--authenticate-only\x20...\x22\x0a','dnsServers','staging-zteapi.ericomcloud.net','authenticateOnly','findSpanningList','0600','--password\x20<password>','ztedge-client\x20launchFromToken\x20\x22','{installPackage}','<h1>Authentication\x20Succeeded</h1>','[Interface]\x0a','log','cannot\x20parse\x20version\x20','152428enEOCh','background','Can\x20only\x20read\x20password\x20from\x20a\x20TTY','authenticated','fileURLToPath','\x20failed:\x20','\x22\x20\x22','Tunnel\x20not\x20functioning\x20properly','mode','text/html;\x20charset=UTF-8','Request\x20PID\x20','launch','listening','Authenticated\x20and\x20authorized','down','.zerotrustedge.com:8444/api/v1/ztedge/client/SystemVersionAndTenantFeatures/','systemctl\x20status\x20ztedge','Reconnect\x20failed:\x20','gsettings\x20get\x20org.gnome.system.proxy\x20autoconfig-url','Proxy\x20restored\x20to\x20','verbose','DNS\x20=\x20','data','Error:\x20','[\x20short\x20times\x20]','match','access','version','Unable\x20to\x20connect\x20to\x20IAM\x20server\x20','\x20--ca-certificates\x20\x22','spawnSync','description','.zerotrustedge.com:8444/api/client/authenticated','Tunnel\x20did\x20not\x20start:\x0a','/usr/local/share/ca-certificates','new\x20<cloudId>\x20<user>','find','action','password','?version=','Replace\x20existing\x20profile','wireguard/linux-client','ZTEdge\x20tunnel\x20is\x20currently\x20active','getLoginInformationUrl','commands','all','/api/v1/ztedge/client/getlogininformation/','postureChecks','wg\x20genkey','clientPing','addCAs','userName','service','query','deviceName','doNewApiLaunchTunnel\x20wg-quick\x20result','Enable\x20routing','systemctl\x20enable\x20ztedge','Error\x20talking\x20to\x20gateway:\x20','publicKey','(.*)','listen','endsWith','webAuthenticate','---\x20system\x20info\x20----','padStart','(.*)[.]conf','zteapi.ericomcloud.net','deviceInfo','get','Peer\x20creation\x20failed:\x20','Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20is\x20needed\x20and\x20was\x20not\x20specified.','--pingIntervalSec\x20<num>','ErrorWithoutStacktrace','PublicKey\x20=\x20','start','Exiting\x20because\x20this\x20software\x20version\x20cannot\x20be\x20used.','AuthenticateDevice','tunnel','\x20-j\x20MASQUERADE','Waiting\x20for\x20tunnel\x20to\x20start\x20...','Connected\x20to:\x20','oldMode','No\x20matching\x20profiles','sleepMs','\x5c$&','\x20--debug','echo\x201\x20|\x20sudo\x20tee\x20/proc/sys/net/ipv4/ip_forward','exitCode','2271528Mfbllx','/opt/google/chrome/chrome\x20--incognito\x20\x22','trim','Upgrade\x20log\x20will\x20be\x20in\x20','--authenticateOnly|--authenticate-only','Service\x20creation\x20error:\x20','send','-d|--debug','Error\x20configuring\x20connector:\x20','&redirect_uri=','exit','max','Authentication\x20failed:\x20','\x20--service','Did\x20not\x20get\x20expected\x20status.\x20\x20Received\x20','waitFor','readdir','downloadProgress','Proxy\x20mode\x20restored\x20to\x20','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a\x20\x20<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22utf-8\x22>\x0a\x20\x20\x20\x20<title>ZTEdge</title>\x0a\x20\x20</head>\x0a\x20\x20<body>\x0a\x20\x20\x20\x20$body$\x0a</html>','supportsClientPing','sudo\x20ip\x20link\x20delete\x20dev\x20','Invalid\x20credentials','Password\x20can\x20only\x20be\x20read\x20from\x20a\x20tty','Created\x20','assign','7HHzRTr','-v|--verbose','auto','DEFAULT_CLOUD_NATIVE','Only\x20one\x20such\x20service\x20can\x20be\x20in\x20effect.\x20\x20This\x20will\x20not\x20have\x20access\x20to\x20profiles\x20create\x20w/o\x20sudo.\x0a','940854DqAgBt','Using\x20profile:\x20','pacFile','#\x20deviceInfo\x20=\x20','body','padEnd','state','none','$body$','keepAliveFrequencySec','Downloading\x20update\x20package.','[Service]\x0a','Tunnel\x20is\x20functioning\x20properly','includes','sudo\x20bash\x20\x22{installPackage}\x22','monitor','IP:\x20','userId','length','gatewayServicesUrl','assignedIpAddress','serverEndpoint','privateKey','--connector','CLOUD_NATIVE','health\x20check\x20port\x20(0\x20for\x20none)','release','set-cookie','Upgrade\x20by\x20running\x20the\x20command:\x20','ztedge\x20service\x20created,\x20but\x20not\x20started\x20or\x20enabled','healthCheckPort','Unable\x20to\x20enable\x20ztedge\x20service:\x20','listenPort','\x20to\x20shutdown','Cannot\x20contact\x20tenant.\x20','write','stderr','kill','-b|--background','upgradeOnlyIfNotUsable','devicePrivateKey','stringify','\x20--verbose','linux','--browser','json','device\x20name','systemctl\x20start\x20ztedge','currentVersionCanConnect','You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20if\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a','Restart=on-failure\x0a','Send\x20shutdown\x20again\x20to\x20force\x20immediate\x20shutdown','Connected\x20as:\x20','/auth_resp','restorePac','ZTEDGE','username\x20must\x20be\x20specified','GetPreLaunchInfo','argv','cannot\x20determine\x20default\x20device','\x20----','PrivateKey\x20=\x20','40YVtQxy','deviceType','PersistentKeepalive\x20=\x205\x0a','WantedBy=multi-user.target\x0a','0.0.0.0/0','253568XbVBDg','url','\x20=>\x20','6920864JOnkaK','.conf','any','Logging\x20to\x20','--listen-port\x20<port>','unlink','import','PAC\x20file\x20set:\x20','rm\x20-f\x20','Will\x20try\x20to\x20reconnect\x20in\x20','Comma\x20separated\x20list\x20of\x20folders\x20and\x20files\x20containing\x20additional\x20CA\x20certificates.','pubkey','Show\x20debug\x20output','sensible-browser\x20\x22','createServer','RestartSec=15s\x0a','Logout\x20failed:\x20','pipe','-gateway.zerotrustedge.com','How\x20often\x20to\x20ping\x20the\x20gateway','read\x20from\x20the\x20root\x20user\x27s\x20profile\x20folder','--no-launch','name','end','new','path','filter','Running\x20as\x20a\x20service','Server\x20told\x20us\x20to\x20shutdown\x20connection:\x20','[Peer]\x0a','upgrade\x20if\x20available','resolve','option','authenticationType','ignoreCertificateErrors','proxySettings','command','stdin','lsb_release\x20-d\x20-s','1650201AQCOQC','min','ExecStart=','Cannot\x20contact\x20tenant\x20','--no-start','_name','--health-check-port\x20<port>','stream','Unable\x20to\x20restore\x20system\x20proxy:\x20','newApiTemplate','error','------------------------','Description=ZTEdge\x0a','extname','/32','gsettings\x20set\x20org.gnome.system.proxy\x20autoconfig-url\x20\x27','ericomshield.crt','--service','parseAsync','\x20already\x20exists.\x20\x20Use\x20--force\x20to\x20replace\x20it.'];a0_0x43c5=function(){return _0x1a3152;};return a0_0x43c5();}import a0_0x42c640 from'path';import a0_0x3f4f39 from'http';import a0_0x42d965 from'os';import{promises as a0_0x15b5da}from'dns';import{promises as a0_0x1b3cea,createWriteStream}from'fs';import a0_0x3d6c48 from'url';import a0_0x3e85fe from'readline-sync';import a0_0x18ad4c from'got';import a0_0x746341 from'find-free-port';import a0_0xc6bc2b from'password-prompt';import a0_0x4e586d from'temp';import a0_0x40e05b from'is-elevated';import*as a0_0xa14d98 from'commander';import*as a0_0xe14e50 from'syswide-cas';import*as a0_0x4adde2 from'cidr-tools';import a0_0x149f23 from'express';import*as a0_0x27b860 from'./utils.js';const __dirname=a0_0x42c640[a0_0xcf5bbe(0x14d)](a0_0x3d6c48[a0_0xcf5bbe(0x189)](import.meta[a0_0xcf5bbe(0x241)])),exec=a0_0x192e53[a0_0xcf5bbe(0xdb)](a0_0x25ac65['exec']),DEFAULT_CA_FOLDER=a0_0xcf5bbe(0x1a7),deviceFolder=a0_0x42c640[a0_0xcf5bbe(0x12d)](a0_0x42d965[a0_0xcf5bbe(0x108)](),'.ztedge'),TUNNEL_INTERFACE_NAME=a0_0xcf5bbe(0x16f),runningConfigFile=a0_0x42c640[a0_0xcf5bbe(0x12d)](a0_0x42d965['tmpdir'](),TUNNEL_INTERFACE_NAME+'.conf'),sep='---',SHIELD_CA_CERTIFICATES=[a0_0x42c640[a0_0xcf5bbe(0x12d)](__dirname,a0_0xcf5bbe(0xd6))],PRODUCT={'ZTEDGE':'ztedge','CLOUD_NATIVE':a0_0xcf5bbe(0x162)},CLOUD_NATIVE_HOSTS={'dev':a0_0xcf5bbe(0x171),'qa':a0_0xcf5bbe(0x112),'staging':a0_0xcf5bbe(0x17a),'cloud':a0_0xcf5bbe(0x1c8)};let REDIRECT_URL,REDIRECT_PORT,shutdownInProgress=0x0,DEFAULT_CLOUD_NATIVE=process['env'][a0_0xcf5bbe(0x1fb)]??a0_0xcf5bbe(0x10c);async function webGet(_0x2d770c,_0x28e6e6,_0x2d04ae){const _0x31e7b3=a0_0xcf5bbe;debugLog(_0x2d04ae,_0x31e7b3(0x146)+_0x2d770c+_0x31e7b3(0x239));try{let _0x4582b8=await a0_0x18ad4c(_0x2d770c,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x31e7b3(0x22a),'https':{'rejectUnauthorized':_0x28e6e6},'timeout':{'request':0x1e*0x3e8}});return debugLog(_0x2d04ae,_0x4582b8[_0x31e7b3(0x201)]),debugLog(_0x2d04ae,_0x31e7b3(0xd1)),_0x4582b8[_0x31e7b3(0x201)];}catch(_0x1b3845){debugLog(_0x2d04ae,_0x31e7b3(0x19c)+_0x1b3845['message']),debugLog(_0x2d04ae,_0x31e7b3(0xd1));throw _0x1b3845;}}function a0_0x5861(_0x32deee,_0x1bc244){const _0x43c553=a0_0x43c5();return a0_0x5861=function(_0x5861d3,_0x53b139){_0x5861d3=_0x5861d3-0xba;let _0x2f3788=_0x43c553[_0x5861d3];return _0x2f3788;},a0_0x5861(_0x32deee,_0x1bc244);}async function isValidZteTenant(_0x4785f6,_0x1154b2){const _0x4ffc02=a0_0xcf5bbe;try{let _0x354127=_0x4ffc02(0xe9)+_0x4785f6+_0x4ffc02(0x194)+_0x4785f6+_0x4ffc02(0x1ac)+CLIENT_VERSION+'&platform='+CLIENT_PLATFORM,_0x1d8b0a=await webGet(_0x354127,!_0x1154b2[_0x4ffc02(0xc1)],_0x1154b2);return _0x1d8b0a;}catch(_0x335c64){return null;}}async function isValidCloudNativeTenant(_0x83e47a,_0x5739ba,_0x492c94){const _0x391a1c=a0_0xcf5bbe;let _0xc0dba=CLOUD_NATIVE_HOSTS[_0x5739ba]??_0x5739ba;try{let _0x4b679d='https://'+_0xc0dba+'/api/v1/ztedge/client/SystemVersionAndTenantFeatures/'+_0x83e47a+_0x391a1c(0x1ac)+CLIENT_VERSION+'&platform='+CLIENT_PLATFORM,_0x4ef07f=await webGet(_0x4b679d,!_0x492c94['ignoreCertificateErrors'],_0x492c94);return _0x4ef07f;}catch(_0x6e8c06){return null;}}async function adjustTenantName(_0x4311dc,_0x239a9c){const _0x1eedc8=a0_0xcf5bbe;let _0x4b8150=_0x4311dc['match'](/(.*)@(.*)/);if(_0x4b8150){let _0x4e8f75=await isValidCloudNativeTenant(_0x4b8150[0x1],_0x4b8150[0x2],_0x239a9c);if(_0x4e8f75)return{'tenant':_0x4b8150[0x1],'cloudNative':_0x4b8150[0x2],'systemInfo':_0x4e8f75};}else{let _0x37c5cd=await isValidZteTenant(_0x4311dc,_0x239a9c);if(_0x37c5cd)return{'tenant':_0x4311dc,'cloudNative':null,'systemInfo':_0x37c5cd};let _0x3ec4d1=await isValidCloudNativeTenant(_0x4311dc,DEFAULT_CLOUD_NATIVE,_0x239a9c);if(_0x3ec4d1)return{'tenant':_0x4311dc,'cloudNative':DEFAULT_CLOUD_NATIVE,'systemInfo':_0x3ec4d1};}throw new ErrorWithoutStacktrace(_0x1eedc8(0xc9)+_0x4311dc+'.\x20\x20Perhaps\x20there\x20is\x20a\x20certificate\x20issue.');}async function getCloudData(_0x398ccd,_0x5d6e8e){const _0x24f8c4=a0_0xcf5bbe;let {tenant:_0x1e5b84,cloudNative:_0x1562f0,systemInfo:_0x5619bd}=await adjustTenantName(_0x398ccd,_0x5d6e8e),_0x264afe;if(_0x1562f0){let _0x44ad3e=CLOUD_NATIVE_HOSTS[_0x1562f0]??_0x1562f0;_0x264afe={'tenant':_0x1e5b84,'getLoginInformationUrl':_0x24f8c4(0xe9)+_0x44ad3e+_0x24f8c4(0x1b3)+_0x1e5b84,'authenticatedUrl':'https://'+_0x44ad3e+'/api/v1/ztedge/client/authenticated/'+_0x1e5b84,'gwName':null,'newApiTemplate':_0x24f8c4(0xe9)+_0x44ad3e+_0x24f8c4(0x11a)+_0x1e5b84};}else _0x264afe={'tenant':_0x1e5b84,'getLoginInformationUrl':_0x24f8c4(0xe9)+_0x1e5b84+_0x24f8c4(0xf8),'authenticatedUrl':_0x24f8c4(0xe9)+_0x1e5b84+_0x24f8c4(0x1a5),'gwName':_0x1e5b84+_0x24f8c4(0x255),'newApiTemplate':_0x24f8c4(0xe9)+_0x1e5b84+_0x24f8c4(0x10f)+_0x1e5b84};return{'cloudData':_0x264afe,'systemInfo':_0x5619bd};}class ErrorWithoutStacktrace extends Error{constructor(_0x2000a4){const _0x3c9614=a0_0xcf5bbe;super(_0x2000a4),this[_0x3c9614(0x259)]=_0x3c9614(0x1ce);}}async function callZteApi(_0x1b5f9c,_0x97a2b7,_0x24054d,_0x380879){const _0x3f35ff=a0_0xcf5bbe;let _0x1fd19f;_0x1b5f9c=_0x24054d[_0x3f35ff(0xcf)][_0x3f35ff(0x16d)](_0x3f35ff(0x174),_0x1b5f9c);try{debugLog(_0x380879,_0x3f35ff(0xf5)+_0x1b5f9c+_0x3f35ff(0x239)),debugLog(_0x380879,_0x97a2b7),_0x1fd19f=await a0_0x18ad4c[_0x3f35ff(0x14f)](_0x1b5f9c,{'json':_0x97a2b7,'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x3f35ff(0x22a),'https':{'rejectUnauthorized':!_0x24054d[_0x3f35ff(0xc1)]},'timeout':{'request':0x1e*0x3e8}}),debugLog(_0x380879,_0x1fd19f[_0x3f35ff(0x201)]),debugLog(_0x380879,_0x3f35ff(0xd1));}catch(_0xe18362){debugLog(_0x380879,_0xe18362[_0x3f35ff(0x143)]),debugLog(_0x380879,_0x3f35ff(0xd1));throw new ErrorWithoutStacktrace(_0x3f35ff(0x21f)+_0xe18362[_0x3f35ff(0x143)]);}if(_0x1fd19f[_0x3f35ff(0x150)]!==0xc8)throw new ErrorWithoutStacktrace(_0x3f35ff(0x12f)+_0x1fd19f[_0x3f35ff(0x150)]+':\x20'+_0x1fd19f['statusMessage']);return _0x1fd19f[_0x3f35ff(0x201)];}async function readPassword(_0xf839e9,_0x2ee674=a0_0xcf5bbe(0x129)){const _0x45b0a5=a0_0xcf5bbe;if(process['stdin']['isTTY'])return await a0_0xc6bc2b(_0xf839e9,{'method':_0x2ee674});else throw new ErrorWithoutStacktrace(_0x45b0a5(0x1f5));}function canonicalizeVersionString(_0x55dbe8,_0x3bca48){const _0x35cd5c=a0_0xcf5bbe;let _0x3772b5=_0x55dbe8['match'](/(\d+)[.](\d+)(?:[.](\d+))?/);if(_0x3772b5){const [,_0x58c641,_0x553941,_0x2817fd]=_0x3772b5;return _0x58c641[_0x35cd5c(0x1c6)](0x4,'0')+_0x553941[_0x35cd5c(0x1c6)](0x4,'0')+(_0x2817fd??'0')['padStart'](0x4,'0');}else return _0x3bca48&&newError('error',_0x35cd5c(0x184)+_0x55dbe8),null;}function versionLTE(_0x196901,_0x3a0ae9){let _0x2da5d0=canonicalizeVersionString(_0x196901,!![]),_0x5e408e=canonicalizeVersionString(_0x3a0ae9,!![]);return _0x2da5d0<=_0x5e408e;}function versionLT(_0x397b46,_0x5eec91){let _0x17407c=canonicalizeVersionString(_0x397b46,!![]),_0x2f2902=canonicalizeVersionString(_0x5eec91,!![]);return _0x17407c<_0x2f2902;}function versionGTE(_0x49e22b,_0x14a053){let _0x1a6c4c=canonicalizeVersionString(_0x49e22b,!![]),_0xcc8d05=canonicalizeVersionString(_0x14a053,!![]);return _0x1a6c4c>=_0xcc8d05;}const PAGE_FRAME=a0_0xcf5bbe(0x1f1);function startHttpListener(_0x3b0dab,_0xc469fc){const _0x3cfd75=a0_0xcf5bbe;let _0x43a09c=a0_0x3f4f39[_0x3cfd75(0x251)](function(_0x2f343a,_0x20039c){const _0x292473=_0x3cfd75;let _0x4d3929='';_0x2f343a['on'](_0x292473(0x19b),_0x5acd42=>{_0x4d3929+=_0x5acd42;}),_0x2f343a['on'](_0x292473(0x25a),()=>{const _0x7eb667=_0x292473;let _0x3c7248=_0xc469fc(_0x2f343a[_0x7eb667(0x241)],_0x4d3929);_0x4d3929='',_0x20039c[_0x7eb667(0xef)](0xc8,{'Content-Type':_0x7eb667(0x18e)});let _0x4b9655=PAGE_FRAME['replace'](_0x7eb667(0x205),_0x3c7248);_0x20039c[_0x7eb667(0x25a)](_0x4b9655);});});return _0x43a09c['listen'](_0x3b0dab),_0x43a09c;}async function handleBrowser(_0x58d603,_0x56be73,_0x43801e,_0xa26e3d,_0x23cf50){const _0x4d374b=a0_0xcf5bbe;let _0x6483a5;const _0x5344ba=new Promise((_0x57a5e,_0x4a1b0e)=>{let _0x23aa82=startHttpListener(REDIRECT_PORT,(_0x20cf52,_0x2b672c)=>{const _0x2f2ec5=a0_0x5861;return _0x6483a5=a0_0x3d6c48[_0x2f2ec5(0x15a)](_0x20cf52,!![])[_0x2f2ec5(0x1ba)],(!_0x6483a5[_0x2f2ec5(0x203)]||!_0x6483a5[_0x2f2ec5(0xf3)]||!_0x6483a5[_0x2f2ec5(0x13e)])&&(_0x6483a5=null),_0x57a5e(),_0x6483a5?_0x2f2ec5(0x181):'<h1>Authentication\x20Failed</h1>';});});let _0x5d24a7=_0x56be73+('&redirect_uri='+REDIRECT_URL);if(![]&&await fileExists('/opt/google/chrome/chrome'))exec(_0x4d374b(0x1df)+_0x5d24a7+'\x22');else{if(Promise['any']){let _0xb98c2b,_0x3d1031=0x3e8;try{_0xb98c2b=await Promise[_0x4d374b(0x245)]([execNoThrow(_0x4d374b(0x250)+_0x5d24a7+'\x22'),a0_0x27b860[_0x4d374b(0x1d9)](_0x3d1031)]);}catch(_0x41d50a){throw new ErrorWithoutStacktrace(_0x4d374b(0xee)+_0x41d50a[_0x4d374b(0x143)]);}if(_0xb98c2b!==_0x3d1031&&_0xb98c2b['code']!==0x0){let _0x67d6bc=_0xb98c2b[_0x4d374b(0xe0)][_0x4d374b(0x1e0)]();_0x67d6bc&&(_0x67d6bc+='\x0a');_0x67d6bc+=_0xb98c2b[_0x4d374b(0x221)][_0x4d374b(0x1e0)]();throw new ErrorWithoutStacktrace(_0x4d374b(0xee)+_0x67d6bc);}}else execNoThrow('sensible-browser\x20\x22'+_0x5d24a7+'\x22');}await _0x5344ba;if(!_0x6483a5)throw new ErrorWithoutStacktrace('Authorization\x20failed\x20(unknown\x20reason)');return _0x6483a5;}async function handleUserPassword(_0x52b972,_0x165b7d,_0x3b9d83,_0x209cc1){const _0x5c5de2=a0_0xcf5bbe;let _0x28708b=_0x165b7d+(_0x5c5de2(0x1e7)+REDIRECT_URL),_0x412ce6;if(!_0x209cc1&&!process[_0x5c5de2(0xc4)]['isTTY'])throw new ErrorWithoutStacktrace(_0x5c5de2(0x187));try{_0x412ce6=await a0_0x18ad4c(_0x28708b,{'throwHttpErrors':![],'retry':{'limit':0x0},'https':{'rejectUnauthorized':!_0x52b972[_0x5c5de2(0xc1)]},'timeout':{'request':0xf*0x3e8}});if(_0x412ce6[_0x5c5de2(0x150)]!==0xc8)throw new ErrorWithoutStacktrace(_0x5c5de2(0x151)+_0x412ce6[_0x5c5de2(0x150)]+':\x20'+_0x412ce6['statusMessage']);!_0x209cc1&&(_0x209cc1=await readPassword(_0x5c5de2(0x111)+_0x3b9d83+':\x20'));}catch(_0x1fc47d){let _0x568f21=new URL(_0x165b7d);throw new ErrorWithoutStacktrace(_0x5c5de2(0x1a1)+_0x568f21['hostname']+':\x20'+_0x1fc47d[_0x5c5de2(0x143)]);}let _0x5442f7=_0x412ce6['body'][_0x5c5de2(0x19e)](/action="(.*?)"/),_0x1bafb6=_0x5442f7[0x1]['replace'](/&amp;/g,'&'),_0x1c3873=_0x412ce6[_0x5c5de2(0x133)][_0x5c5de2(0x218)][_0x5c5de2(0x11d)](_0xc105f4=>{const _0x2d903d=_0x5c5de2;let _0x16c2b2=_0xc105f4[_0x2d903d(0x19e)](/^(.*?)=(.*?);/);return _0x16c2b2[0x1]+'='+_0x16c2b2[0x2];})['join'](';\x20'),_0x5a8b00=await a0_0x18ad4c[_0x5c5de2(0x14f)](_0x1bafb6,{'headers':{'cookie':_0x1c3873,'content-type':'application/x-www-form-urlencoded'},'form':{'username':_0x3b9d83,'password':_0x209cc1},'throwHttpErrors':![],'retry':{'limit':0x0},'followRedirect':![],'https':{'rejectUnauthorized':!_0x52b972[_0x5c5de2(0xc1)]}});if(_0x5a8b00['statusCode']===0xc8){let _0x24124a=_0x5a8b00[_0x5c5de2(0x201)][_0x5c5de2(0x20a)](_0x5c5de2(0x114));if(_0x24124a)throw new ErrorWithoutStacktrace(_0x5c5de2(0x1f4));}else{if(_0x5a8b00['statusCode']!==0x12e)throw new ErrorWithoutStacktrace(_0x5c5de2(0x1ec)+_0x5a8b00[_0x5c5de2(0x150)]+':\x20'+_0x5a8b00[_0x5c5de2(0xf9)]);}if(!_0x5a8b00['headers'][_0x5c5de2(0x13a)])throw new ErrorWithoutStacktrace(_0x5c5de2(0x13f));let _0x4e3e61=a0_0x3d6c48[_0x5c5de2(0x15a)](_0x5a8b00[_0x5c5de2(0x133)][_0x5c5de2(0x13a)],!![])[_0x5c5de2(0x1ba)];if(!_0x4e3e61[_0x5c5de2(0x203)]||!_0x4e3e61[_0x5c5de2(0xf3)]||!_0x4e3e61['session_state'])throw new ErrorWithoutStacktrace(_0x5c5de2(0x12e));return _0x4e3e61;}async function getOs(){const _0x509de0=a0_0xcf5bbe;let _0x52ce7b=a0_0x42d965[_0x509de0(0x10b)]()+'\x20'+a0_0x42d965[_0x509de0(0x217)]();try{let _0x3df523=await exec(_0x509de0(0xc5));_0x52ce7b=_0x3df523['stdout']?.[_0x509de0(0x1e0)]()??_0x52ce7b;}catch{}return _0x52ce7b;}async function doUpgrade(_0x5088b5,_0x46530f){const _0x4ee755=a0_0xcf5bbe;try{console[_0x4ee755(0x183)](_0x4ee755(0x207));let _0x28cafb=a0_0x4e586d[_0x4ee755(0x25c)]({'suffix':a0_0x42c640[_0x4ee755(0xd3)](_0x5088b5['url'])}),_0x5c8885=createWriteStream(_0x28cafb),_0x1e7cda=a0_0x18ad4c[_0x4ee755(0xcd)](_0x5088b5[_0x4ee755(0x241)]),_0x386501=new Promise(function(_0x1f4afd,_0x416309){const _0x3cfea3=_0x4ee755;_0x1e7cda['on'](_0x3cfea3(0x1ef),({transferred:_0x2cd8ea,total:_0x42b2e1,percent:_0x3bb0bc})=>{}),_0x1e7cda['on'](_0x3cfea3(0xd0),_0x52cee9=>_0x416309(_0x52cee9)),_0x5c8885['on'](_0x3cfea3(0x119),()=>_0x1f4afd()),_0x5c8885['on'](_0x3cfea3(0xd0),_0x490035=>_0x416309(_0x490035)),_0x1e7cda[_0x3cfea3(0x254)](_0x5c8885);});await _0x386501;let _0x23f355=_0x5088b5[_0x4ee755(0x157)]?_0x5088b5[_0x4ee755(0x157)]:_0x4ee755(0x20b);_0x23f355=_0x23f355[_0x4ee755(0x16d)](_0x4ee755(0x180),_0x28cafb);if(_0x46530f['service']){let _0x381579=_0x4ee755(0x176);await fileExists(_0x381579)&&await a0_0x1b3cea[_0x4ee755(0x248)](_0x381579),console[_0x4ee755(0x183)](_0x4ee755(0x1e1)+_0x381579),a0_0x25ac65['spawnSync']('at',['now'],{'input':_0x23f355+_0x4ee755(0xda)+_0x381579}),process[_0x4ee755(0x1e8)](0x0);}else{if(process['env'][_0x4ee755(0x128)]){let _0x55e520=_0x23f355+'\x0a'+(_0x4ee755(0x24b)+_0x28cafb+'\x20'+process['env']['ZTE_UPGRADE_FILE']+'\x0a');await a0_0x1b3cea[_0x4ee755(0x116)](process['env'][_0x4ee755(0x128)],_0x55e520,'utf8'),process[_0x4ee755(0x1e8)](0x0);}else console[_0x4ee755(0x183)](_0x4ee755(0x219)+_0x23f355),process['exit'](0x0);}}catch(_0x275665){console[_0x4ee755(0xd0)]('Upgrade\x20failed:\x20'+_0x275665[_0x4ee755(0x143)]);}}let didInform=![];async function processUpgrade(_0x2fea13,_0x2ed1d1){const _0xcbca9e=a0_0xcf5bbe;debugLog(_0xcbca9e(0xf7)+_0x2ed1d1?.['service']+';\x20\x20upgradeMode='+_0x2fea13?.[_0xcbca9e(0x18d)]);if(_0x2ed1d1?.[_0xcbca9e(0x224)]&&_0x2fea13?.[_0xcbca9e(0x22d)]===!![])return;if((_0x2fea13?.[_0xcbca9e(0x18d)]??_0xcbca9e(0x204))==='none')return;else{if(!_0x2ed1d1[_0xcbca9e(0x1b9)]&&_0x2fea13[_0xcbca9e(0x18d)]===_0xcbca9e(0xf6)){if(didInform&&_0x2fea13[_0xcbca9e(0x22d)])return;didInform=!![];let _0x320e6c;if(_0x2ed1d1[_0xcbca9e(0xeb)])_0x320e6c=!![];else{console[_0xcbca9e(0x183)](_0x2fea13[_0xcbca9e(0x143)]);let _0x5e0efb=a0_0x3e85fe[_0xcbca9e(0x158)](_0xcbca9e(0x15b));_0x320e6c=_0x5e0efb==='y';}_0x320e6c&&await doUpgrade(_0x2fea13,_0x2ed1d1);}else await doUpgrade(_0x2fea13,_0x2ed1d1);}!_0x2fea13[_0xcbca9e(0x22d)]&&(console[_0xcbca9e(0x183)](_0xcbca9e(0x1d1)),process[_0xcbca9e(0x1e8)](0x1));}async function getSystemInfo(_0x256392,_0x3796b8){const _0x3d6a42=a0_0xcf5bbe;let {cloudData:_0x275797,systemInfo:_0xc6306b}=await getCloudData(_0x256392,_0x3796b8);!_0xc6306b['product']&&(_0xc6306b[_0x3d6a42(0x167)]=PRODUCT[_0x3d6a42(0x234)]);_0xc6306b[_0x3d6a42(0x167)]===PRODUCT[_0x3d6a42(0x215)]&&(_0xc6306b[_0x3d6a42(0xe4)]=_0xc6306b['systemVersion']['replace'](/^.*-/,''));Object[_0x3d6a42(0x1f7)](_0xc6306b,_0x275797);if(_0xc6306b[_0x3d6a42(0x167)]===PRODUCT[_0x3d6a42(0x215)])_0xc6306b[_0x3d6a42(0x121)]=![],_0xc6306b[_0x3d6a42(0xc1)]=_0x3796b8[_0x3d6a42(0xc1)]||![],_0xc6306b[_0x3d6a42(0x1f2)]=!![];else{if(versionLT(_0xc6306b[_0x3d6a42(0xe4)],_0x3d6a42(0x139)))throw new ErrorWithoutStacktrace(_0x3d6a42(0x130));_0xc6306b[_0x3d6a42(0x121)]=!![],_0xc6306b[_0x3d6a42(0xc1)]=_0x3796b8[_0x3d6a42(0xc1)]||versionLT(_0xc6306b[_0x3d6a42(0xe4)],_0x3d6a42(0x139)),_0xc6306b['supportsClientPing']=versionGTE(_0xc6306b[_0x3d6a42(0xe4)],'3.4.0');}_0xc6306b[_0x3d6a42(0x1b0)]=null,_0xc6306b['authenticatedUrl']=null,debugLog(_0x3796b8,_0x3d6a42(0x1c5)),debugLog(_0x3796b8,_0xc6306b);let _0x4c43bb=_0xc6306b['upgradeInfo'];return _0x4c43bb&&_0x4c43bb['mode']!==_0x3d6a42(0x204)&&await processUpgrade(_0x4c43bb,_0x3796b8),_0xc6306b;}async function generateKeyPair(){const _0x303ba6=a0_0xcf5bbe;let _0x4c4c31=(await exec(_0x303ba6(0x1b5)))['stdout'][_0x303ba6(0x1e0)]();const _0x29af48=a0_0x25ac65[_0x303ba6(0x1a3)]('wg',[_0x303ba6(0x24e)],{'input':_0x4c4c31+'\x0a'});if(_0x29af48[_0x303ba6(0x147)]!==0x0)throw new ErrorWithoutStacktrace(_0x303ba6(0xfb));return{'public':_0x29af48[_0x303ba6(0xe0)][_0x303ba6(0x172)]()[_0x303ba6(0x1e0)](),'private':_0x4c4c31};}async function newApiCreateDevice(_0x54339d,_0x38b7a8,_0x2fa650,_0x53da3e,_0x4e8199){const _0x37ca6d=a0_0xcf5bbe;let _0x5da9f2=await generateKeyPair(),_0x3ca5ba={'platform':CLIENT_PLATFORM,'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'deviceName':_0x38b7a8,'deviceType':_0x4e8199['connector']?_0x37ca6d(0x11c):'user','devicePublicKey':_0x5da9f2[_0x37ca6d(0x14c)]};_0x3ca5ba['deviceType']===_0x37ca6d(0x11c)&&(_0x3ca5ba['authentication']={'name':_0x2fa650,'password':_0x53da3e});let _0x497bc7=await callZteApi('createDevice',_0x3ca5ba,_0x54339d,_0x4e8199);return _0x497bc7=await newApiCompleteAuthentication(_0x54339d,_0x497bc7,_0x2fa650,_0x53da3e,_0x4e8199),{'authenticationInfo':_0x497bc7,'keyPair':_0x5da9f2,'deviceType':_0x3ca5ba[_0x37ca6d(0x23c)]};}async function newApiCompleteAuthentication(_0x5407cc,_0x35f221,_0x3c1165,_0x494357,_0x1b0108){const _0x4f6bc5=a0_0xcf5bbe;if(_0x35f221[_0x4f6bc5(0xc0)]===_0x4f6bc5(0x1c4)){if(_0x1b0108[_0x4f6bc5(0x1b9)]&&!_0x494357)throw new ErrorWithoutStacktrace('Cannot\x20launch\x20ztedge\x20as\x20a\x20service\x20because\x20a\x20password\x20is\x20required');REDIRECT_PORT=(await a0_0x746341(0xbb8))[0x0],REDIRECT_URL='http://127.0.0.1:'+REDIRECT_PORT+_0x4f6bc5(0x232);let _0x49146a;_0x1b0108[_0x4f6bc5(0x134)]?_0x49146a=await handleBrowser(_0x5407cc,_0x35f221[_0x4f6bc5(0x15e)],_0x3c1165,_0x494357):_0x49146a=await handleUserPassword(_0x5407cc,_0x35f221[_0x4f6bc5(0x15e)],_0x3c1165,_0x494357),_0x35f221=await callZteApi('authenticationCompleted',{'code':_0x49146a[_0x4f6bc5(0xf3)],'state':_0x49146a[_0x4f6bc5(0x203)],'redirect_uri':REDIRECT_URL},_0x5407cc,_0x1b0108);}if(_0x35f221[_0x4f6bc5(0xc0)]!==_0x4f6bc5(0x188))throw new ErrorWithoutStacktrace(_0x4f6bc5(0x1ea)+JSON[_0x4f6bc5(0x226)](_0x35f221));return _0x35f221;}async function newApiAuthenticateDevice(_0x2c606f,_0x5e2c07,_0x43c9ea,_0xd8206){const _0x575709=a0_0xcf5bbe;let _0xc3d545={'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'devicePublicKey':_0x5e2c07[_0x575709(0x1c0)],'userId':_0x5e2c07[_0x575709(0x20e)]??''},_0x18701b=await callZteApi(_0x575709(0x1d2),_0xc3d545,_0x2c606f,_0xd8206);return _0x18701b=await newApiCompleteAuthentication(_0x2c606f,_0x18701b,_0x5e2c07[_0x575709(0x107)],_0x43c9ea,_0xd8206),_0x18701b;}let lastSuccessfulPing=null,tunnelStartTime=null;function startHealthCheckListener(_0x4227fe){const _0x5306b0=a0_0xcf5bbe;let _0x638b97=_0x4227fe[_0x5306b0(0xe5)];!_0x638b97[_0x5306b0(0x148)]('/')&&(_0x638b97='/'+_0x638b97);let _0x3d881c=_0x4227fe[_0x5306b0(0x21b)],_0x1e71dd=a0_0x149f23();_0x1e71dd[_0x5306b0(0x1ca)](_0x638b97,(_0x5f18c6,_0x184c75)=>{const _0xa0b05a=_0x5306b0;try{let _0x227859=lastSuccessfulPing??tunnelStartTime,_0x218c23=(Date[_0xa0b05a(0x13b)]()-_0x227859)/0x3e8,_0x22d2f2=_0x218c23>_0x4227fe[_0xa0b05a(0x137)]?0x1f7:0xc8;_0x184c75[_0xa0b05a(0x147)](_0x22d2f2)[_0xa0b05a(0x1e4)]('');}catch(_0x51e049){console[_0xa0b05a(0x183)](_0x51e049),_0x184c75[_0xa0b05a(0x147)](0x1f7)['send']('');}});let _0x253763=a0_0x3f4f39[_0x5306b0(0x251)](_0x1e71dd);_0x253763['on'](_0x5306b0(0x191),()=>{const _0x335200=_0x5306b0;console[_0x335200(0x183)]('Health\x20check\x20listening\x20on\x20http://localhost:'+_0x3d881c+_0x638b97);}),_0x253763[_0x5306b0(0x1c2)](_0x3d881c);}async function newApiLaunchTunnel(_0x247b54,_0x500fe1,_0x403c6c,_0x58f702){const _0x254ffa=a0_0xcf5bbe;if(_0x58f702[_0x254ffa(0x20c)]){process['on'](_0x254ffa(0xec),()=>initiateShutdown(_0x58f702)),process['on']('SIGINT',()=>initiateShutdown(_0x58f702)),tunnelStartTime=Date[_0x254ffa(0x13b)]();_0x58f702[_0x254ffa(0x21b)]&&startHealthCheckListener(_0x58f702);let _0x1dae9e;try{_0x1dae9e=await doNewApiLaunchTunnel(_0x247b54,_0x500fe1,_0x403c6c,_0x58f702);}catch(_0x59b785){if(!_0x58f702[_0x254ffa(0x1b9)])throw _0x59b785;_0x58f702[_0x254ffa(0x168)]?console[_0x254ffa(0x183)](_0x59b785):console[_0x254ffa(0x183)](_0x59b785[_0x254ffa(0x143)]);}if(!_0x58f702[_0x254ffa(0x190)]){console[_0x254ffa(0x183)](_0x254ffa(0x10a));return;}if(shutdownInProgress)return;await newApiMonitorTunnel(_0x500fe1,_0x403c6c,_0x58f702,_0x1dae9e?.[_0x254ffa(0x1c9)],_0x1dae9e?.[_0x254ffa(0x166)]);}else await doNewApiLaunchTunnel(_0x247b54,_0x500fe1,_0x403c6c,_0x58f702);}async function newApiMonitorTunnel(_0xc1612b,_0x37c2d2,_0x1fc3cf,_0x1cb7e3,_0x397fc7){const _0x225686=a0_0xcf5bbe;console[_0x225686(0x183)]('Start\x20monitoring');let _0xfa7982=Date[_0x225686(0x13b)](),_0x319a6d=_0xfa7982,_0x42ce46=_0xfa7982;process[_0x225686(0xff)][_0x225686(0x153)]&&console[_0x225686(0x183)](_0x225686(0x19d));let _0x4630a3=Boolean(_0x397fc7),_0x4bfb13=0x5;while(!shutdownInProgress){if(_0x4630a3)try{process[_0x225686(0xff)][_0x225686(0x153)]&&(_0x397fc7['keepAlive']['keepAliveFrequencySec']=0x5,_0x397fc7[_0x225686(0x1b4)]['postureCheckFrequencySec']=0x1e,_0x397fc7['clientSettings']['getClientSettingsFrequencySec']=0xf);let _0x1f1a89=_0xfa7982+_0x397fc7[_0x225686(0xdc)][_0x225686(0x206)]*0x3e8,_0x2c7d3f=_0x319a6d+_0x397fc7[_0x225686(0x1b4)]['postureCheckFrequencySec']*0x3e8,_0x4f1faf=_0x42ce46+_0x397fc7[_0x225686(0x166)][_0x225686(0x11b)]*0x3e8,_0x5961d7=Date['now'](),_0x39dc2c=Math[_0x225686(0x1e9)](_0x5961d7+0x3e8,Math[_0x225686(0xc7)](_0x1f1a89,_0x2c7d3f,_0x4f1faf));await a0_0x27b860[_0x225686(0x140)](_0x39dc2c);if(shutdownInProgress)break;if(Date[_0x225686(0x13b)]()>_0x4f1faf){try{_0x397fc7=await getGatewayServices(_0x225686(0x166),_0x1cb7e3,_0xc1612b,_0x1fc3cf);}catch(_0x33978d){console[_0x225686(0x183)]('Cannot\x20update\x20client\x20settings:\x20'+_0x33978d['message']);}_0x42ce46=Date[_0x225686(0x13b)]();}if(shutdownInProgress)break;if(Date['now']()>_0x1f1a89){let _0x3537d9=await getGatewayServices(_0x225686(0x1b6),_0x1cb7e3,_0xc1612b,_0x1fc3cf);lastSuccessfulPing=_0xfa7982=Date[_0x225686(0x13b)]();}if(shutdownInProgress)break;if(Date[_0x225686(0x13b)]()>_0x2c7d3f){let _0x5296e5={'postureCheckResults':{'results':[]}},_0x448e1b=await postGatewayServices('clientData',_0x5296e5,_0x1cb7e3,_0xc1612b,_0x1fc3cf);_0x319a6d=Date[_0x225686(0x13b)]();if(!_0x448e1b[_0x225686(0x160)])throw new ErrorWithoutStacktrace(_0x225686(0xbb)+_0x448e1b[_0x225686(0x15d)]);}}catch(_0x5dcac0){_0x4630a3=![],console[_0x225686(0x183)](_0x225686(0x1bf)+_0x5dcac0[_0x225686(0x143)]);}if(!_0x4630a3){process['stdout'][_0x225686(0x220)](_0x225686(0x24c)+_0x4bfb13+_0x225686(0x132)),await a0_0x27b860[_0x225686(0x1d9)](_0x4bfb13*0x3e8);if(shutdownInProgress)break;console[_0x225686(0x183)](_0x225686(0xdf));try{await stopTunnel(_0x1fc3cf),_0x1fc3cf[_0x225686(0x224)]=!![];let _0x5bd8f9=await getSystemInfo(_0x37c2d2[_0x225686(0x101)],_0x1fc3cf),_0x182f5e=await newApiAuthenticateDevice(_0x5bd8f9,_0x37c2d2,null,_0x1fc3cf),_0x3afc72=await doNewApiLaunchTunnel(_0x182f5e[_0x225686(0x109)],_0x5bd8f9,_0x37c2d2,_0x1fc3cf);_0x1cb7e3=_0x3afc72[_0x225686(0x1c9)],_0x397fc7=_0x3afc72[_0x225686(0x166)],lastSuccessfulPing=_0xfa7982=_0x319a6d=_0x42ce46=Date[_0x225686(0x13b)](),_0x4630a3=!![],_0x4bfb13=0x5,console[_0x225686(0x183)]('Reconnect\x20succeeded');}catch(_0x4932ee){_0x4bfb13=Math[_0x225686(0xc7)](_0x4bfb13*0x2,0x12c),console['log'](_0x225686(0x196)+_0x4932ee[_0x225686(0x143)]);}}}}async function setPacFile(_0x3cbecf,_0x1cbebe){const _0x4d34a7=a0_0xcf5bbe;let _0x4cb473=await exec('gsettings\x20set\x20org.gnome.system.proxy\x20mode\x20'+_0x3cbecf),_0x3b0ee7=(await exec(_0x4d34a7(0x173)))?.[_0x4d34a7(0xe0)]?.['trim']()[_0x4d34a7(0x16d)](/'/g,'');if(_0x3b0ee7!==_0x3cbecf)throw new Error(_0x4cb473[_0x4d34a7(0x221)][_0x4d34a7(0x1e0)]());_0x4cb473=await exec(_0x4d34a7(0xd5)+_0x1cbebe+'\x27');let _0x89d8b9=(await exec(_0x4d34a7(0x197)))?.[_0x4d34a7(0xe0)]?.['trim']()[_0x4d34a7(0x16d)](/'/g,'');if(_0x89d8b9!==_0x1cbebe)throw new Error(_0x4cb473[_0x4d34a7(0x221)][_0x4d34a7(0x1e0)]());}async function doNewApiLaunchTunnel(_0x3c254a,_0x237c68,_0x49eb39,_0x300df4){const _0x580b6e=a0_0xcf5bbe;let _0x232646={'authenticationToken':_0x3c254a},_0x302992=await callZteApi(_0x580b6e(0x236),_0x232646,_0x237c68,_0x300df4),_0x164ff1='';if(_0x302992['gatewayDns']){let _0x2c9a21=await a0_0x15b5da[_0x580b6e(0xbe)](_0x302992[_0x580b6e(0x144)]);if(_0x2c9a21[_0x580b6e(0x20f)]===0x0)throw new ErrorWithoutStacktrace(_0x580b6e(0xf4)+_0x302992[_0x580b6e(0x144)]);let _0x5e571d=Math[_0x580b6e(0x135)](Math['random']()*_0x2c9a21[_0x580b6e(0x20f)]);_0x164ff1=_0x2c9a21[_0x5e571d];}_0x232646={'authenticationToken':_0x3c254a,'preferredGatewayIp':_0x164ff1,'postureCheckResults':{'results':[]}};let _0x4e4586=await callZteApi('createPeer',_0x232646,_0x237c68,_0x300df4);if(!_0x4e4586[_0x580b6e(0x160)])throw new ErrorWithoutStacktrace(_0x580b6e(0x1cb)+_0x4e4586[_0x580b6e(0x15d)]);_0x4e4586[_0x580b6e(0x11c)]&&await connectorPreConnectConfigNewApi(_0x4e4586,_0x300df4,_0x237c68);let _0x45099e='';_0x4e4586[_0x580b6e(0x1d3)][_0x580b6e(0x179)]&&(_0x45099e=_0x580b6e(0x19a)+_0x4e4586[_0x580b6e(0x1d3)][_0x580b6e(0x179)]['join'](',\x20')+'\x0a');let _0xd80a44=null,_0x4432e7=null;try{_0xd80a44=(await exec(_0x580b6e(0x173)))?.[_0x580b6e(0xe0)]?.['trim']()[_0x580b6e(0x16d)](/'/g,''),_0x4432e7=(await exec(_0x580b6e(0x197)))?.[_0x580b6e(0xe0)]?.['trim']()[_0x580b6e(0x16d)](/'/g,''),(_0x4432e7['match'](/10\.201\.201\.201|10\.10\.201\.1|zerotrustedge/i)||_0x4e4586[_0x580b6e(0xc2)][_0x580b6e(0x1ff)]&&_0x4e4586[_0x580b6e(0xc2)][_0x580b6e(0x1ff)]===_0x4432e7)&&(_0xd80a44=_0x580b6e(0x204),_0x4432e7='');}catch{}let _0x575fa8=_0x4e4586[_0x580b6e(0x1d3)]['allowedIPs'];if(_0x575fa8[_0x580b6e(0x20f)]===0x1&&_0x575fa8[0x0]===_0x580b6e(0x23f)||_0x575fa8[_0x580b6e(0x20f)]===0x2&&(_0x575fa8[0x0]===_0x580b6e(0x23f)&&_0x575fa8[0x1]===_0x580b6e(0x16b))){}else{if(_0x4e4586[_0x580b6e(0x1d3)]['ipHeuristicsEnabled']){let _0x39d788=new URL(_0x4e4586[_0x580b6e(0x210)]),_0x248c51=_0x39d788[_0x580b6e(0x10e)];!a0_0x4adde2[_0x580b6e(0xe2)](_0x575fa8,_0x248c51)&&_0x575fa8[_0x580b6e(0x12c)](_0x248c51+_0x580b6e(0xd4));let _0x10af11=_0x4e4586['tunnel'][_0x580b6e(0x212)][_0x580b6e(0x16d)](/:.*/,'');a0_0x4adde2[_0x580b6e(0xe2)](_0x575fa8,_0x10af11)&&(_0x575fa8=a0_0x27b860[_0x580b6e(0x17c)](['!'+_0x10af11+_0x580b6e(0xd4),..._0x575fa8]));}}let _0xa18909={'gatewayServicesUrl':_0x4e4586[_0x580b6e(0x210)],'defaultInterface':_0x4e4586[_0x580b6e(0x125)],'userName':_0x49eb39[_0x580b6e(0x107)],'tenant':_0x49eb39[_0x580b6e(0x101)],'setPacFile':Boolean(_0x4e4586[_0x580b6e(0xc2)]['pacFile']),'connector':Boolean(_0x4e4586[_0x580b6e(0x11c)]),'monitorPid':_0x300df4[_0x580b6e(0x20c)]?process[_0x580b6e(0x16c)]:null},_0xb21d07={'oldMode':_0xd80a44,'oldProxyPac':_0x4432e7},_0x4b7add='';_0x300df4['listenPort']&&(_0x4b7add=_0x580b6e(0x164)+_0x300df4[_0x580b6e(0x21d)]+'\x0a');let _0x699359=_0x580b6e(0x182)+(_0x580b6e(0x23a)+_0x49eb39[_0x580b6e(0x213)]+'\x0a')+(_0x580b6e(0x12b)+_0x4e4586[_0x580b6e(0x1d3)][_0x580b6e(0x211)]+'\x0a')+_0x4b7add+_0x45099e+_0x580b6e(0xbc)+(_0x580b6e(0x1cf)+_0x4e4586[_0x580b6e(0x1d3)]['serverPublicKey']+'\x0a')+(_0x580b6e(0x16a)+_0x4e4586[_0x580b6e(0x1d3)]['serverEndpoint']+'\x0a')+_0x580b6e(0x23d)+(_0x580b6e(0x100)+_0x575fa8[_0x580b6e(0x12d)](',\x20')+'\x0a')+(_0x580b6e(0xf0)+JSON['stringify'](_0x237c68)+'\x0a')+(_0x580b6e(0x200)+JSON[_0x580b6e(0x226)](_0xa18909)+'\x0a')+('#\x20restorePac\x20=\x20'+JSON[_0x580b6e(0x226)](_0xb21d07)+'\x0a');await a0_0x1b3cea[_0x580b6e(0x116)](runningConfigFile,_0x699359,{'encoding':'utf8','mode':parseInt(_0x580b6e(0x17d),0x8)});if(!_0x300df4[_0x580b6e(0x190)])return;let _0x558632=await execNoThrow('wg-quick\x20up\x20'+runningConfigFile);if(_0x558632['code']!==0x0||!tunnelActive()){if(_0x558632[_0x580b6e(0x221)][_0x580b6e(0x20a)](_0x580b6e(0x154)))throw new ErrorWithoutStacktrace(_0x580b6e(0x110));else throw new ErrorWithoutStacktrace(_0x580b6e(0x1a6)+_0x558632[_0x580b6e(0x221)][_0x580b6e(0x1e0)]());}else{verboseLog(_0x300df4,_0x580b6e(0x1bc)),verboseLog(_0x300df4,_0x558632);if(_0x4e4586[_0x580b6e(0xc2)]['pacFile'])try{await setPacFile(_0x580b6e(0x1fa),_0x4e4586[_0x580b6e(0xc2)][_0x580b6e(0x1ff)]),console['log'](_0x580b6e(0x24a)+_0x4e4586[_0x580b6e(0xc2)]['pacFile']);}catch(_0x3cfd40){console[_0x580b6e(0x183)](_0x580b6e(0xf1)+_0x3cfd40['message']);}console[_0x580b6e(0x183)]('Waiting\x20for\x20tunnel\x20to\x20come\x20online\x20...\x20');let _0x205647=_0x4e4586[_0x580b6e(0x1d3)][_0x580b6e(0x14a)][_0x580b6e(0x16d)](/[-[\]{}()*+?.,\\^$|#\s]/g,_0x580b6e(0x1da)),_0x5af501=new RegExp('^'+_0x205647+'\x09(.+?)\x09(.+?)\x09(.+?)\x09(.+?)\x09','m'),_0x4eaba9=await a0_0x27b860[_0x580b6e(0x1ed)](async()=>{const _0x2b365f=_0x580b6e;if(shutdownInProgress)return![];let _0x4559ed=await execNoThrow(_0x2b365f(0xe7)),_0x4bbbeb=(_0x4559ed[_0x2b365f(0xe0)]??'')[_0x2b365f(0x19e)](_0x5af501),_0x58b5ab=_0x4bbbeb?_0x4bbbeb[0x4]:'no-data',_0x38d44d=_0x4bbbeb&&_0x4bbbeb[0x4]!=='0';return debugLog(_0x300df4,'Check\x20tunnel\x20handshake\x20=>\x20'+_0x58b5ab+_0x2b365f(0x242)+_0x38d44d),_0x38d44d;},{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0x4eaba9){try{await stopTunnel(_0x300df4);}catch{}throw new ErrorWithoutStacktrace(_0x580b6e(0x126));}let _0x54b58c=await a0_0x27b860[_0x580b6e(0x1ed)](async()=>shutdownInProgress||await getGatewayServices('clientSettings',_0xa18909,_0x237c68,_0x300df4,{'throwIfError':![]}),{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0x54b58c){try{await stopTunnel(_0x300df4);}catch{}throw new ErrorWithoutStacktrace(_0x580b6e(0x18c));}return _0x4e4586[_0x580b6e(0x11c)]?(await connectorPostConnectConfigNewApi(_0x4e4586,_0x300df4,_0x237c68),console[_0x580b6e(0x183)](_0x580b6e(0xfa))):console[_0x580b6e(0x183)](_0x580b6e(0x104)),{'clientSettings':_0x54b58c,'deviceInfo':_0xa18909};}}async function postGatewayServices(_0x4e9c14,_0x5ae46f,_0x304e47,_0x24dfed,_0x4c19ec,{throwIfError:throwIfError=!![]}={}){const _0x459299=a0_0xcf5bbe;try{let _0x2b3d49=_0x304e47['gatewayServicesUrl']+'/'+_0x4e9c14;debugLog(_0x4c19ec,_0x459299(0xf5)+_0x2b3d49+_0x459299(0x239)),debugLog(_0x4c19ec,_0x5ae46f);let _0x16d0d4=await a0_0x18ad4c[_0x459299(0x14f)](_0x2b3d49,{'json':_0x5ae46f,'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':'json','timeout':{'request':0x5*0x3e8}});return debugLog(_0x4c19ec,_0x16d0d4['body']),debugLog(_0x4c19ec,'------------------------'),_0x16d0d4[_0x459299(0x201)];}catch(_0x2a473e){debugLog(_0x4c19ec,_0x459299(0x19c)+_0x2a473e['message']),debugLog(_0x4c19ec,'------------------------');if(throwIfError)throw new ErrorWithoutStacktrace(_0x4e9c14+'\x20failed:\x20'+_0x2a473e['message']);}}async function getGatewayServices(_0xf565f6,_0x3c9d92,_0x43b007,_0x3d2966,{throwIfError:throwIfError=!![]}={}){const _0x3d634c=a0_0xcf5bbe;try{let _0x264669=_0x3c9d92[_0x3d634c(0x210)]+'/'+_0xf565f6;debugLog(_0x3d2966,_0x3d634c(0x146)+_0x264669+_0x3d634c(0x239));let _0x4e4349=await a0_0x18ad4c(_0x264669,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':'json','timeout':{'request':0x5*0x3e8}});return debugLog(_0x3d2966,_0x4e4349[_0x3d634c(0x201)]),debugLog(_0x3d2966,_0x3d634c(0xd1)),_0x4e4349[_0x3d634c(0x201)];}catch(_0x27b362){debugLog(_0x3d2966,_0x3d634c(0x19c)+_0x27b362['message']),debugLog(_0x3d2966,_0x3d634c(0xd1));if(throwIfError)throw new ErrorWithoutStacktrace(_0xf565f6+_0x3d634c(0x18a)+_0x27b362[_0x3d634c(0x143)]);}}function devNameToFileName(_0x2b9974,_0x138e61,_0x374566){const _0x273765=a0_0xcf5bbe;_0x138e61=_0x138e61[_0x273765(0x16d)](/[/\\]/g,'');let _0x5bc4da=a0_0x42c640[_0x273765(0x12d)](deviceFolder,''+_0x2b9974+sep+_0x138e61+sep+_0x374566+_0x273765(0x244));return _0x5bc4da;}async function saveProfile(_0xdc7451,_0x403837,_0x3d1242){const _0x4a6531=a0_0xcf5bbe;!await fileExists(deviceFolder)&&(await a0_0x1b3cea[_0x4a6531(0x102)](deviceFolder),console['log'](_0x4a6531(0x1f6)+deviceFolder));let _0x4a5912=devNameToFileName(_0xdc7451,_0x403837[_0x4a6531(0x1b8)],_0x3d1242),_0x1636b4={'version':CLIENT_VERSION,'privateKey':_0x403837[_0x4a6531(0x225)],'tenant':_0xdc7451,'isConnector':_0x403837['isConnector'],'user':_0x403837[_0x4a6531(0x1b8)],'userId':_0x403837[_0x4a6531(0x20e)],'deviceName':_0x3d1242};return await a0_0x1b3cea[_0x4a6531(0x116)](_0x4a5912,JSON['stringify'](_0x1636b4,null,0x2)+'\x0a',{'encoding':_0x4a6531(0xea),'mode':parseInt(_0x4a6531(0x17d),0x8)}),_0x4a5912;}async function readProfile(_0x51afd6){const _0x59256d=a0_0xcf5bbe;let _0x55338a=await a0_0x1b3cea[_0x59256d(0x163)](_0x51afd6,'utf8'),_0x24bb63=JSON[_0x59256d(0x15a)](_0x55338a);return _0x24bb63[_0x59256d(0x1c0)]=await getPublicKey(_0x24bb63[_0x59256d(0x213)]),_0x24bb63;}async function getCurrentConnectionInfo(){const _0x458dd7=a0_0xcf5bbe;let _0x10afb3=await a0_0x1b3cea[_0x458dd7(0x163)](runningConfigFile,_0x458dd7(0xea)),_0x41cb37={'privateKey':_0x10afb3['match'](/PrivateKey = (.*)/)?.[0x1],'ip':_0x10afb3['match'](/Address = (.*)/)?.[0x1],'systemInfo':JSON[_0x458dd7(0x15a)](_0x10afb3[_0x458dd7(0x19e)](/systemInfo = (.*)/)?.[0x1]),'deviceInfo':JSON[_0x458dd7(0x15a)](_0x10afb3[_0x458dd7(0x19e)](/deviceInfo = (.*)/)?.[0x1]),'restorePac':JSON[_0x458dd7(0x15a)](_0x10afb3['match'](/restorePac = (.*)/)?.[0x1])};return _0x41cb37[_0x458dd7(0x1c0)]=await getPublicKey(_0x41cb37['privateKey']),_0x41cb37;}async function execNoThrow(_0x4b4bca){const _0x33d0f5=a0_0xcf5bbe;try{let _0x121748=await exec(_0x4b4bca);return _0x121748[_0x33d0f5(0xf3)]=0x0,_0x121748;}catch(_0x133b7a){return{'code':_0x133b7a[_0x33d0f5(0xf3)]??-0x1,'stderr':_0x133b7a[_0x33d0f5(0x221)]??'','stdout':_0x133b7a[_0x33d0f5(0xe0)]??''};}}async function fileExists(_0x17d13f){const _0x26ea26=a0_0xcf5bbe;try{return await a0_0x1b3cea[_0x26ea26(0x19f)](_0x17d13f),!![];}catch{return![];}}function isString(_0x1ae168){const _0x33c071=a0_0xcf5bbe;return typeof _0x1ae168===_0x33c071(0x149);}function doLog(_0x6b21c6){const _0x4c38c0=a0_0xcf5bbe;if(_0x6b21c6[_0x4c38c0(0xe0)]||_0x6b21c6[_0x4c38c0(0x221)]){let _0x3d1b61=_0x6b21c6[_0x4c38c0(0xe0)]?.['trim']();_0x3d1b61&&console[_0x4c38c0(0x183)](_0x3d1b61);let _0xa24681=_0x6b21c6[_0x4c38c0(0x221)]?.[_0x4c38c0(0x1e0)]();_0xa24681&&console[_0x4c38c0(0x183)](_0xa24681);}else isString(_0x6b21c6)?console[_0x4c38c0(0x183)](_0x6b21c6):console[_0x4c38c0(0x183)](JSON[_0x4c38c0(0x226)](_0x6b21c6,null,0x2));}function debugLog(_0x552818,_0x20a456){const _0x1a0f3b=a0_0xcf5bbe;_0x552818?.[_0x1a0f3b(0x168)]&&doLog(_0x20a456);}function verboseLog(_0x2f0084,_0x3af76f){const _0x4dd4ae=a0_0xcf5bbe;(_0x2f0084?.[_0x4dd4ae(0x199)]||_0x2f0084?.[_0x4dd4ae(0x168)])&&doLog(_0x3af76f);}async function stopTunnel(_0x12b85e){const _0x4c3d44=a0_0xcf5bbe;let _0x4ab836;if(!tunnelActive()){await execNoThrow(_0x4c3d44(0x131));return;}else{if(!await fileExists(runningConfigFile))console[_0x4c3d44(0x183)]('The\x20configuration\x20file\x20for\x20the\x20current\x20tunnel\x20has\x20been\x20deleted.\x20\x20Attempting\x20to\x20shutdown\x20anyway\x20...'),await execNoThrow(_0x4c3d44(0x131)),_0x4ab836=await execNoThrow(_0x4c3d44(0x1f3)+TUNNEL_INTERFACE_NAME);else{let _0x4d698f=await getCurrentConnectionInfo();if(_0x4d698f[_0x4c3d44(0x1c9)][_0x4c3d44(0xfc)]&&_0x4d698f[_0x4c3d44(0x1c9)]['monitorPid']!==process[_0x4c3d44(0x16c)]){console[_0x4c3d44(0x183)](_0x4c3d44(0x18f)+_0x4d698f['deviceInfo']['monitorPid']+_0x4c3d44(0x21e));try{process[_0x4c3d44(0x222)](_0x4d698f[_0x4c3d44(0x1c9)][_0x4c3d44(0xfc)],_0x4c3d44(0xec));return;}catch(_0x20f6ca){console[_0x4c3d44(0x183)]('Failed\x20to\x20signal.\x20\x20Trying\x20local\x20kill');}}try{let _0x5e0293=await a0_0x18ad4c[_0x4c3d44(0x14f)](_0x4d698f[_0x4c3d44(0x1c9)][_0x4c3d44(0x210)]+_0x4c3d44(0x136),{'json':{'key':_0x4d698f['publicKey']},'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x4c3d44(0x22a),'timeout':{'request':0x5*0x3e8}});_0x5e0293[_0x4c3d44(0x150)]!==0xc8&&console[_0x4c3d44(0x183)]('Logout\x20failed:\x20'+_0x5e0293['body']);}catch(_0xf76099){console['log'](_0x4c3d44(0x253)+_0xf76099[_0x4c3d44(0x143)]);}_0x4ab836=await execNoThrow('wg-quick\x20down\x20'+runningConfigFile),await a0_0x1b3cea['unlink'](runningConfigFile);if(_0x4d698f['deviceInfo'][_0x4c3d44(0x11c)]){console[_0x4c3d44(0x183)](_0x4c3d44(0x165));let _0x579533=await execNoThrow(_0x4c3d44(0x106)+_0x4d698f[_0x4c3d44(0x1c9)][_0x4c3d44(0x125)]+'\x20-j\x20MASQUERADE');}if(_0x4d698f[_0x4c3d44(0x1c9)][_0x4c3d44(0xe1)])try{await setPacFile(_0x4d698f[_0x4c3d44(0x233)][_0x4c3d44(0x1d7)],_0x4d698f[_0x4c3d44(0x233)]['oldProxyPac']);if(_0x4d698f[_0x4c3d44(0x233)][_0x4c3d44(0x1d7)]===_0x4c3d44(0x204))console['log']('Proxy\x20settings\x20cleared');else _0x4d698f[_0x4c3d44(0x233)][_0x4c3d44(0x1d7)]===_0x4c3d44(0x1fa)?console[_0x4c3d44(0x183)](_0x4c3d44(0x198)+_0x4d698f[_0x4c3d44(0x233)]['oldProxyPac']):console[_0x4c3d44(0x183)](_0x4c3d44(0x1f0)+_0x4d698f[_0x4c3d44(0x233)][_0x4c3d44(0x1d7)]);}catch(_0x3e7953){console[_0x4c3d44(0x183)](_0x4c3d44(0xce)+_0x3e7953[_0x4c3d44(0x143)]);}}}if(_0x4ab836[_0x4c3d44(0xf3)]!==0x0||tunnelActive())throw new ErrorWithoutStacktrace('Tunnel\x20did\x20not\x20shutdown:\x0a'+_0x4ab836[_0x4c3d44(0x221)][_0x4c3d44(0x1e0)]());else verboseLog(_0x12b85e,_0x4ab836);}async function initiateShutdown(_0x18b453){const _0x697d7b=a0_0xcf5bbe;try{console[_0x697d7b(0x183)](),++shutdownInProgress;if(shutdownInProgress===0x2){console[_0x697d7b(0x183)](_0x697d7b(0x230));return;}else shutdownInProgress===0x3&&(console['log'](_0x697d7b(0x141)),process[_0x697d7b(0x1e8)](0x1));!tunnelActive()?console['log']('Tunnel\x20is\x20not\x20running\x20...\x20'):(console['log'](_0x697d7b(0x127)),await stopTunnel(_0x18b453)),console[_0x697d7b(0x183)](_0x697d7b(0x122)),process[_0x697d7b(0x1e8)](0x0);}catch(_0x5dcb82){console[_0x697d7b(0x183)](_0x5dcb82),console['log'](_0x697d7b(0x122)),process[_0x697d7b(0x1e8)](0x0);}}async function doPing(_0x13b52e){const _0x1cd968=a0_0xcf5bbe;let _0x5a493b=![];try{let _0x4c0718=await a0_0x18ad4c(_0x13b52e['deviceInfo'][_0x1cd968(0x210)]+'/clientPing',{'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x1cd968(0x22a),'timeout':{'request':0x5*0x3e8}});_0x5a493b=_0x4c0718?.[_0x1cd968(0x150)]===0xc8;}catch(_0x4e25a1){console[_0x1cd968(0x183)]('Ping\x20failure:\x20'+_0x4e25a1[_0x1cd968(0x143)]);}return _0x5a493b;}async function connectorPreConnectConfigNewApi(_0x1a5487,_0x42125b,_0x7fb2ca){const _0xc1e03e=a0_0xcf5bbe;let _0x5f7430=await exec(_0xc1e03e(0x14b)),_0x21d98a=_0x5f7430[_0xc1e03e(0xe0)][_0xc1e03e(0x19e)](/ dev (\w+) /)?.[0x1];if(!_0x21d98a)throw new Error(_0xc1e03e(0x238));_0x1a5487['defaultInterface']=_0x21d98a;}async function connectorPostConnectConfigNewApi(_0x2e98d5,_0x337906,_0x358245){const _0x2009f7=a0_0xcf5bbe;console['log'](_0x2009f7(0x120)+_0x2e98d5['defaultInterface']),console['log'](_0x2009f7(0x1bd));try{await exec('sudo\x20iptables\x20-A\x20POSTROUTING\x20-t\x20nat\x20-o\x20'+_0x2e98d5[_0x2009f7(0x125)]+_0x2009f7(0x1d4)),await exec(_0x2009f7(0x1dc));}catch(_0x122a82){console['log'](_0x2009f7(0x1e6)+_0x122a82[_0x2009f7(0x143)]);}}function tunnelActive(){let _0x4f2892=a0_0x42d965['networkInterfaces']();return Boolean(_0x4f2892[TUNNEL_INTERFACE_NAME]);}async function findMatchingProfile(_0x119cec,_0xf29b2b,_0x2d1b64){const _0x569b1b=a0_0xcf5bbe;let _0x4001ec;if(_0x119cec&&_0xf29b2b&&_0x2d1b64){let _0x542adb=devNameToFileName(_0x119cec,_0xf29b2b,_0x2d1b64);if(!await fileExists(_0x542adb))throw new ErrorWithoutStacktrace('Profile\x20does\x20not\x20exist');_0x4001ec=await readProfile(devNameToFileName(_0x119cec,_0xf29b2b,_0x2d1b64));}else{let _0x4cfff6=await fileExists(deviceFolder)&&await a0_0x1b3cea[_0x569b1b(0x1ee)](deviceFolder);if(!_0x4cfff6)throw new ErrorWithoutStacktrace(_0x569b1b(0x1d8));let _0x5a1beb;_0x119cec&&!_0xf29b2b?_0x5a1beb=_0x119cec+sep+'.*'+(_0x2d1b64??'.*'):_0x5a1beb=(_0x119cec??'.*')+sep+(_0xf29b2b??'.*')+sep+(_0x2d1b64??'.*');let _0x24c739=_0x4cfff6[_0x569b1b(0x25d)](_0x590bc6=>_0x590bc6['match'](_0x5a1beb));if(_0x24c739[_0x569b1b(0x20f)]===0x0)throw new ErrorWithoutStacktrace(_0x569b1b(0x1d8));else{if(_0x24c739['length']===0x1){let _0x597997=_0x24c739[0x0][_0x569b1b(0x19e)]('^(.*)'+sep+_0x569b1b(0x1c1)+sep+_0x569b1b(0x1c7)),_0x57a9c2=a0_0x42c640[_0x569b1b(0x12d)](deviceFolder,_0x24c739[0x0]);_0x4001ec=await readProfile(_0x57a9c2),console[_0x569b1b(0x183)](_0x569b1b(0x1fe)+_0x4001ec[_0x569b1b(0x101)]+'\x20'+_0x4001ec[_0x569b1b(0x107)]);}else throw new ErrorWithoutStacktrace('Multiple\x20profiles\x20match');}}return _0x4001ec;}async function getPublicKey(_0x22c34d){const _0x2f2a6f=a0_0xcf5bbe,_0x5ed989=a0_0x25ac65['spawnSync']('wg',[_0x2f2a6f(0x24e)],{'input':_0x22c34d+'\x0a'});if(_0x5ed989[_0x2f2a6f(0x147)]!==0x0)throw new ErrorWithoutStacktrace('cannot\x20generate\x20publickey');return _0x5ed989[_0x2f2a6f(0xe0)][_0x2f2a6f(0x172)]()[_0x2f2a6f(0x1e0)]();}async function setupShieldCertificate(_0x4e2eb5){const _0x1ec4b2=a0_0xcf5bbe;_0x4e2eb5['caCertificates']&&a0_0xe14e50[_0x1ec4b2(0x1b7)](_0x4e2eb5[_0x1ec4b2(0xf2)][_0x1ec4b2(0x170)](','));for(let _0x1ee2f1 of SHIELD_CA_CERTIFICATES){await fileExists(_0x1ee2f1)?a0_0xe14e50[_0x1ec4b2(0x1b7)](_0x1ee2f1):console[_0x1ec4b2(0x183)]('Warning:\x20'+_0x1ee2f1+_0x1ec4b2(0x169));}}function myParseInt(_0x2b5c3b,_0x1cdaa3){return parseInt(_0x2b5c3b);}function myParseString(_0xb205f,_0xd2ca9e){return _0xb205f;}function addConnectOptions(_0x8d8886,_0x4ffe08){const _0x2d264c=a0_0xcf5bbe;let _0x260c1f=_0x8d8886[_0x2d264c(0x1b1)][_0x2d264c(0x1a9)](_0x1e810f=>_0x1e810f[_0x2d264c(0xcb)]===_0x4ffe08);_0x260c1f[_0x2d264c(0xbf)](_0x2d264c(0x17e),'Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20was\x20not\x20specified.',null)['option'](_0x2d264c(0x229),'Use\x20browser\x20based\x20authentication',![])[_0x2d264c(0xbf)](_0x2d264c(0x1e2),'Only\x20do\x20the\x20authentication/profileManagement\x20and\x20do\x20not\x20launch\x20the\x20tunnel',![])[_0x2d264c(0xbf)](_0x2d264c(0x258),'Do\x20everything\x20except\x20for\x20launching\x20the\x20tunnel',!![])[_0x2d264c(0xbf)]('--no-monitor','do\x20not\x20monitor\x20the\x20connection.\x20\x20When\x20monitored,\x20exit\x20with\x20SIGTERM\x20or\x20SIGINT\x20or\x20\x22ztedge-client\x20down\x22')[_0x2d264c(0xbf)](_0x2d264c(0x1cd),_0x2d264c(0x256),myParseInt,0xf)[_0x2d264c(0xbf)]('--reconnectTimeoutSec\x20<num>','How\x20long\x20(since\x20the\x20last\x20successful\x20ping\x20to\x20initiate\x20a\x20reconnect)\x20',myParseInt,0x3c)[_0x2d264c(0xbf)]('--upgrade',_0x2d264c(0xbd),![])[_0x2d264c(0xbf)](_0x2d264c(0x152),'device\x20name',myParseString,a0_0x42d965['hostname']())[_0x2d264c(0xbf)](_0x2d264c(0x247),_0x2d264c(0x15c),myParseInt,0x0)['option'](_0x2d264c(0xcc),_0x2d264c(0x216),myParseInt,0x0)[_0x2d264c(0xbf)]('--health-check-path\x20<path>',_0x2d264c(0x155),myParseString,_0x2d264c(0x159))[_0x2d264c(0xbf)]('--health-check-timeout\x20<sec>',_0x2d264c(0x12a),myParseInt,0x3c),addCommonOptions(_0x8d8886,_0x4ffe08);}function addCommonOptions(_0x46984a,_0x148c0b){const _0x29ea6d=a0_0xcf5bbe;let _0xfa7030=_0x46984a[_0x29ea6d(0x1b1)][_0x29ea6d(0x1a9)](_0x11856b=>_0x11856b[_0x29ea6d(0xcb)]===_0x148c0b);_0xfa7030[_0x29ea6d(0xbf)](_0x29ea6d(0x11f),_0x29ea6d(0x175),![])[_0x29ea6d(0xbf)](_0x29ea6d(0x10d),_0x29ea6d(0x24d),DEFAULT_CA_FOLDER)[_0x29ea6d(0xbf)](_0x29ea6d(0x1f9),'Show\x20details',![])[_0x29ea6d(0xbf)](_0x29ea6d(0x1e5),_0x29ea6d(0x24f),![]);}function execError(_0x3f91ee){const _0x1df4fc=a0_0xcf5bbe;let _0x982fe0=_0x3f91ee[_0x1df4fc(0xe0)][_0x1df4fc(0x1e0)](),_0x22b623=_0x3f91ee[_0x1df4fc(0x221)][_0x1df4fc(0x1e0)]();if(!_0x982fe0)return _0x22b623;else return!_0x22b623?_0x982fe0:_0x982fe0+'\x0a'+_0x22b623;}async function launchFromToken(_0x33cfb0,_0x5e888e,_0x9c5ae8,_0x450c08){const _0x3b1501=a0_0xcf5bbe;let _0x4fa167='';_0x450c08['debug']&&(_0x4fa167+=_0x3b1501(0x1db));_0x450c08[_0x3b1501(0x1bb)]&&(_0x4fa167+=_0x3b1501(0x138)+_0x450c08[_0x3b1501(0x1bb)]);let _0x40463c='/tmp/ztedge-client.log';await fileExists(_0x40463c)&&await a0_0x1b3cea[_0x3b1501(0x248)](_0x40463c);let _0x3223e2=_0x3b1501(0x17f)+_0x33cfb0+_0x3b1501(0x18b)+_0x5e888e+_0x3b1501(0x18b)+_0x9c5ae8+'\x22\x20'+_0x4fa167+'\x20>\x20'+_0x40463c;execNoThrow(_0x3223e2),console[_0x3b1501(0x183)](_0x3b1501(0x246)+_0x40463c),process[_0x3b1501(0xe0)]['write'](_0x3b1501(0x1d5));for(;;){if(!tunnelActive())process[_0x3b1501(0xe0)]['write']('.');else{let _0x1eb8dc=await getCurrentConnectionInfo(),_0x4d27f8=await doPing(_0x1eb8dc);if(_0x4d27f8){console[_0x3b1501(0x183)](),console[_0x3b1501(0x183)](_0x3b1501(0x20d)+_0x1eb8dc['ip']),console[_0x3b1501(0x183)]('Connected\x20to:\x20'+_0x1eb8dc['deviceInfo']['tenant']),console[_0x3b1501(0x183)]('Connected\x20as:\x20'+_0x1eb8dc['deviceInfo'][_0x3b1501(0x1b8)]),console['log'](_0x3b1501(0x209));break;}else process[_0x3b1501(0xe0)]['write']('.');}await a0_0x27b860[_0x3b1501(0x1d9)](0x3e8);}}async function main(){const _0x419ce3=a0_0xcf5bbe;try{const _0x5d78cb=new a0_0xa14d98['Command']();_0x5d78cb[_0x419ce3(0x1a4)]('Create\x20and\x20maintain\x20connections\x20to\x20ZTEdge')[_0x419ce3(0x145)](![])[_0x419ce3(0x1a0)](CLIENT_VERSION),_0x5d78cb[_0x419ce3(0xc3)](_0x419ce3(0x1a8))[_0x419ce3(0x1a4)]('Create\x20a\x20new\x20profile\x20and\x20start\x20the\x20tunnel.\x0a'+_0x419ce3(0x22e)+_0x419ce3(0x257))['option']('-f|--force',_0x419ce3(0x1ad),![])[_0x419ce3(0xbf)](_0x419ce3(0x214),_0x419ce3(0x117),![])[_0x419ce3(0xbf)](_0x419ce3(0x223),_0x419ce3(0x118))[_0x419ce3(0x1aa)](async function(_0x2d1034,_0x3e9213,_0x2b776d){const _0xa124db=_0x419ce3;await setupShieldCertificate(_0x2b776d);if(tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20currently\x20active');_0x3e9213=_0x3e9213?.[_0xa124db(0x1e0)]();let _0x4562f1=_0x2b776d[_0xa124db(0x1ab)]?.[_0xa124db(0x1e0)](),_0xf17b5f=_0x2b776d['deviceName'],_0x3ad32d=devNameToFileName(_0x2d1034,_0x3e9213,_0xf17b5f);if(!_0x2b776d[_0xa124db(0x13d)]&&await fileExists(_0x3ad32d))throw new ErrorWithoutStacktrace(_0x3ad32d+_0xa124db(0xd9));let _0x55f2a7=await getSystemInfo(_0x2d1034,_0x2b776d),_0x18c550=await newApiCreateDevice(_0x55f2a7,_0xf17b5f,_0x3e9213,_0x4562f1,_0x2b776d),_0x397418={'devicePrivateKey':_0x18c550['keyPair'][_0xa124db(0x156)],'isConnector':_0x2b776d[_0xa124db(0x11c)],'userName':_0x18c550[_0xa124db(0x11e)][_0xa124db(0x1b8)],'userId':_0x18c550[_0xa124db(0x11e)][_0xa124db(0x20e)]},_0x118f94=await saveProfile(_0x2d1034,_0x397418,_0xf17b5f);console[_0xa124db(0x183)]('Saved\x20'+_0x118f94);if(_0x2b776d[_0xa124db(0x186)])await launchFromToken(_0x2d1034,_0x3e9213,_0x18c550['authenticationInfo'][_0xa124db(0x109)],_0x2b776d);else{if(!_0x2b776d[_0xa124db(0x17b)]){let _0x4941ac=await readProfile(_0x118f94);await newApiLaunchTunnel(_0x18c550[_0xa124db(0x11e)][_0xa124db(0x109)],_0x55f2a7,_0x4941ac,_0x2b776d);}else console[_0xa124db(0x183)](_0xa124db(0x192));}}),addConnectOptions(_0x5d78cb,_0x419ce3(0x25b)),_0x5d78cb['command']('up\x20[<cloudId>]\x20[<user>]')[_0x419ce3(0x1a4)]('Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x0a'+_0x419ce3(0x123)+_0x419ce3(0xfd)+_0x419ce3(0x257))[_0x419ce3(0xbf)](_0x419ce3(0xd7),_0x419ce3(0xba),![])[_0x419ce3(0xbf)]('-b|--background','Run\x20connection\x20in\x20the\x20background')['action'](async function(_0x28738a,_0x411724,_0xf54be4){const _0xab8476=_0x419ce3;await setupShieldCertificate(_0xf54be4);if(tunnelActive())throw new ErrorWithoutStacktrace(_0xab8476(0x1af));_0x411724=_0x411724?.[_0xab8476(0x1e0)]();let _0x4b650b=_0xf54be4[_0xab8476(0x1ab)]?.[_0xab8476(0x1e0)](),_0x29be59=_0xf54be4[_0xab8476(0x1bb)],_0x55670e=await findMatchingProfile(_0x28738a,_0x411724,_0x29be59),_0x2fda6b=await getSystemInfo(_0x55670e[_0xab8476(0x101)],_0xf54be4),_0x530e52=await newApiAuthenticateDevice(_0x2fda6b,_0x55670e,_0x4b650b,_0xf54be4);if(_0xf54be4[_0xab8476(0x186)])await launchFromToken(_0x55670e[_0xab8476(0x101)],_0x411724,_0x530e52[_0xab8476(0x109)],_0xf54be4);else!_0xf54be4[_0xab8476(0x17b)]?await newApiLaunchTunnel(_0x530e52[_0xab8476(0x109)],_0x2fda6b,_0x55670e,_0xf54be4):console[_0xab8476(0x183)](_0xab8476(0x192));}),addConnectOptions(_0x5d78cb,'up'),_0x5d78cb['command']('launchFromToken\x20<cloudId>\x20<user>\x20<token>')['description']('Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x20with\x20authentication\x20token\x0a'+_0x419ce3(0x123)+'You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20If\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a'+_0x419ce3(0x257))[_0x419ce3(0x1aa)](async function(_0xe6e5cb,_0x46b98b,_0x206338,_0x53057a){const _0x38e767=_0x419ce3;await setupShieldCertificate(_0x53057a);if(tunnelActive())throw new ErrorWithoutStacktrace(_0x38e767(0x1af));let _0x26ec70=_0x53057a[_0x38e767(0x1bb)],_0x4a244f=await findMatchingProfile(_0xe6e5cb,_0x46b98b,_0x26ec70);_0x53057a[_0x38e767(0x1b9)]=!![];let _0x49bb19=await getSystemInfo(_0x4a244f[_0x38e767(0x101)],_0x53057a);await newApiLaunchTunnel(_0x206338,_0x49bb19,_0x4a244f,_0x53057a);}),addConnectOptions(_0x5d78cb,_0x419ce3(0x15f)),_0x5d78cb[_0x419ce3(0xc3)]('down')[_0x419ce3(0x1a4)](_0x419ce3(0x13c))['action'](async function(_0x1e4ba1){await setupShieldCertificate(_0x1e4ba1);if(!tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20not\x20currently\x20active');await stopTunnel(_0x1e4ba1);}),addCommonOptions(_0x5d78cb,_0x419ce3(0x193)),_0x5d78cb[_0x419ce3(0xc3)](_0x419ce3(0x105))['description'](_0x419ce3(0xe8)+_0x419ce3(0x177))[_0x419ce3(0xbf)](_0x419ce3(0x17e),_0x419ce3(0x1cc),null)[_0x419ce3(0xbf)](_0x419ce3(0x229),'Use\x20browser\x20based\x20authentication',![])[_0x419ce3(0x1aa)](async function(_0x5b8cef,_0x3c367e,_0x62f632){const _0x1eb56c=_0x419ce3;await setupShieldCertificate(_0x62f632);let _0xb9ffda=await a0_0x1b3cea[_0x1eb56c(0x163)](_0x5b8cef,'utf8'),_0x3ab197=_0xb9ffda[_0x1eb56c(0x19e)](/PrivateKey = (.*)/)[0x1],_0x440699=_0xb9ffda[_0x1eb56c(0x19e)](/host = ([^.]*)/)[0x1],_0x9693a6=a0_0x42d965[_0x1eb56c(0x10e)](),_0xa3a15c=await getSystemInfo(_0x440699,_0x62f632),_0x1f6f09={'version':CLIENT_VERSION,'tenant':_0x440699,'deviceName':_0x9693a6,'publicKey':await getPublicKey(_0x3ab197),'user':_0x3c367e},_0x489aae=await newApiAuthenticateDevice(_0xa3a15c,_0x1f6f09,_0x62f632[_0x1eb56c(0x1ab)],_0x62f632);if(!_0x489aae[_0x1eb56c(0x1b8)]){if(!_0x3c367e)throw new ErrorWithoutStacktrace(_0x1eb56c(0x235));_0x489aae[_0x1eb56c(0x1b8)]=_0x3c367e;}_0x489aae[_0x1eb56c(0x225)]=_0x3ab197;let _0x4dbd19=await saveProfile(_0x440699,_0x489aae,_0x9693a6);console[_0x1eb56c(0x183)](_0x1eb56c(0xe3)+_0x4dbd19);}),addCommonOptions(_0x5d78cb,_0x419ce3(0x249)),_0x5d78cb[_0x419ce3(0xc3)]('ls')['description']('List\x20the\x20currently\x20available\x20profiles\x0a')[_0x419ce3(0x1aa)](async function(_0x49e486){const _0x1ec782=_0x419ce3;await setupShieldCertificate(_0x49e486);let _0x3ffcb8=await fileExists(deviceFolder)?await a0_0x1b3cea['readdir'](deviceFolder):[];console['log']('Profiles\x20are\x20stored\x20in\x20'+deviceFolder),_0x3ffcb8=_0x3ffcb8[_0x1ec782(0x25d)](_0x5ca376=>_0x5ca376[_0x1ec782(0x1c3)](_0x1ec782(0x244)));if(_0x3ffcb8[_0x1ec782(0x20f)]){let _0x10d064=await Promise[_0x1ec782(0x1b2)](_0x3ffcb8[_0x1ec782(0x11d)](_0x10e33e=>readProfile(a0_0x42c640[_0x1ec782(0x12d)](deviceFolder,_0x10e33e)))),_0x4d565f=Math[_0x1ec782(0x1e9)](..._0x10d064['map'](_0x42da6c=>_0x42da6c[_0x1ec782(0x101)][_0x1ec782(0x20f)]));for(let _0x2189dc of _0x10d064){console[_0x1ec782(0x183)](_0x2189dc[_0x1ec782(0x101)][_0x1ec782(0x202)](_0x4d565f+0x5,'\x20')+_0x2189dc[_0x1ec782(0x107)]);}}else console['log'](_0x1ec782(0xfe));}),addCommonOptions(_0x5d78cb,'ls'),_0x5d78cb[_0x419ce3(0xc3)](_0x419ce3(0x147))[_0x419ce3(0x1a4)](_0x419ce3(0x103))[_0x419ce3(0x1aa)](async function(_0x4a6525){const _0x3157c2=_0x419ce3;await setupShieldCertificate(_0x4a6525);if(!tunnelActive())console[_0x3157c2(0x183)](_0x3157c2(0x113));else{let _0x6f174e=await getCurrentConnectionInfo(),_0x4bc417=await doPing(_0x6f174e);console['log'](_0x3157c2(0x1d6)+_0x6f174e['deviceInfo'][_0x3157c2(0x101)]),console[_0x3157c2(0x183)](_0x3157c2(0x231)+_0x6f174e[_0x3157c2(0x1c9)][_0x3157c2(0x1b8)]),console[_0x3157c2(0x183)](_0x3157c2(0x20d)+_0x6f174e['ip']),_0x4bc417?console[_0x3157c2(0x183)]('Tunnel\x20is\x20functioning\x20properly'):console[_0x3157c2(0x183)]('Tunnel\x20is\x20not\x20functioning\x20properly'),_0x6f174e[_0x3157c2(0x1c9)][_0x3157c2(0xfc)]&&console[_0x3157c2(0x183)]('Being\x20monitored\x20by\x20'+_0x6f174e[_0x3157c2(0x1c9)][_0x3157c2(0xfc)]);}}),addCommonOptions(_0x5d78cb,_0x419ce3(0x147)),_0x5d78cb['command']('createService\x20[<cloudId>]\x20[<user>]')[_0x419ce3(0x1a4)](_0x419ce3(0x115)+_0x419ce3(0x1fc)+_0x419ce3(0x178)+'-\x20\x20create\x20and\x20start\x20the\x20service\x20with\x20\x22sudo\x20ztedge-client\x20createService\x20...\x22')['option'](_0x419ce3(0xca),_0x419ce3(0x142))[_0x419ce3(0xbf)]('--device-name\x20<name>',_0x419ce3(0x22b),myParseString,a0_0x42d965['hostname']())['action'](async function(_0x58a866,_0x59e41a,_0x24b354){const _0x10d6ee=_0x419ce3;if(!await a0_0x40e05b())throw new ErrorWithoutStacktrace('Must\x20be\x20run\x20as\x20sudo');if(tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20currently\x20active');let _0x38bf43=_0x24b354[_0x10d6ee(0x1bb)],_0x5f0860=await findMatchingProfile(_0x58a866,_0x59e41a,_0x38bf43),_0x304ce5=_0x10d6ee(0x1a2)+_0x24b354[_0x10d6ee(0xf2)]+'\x22';_0x24b354[_0x10d6ee(0xc1)]&&(_0x304ce5+='\x20--ignoreCertificateErrors');_0x24b354[_0x10d6ee(0x199)]&&(_0x304ce5+=_0x10d6ee(0x227));_0x24b354[_0x10d6ee(0x168)]&&(_0x304ce5+='\x20--debug');_0x24b354[_0x10d6ee(0x1bb)]&&(_0x304ce5+='\x20--device-name\x20\x22'+_0x24b354[_0x10d6ee(0x1bb)]+'\x22');_0x304ce5+=_0x10d6ee(0x1eb);let _0x16d172=a0_0x42c640['join'](__dirname,_0x10d6ee(0x16e)),_0x2e7bdd='[Unit]\x0a'+_0x10d6ee(0xd2)+'\x0a'+_0x10d6ee(0x208)+_0x10d6ee(0x22f)+_0x10d6ee(0x252)+(_0x10d6ee(0xc8)+_0x16d172+_0x10d6ee(0x161)+_0x5f0860['tenant']+'\x22\x20\x22'+_0x5f0860[_0x10d6ee(0x107)]+'\x22\x20'+_0x304ce5+'\x0a')+'\x0a'+'[Install]\x0a'+_0x10d6ee(0x23e);await a0_0x1b3cea[_0x10d6ee(0x116)]('/etc/systemd/system/ztedge.service',_0x2e7bdd,'utf8');let _0x5c0b0c=await execNoThrow(_0x10d6ee(0xde));if(_0x5c0b0c[_0x10d6ee(0xf3)])throw new ErrorWithoutStacktrace(_0x10d6ee(0x1e3)+execError(_0x5c0b0c));if(_0x24b354[_0x10d6ee(0x1d0)]){_0x5c0b0c=await execNoThrow(_0x10d6ee(0x1be));if(_0x5c0b0c[_0x10d6ee(0xf3)])throw new ErrorWithoutStacktrace(_0x10d6ee(0x21c)+execError(_0x5c0b0c));_0x5c0b0c=await execNoThrow(_0x10d6ee(0x22c));if(_0x5c0b0c[_0x10d6ee(0xf3)])throw new ErrorWithoutStacktrace('Unable\x20to\x20start\x20ztedge\x20service:\x20'+execError(_0x5c0b0c));process[_0x10d6ee(0xe0)][_0x10d6ee(0x220)](_0x10d6ee(0x124));for(let _0x47b0d7=0x0;_0x47b0d7<0x5;++_0x47b0d7){await a0_0x27b860[_0x10d6ee(0x1d9)](0x3e8),process[_0x10d6ee(0xe0)][_0x10d6ee(0x220)]('.');}console[_0x10d6ee(0x183)](),_0x5c0b0c=await execNoThrow(_0x10d6ee(0x195)),console[_0x10d6ee(0x183)](execError(_0x5c0b0c)),console[_0x10d6ee(0x183)]('Use\x20\x22journalctl\x20-u\x20ztedge\x20|\x20tail\x22\x20to\x20see\x20any\x20service\x20messages');}else console['log'](_0x10d6ee(0x21a));}),addCommonOptions(_0x5d78cb,_0x419ce3(0x14e)),![]&&process[_0x419ce3(0x237)][_0x419ce3(0x20f)]===0x2&&__dirname[_0x419ce3(0x20a)](_0x419ce3(0x1ae))&&(console[_0x419ce3(0x183)](_0x419ce3(0xe6)),process[_0x419ce3(0x237)]=['','',...cmd['trim']()[_0x419ce3(0x170)](/ +/)]),await _0x5d78cb[_0x419ce3(0xd8)](process['argv']);}catch(_0x5206a2){_0x5206a2[_0x419ce3(0x259)]===_0x419ce3(0x1ce)?console['log'](_0x5206a2[_0x419ce3(0x143)]):console[_0x419ce3(0x183)](_0x5206a2),process[_0x419ce3(0x1dd)]=0x1;}!shutdownInProgress&&process['exit']();}main();