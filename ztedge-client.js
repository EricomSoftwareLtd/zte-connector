const a0_0x265bbc=a0_0xfaa5;(function(_0x400c68,_0x49a191){const _0x4c45db=a0_0xfaa5,_0x1cdcc7=_0x400c68();while(!![]){try{const _0x105645=-parseInt(_0x4c45db(0x18c))/0x1+-parseInt(_0x4c45db(0x1d1))/0x2*(-parseInt(_0x4c45db(0x1d5))/0x3)+-parseInt(_0x4c45db(0x1ec))/0x4+parseInt(_0x4c45db(0x207))/0x5*(-parseInt(_0x4c45db(0x254))/0x6)+-parseInt(_0x4c45db(0x19f))/0x7+parseInt(_0x4c45db(0x1aa))/0x8+-parseInt(_0x4c45db(0x169))/0x9*(-parseInt(_0x4c45db(0x22d))/0xa);if(_0x105645===_0x49a191)break;else _0x1cdcc7['push'](_0x1cdcc7['shift']());}catch(_0x36df58){_0x1cdcc7['push'](_0x1cdcc7['shift']());}}}(a0_0x1848,0xac6e7));const CLIENT_VERSION=a0_0x265bbc(0x107),CLIENT_PLATFORM='linux';import a0_0xd23ba3 from'util';import a0_0x3ddb2a from'child_process';import a0_0x57d639 from'path';import a0_0x5c60c8 from'http';function a0_0x1848(){const _0x283213=['0.0.0.0/0','userMessage','\x20=>\x20','gsettings\x20set\x20org.gnome.system.proxy\x20mode\x20','ErrorWithoutStacktrace','Address\x20=\x20','tmpdir','keepAliveFrequencySec','Connected\x20to:\x20','Error:\x20','ListenPort\x20=\x20','debug','3.5.0','dev-zteapi.ericomcloud.net','health\x20check\x20port\x20(0\x20for\x20none)','Invalid\x20username\x20or\x20password','privateKey','monitor','option','location','\x20--device-name\x20','random','Process\x20upgrade\x20isService=','No\x20matching\x20profiles','launchFromToken\x20<cloudId>\x20<user>\x20<token>','*****\x20Using\x20hardwired\x20command\x20line\x20*****','5bzIAIs','Start\x20monitoring','ZTEdge\x20tunnel\x20is\x20currently\x20active','exec','\x09(.+?)\x09(.+?)\x09(.+?)\x09(.+?)\x09','Tunnel\x20started','sudo\x20iptables\x20-D\x20POSTROUTING\x20-t\x20nat\x20-o\x20','tenant','statusCode','Must\x20be\x20run\x20as\x20sudo','-v|--verbose','startsWith','defaultInterface','::/0','.zerotrustedge.com:8444/api/client/getlogininformation','Comma\x20separated\x20list\x20of\x20folders\x20and\x20files\x20containing\x20additional\x20CA\x20certificates.','trim','toString','setPacFile','List\x20the\x20currently\x20available\x20profiles\x0a','listen','Use\x20\x22journalctl\x20-u\x20ztedge\x20|\x20tail\x22\x20to\x20see\x20any\x20service\x20messages','Create\x20and\x20maintain\x20connections\x20to\x20ZTEdge','Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x0a','headers','ignoreCertificateErrors','postureChecks',';\x20\x20upgradeMode=','--ca-certificates\x20<certs>','Authentication\x20failed:\x20','status','pacFile','qa-zteapi.ericomcloud.net','password','.zerotrustedge.com:8444/api/v1/ztedge/client/${api}/','/opt/google/chrome/chrome\x20--incognito\x20\x22','keyPair','Profile\x20does\x20not\x20exist','20ekzzrx','floor','Authenticated\x20and\x20authorized','all','clientData','authenticationURL','You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20If\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a','Warning:\x20','Peer\x20creation\x20failed:\x20','IP:\x20','-b|--background','cannot\x20parse\x20version\x20','\x20>\x20','listening','proxySettings','commands','text/html;\x20charset=UTF-8','Use\x20browser\x20based\x20authentication','none','health\x20check\x20path','how\x20long\x20the\x20connection\x20should\x20be\x20down\x20(sec)\x20for\x20health\x20check\x20failure','launchFromToken','release','installerCommandLine','Description=ZTEdge\x0a','getClientSettingsFrequencySec','unlink','stdout','0600','description','&platform=','mode','&redirect_uri=','down','stream','ZTE_UPGRADE_FILE','fileURLToPath','currentVersionCanConnect','PublicKey\x20=\x20','7977738BJhwXF','SHORT_TIMES','authenticateOnly','Create\x20a\x20new\x20profile\x20and\x20start\x20the\x20tunnel.\x0a','------------------------','.conf','Downloading\x20update\x20package.','Shutdown\x20connector\x20routing','ztedge','utf8','map','find','Unable\x20to\x20connect\x20to\x20IAM\x20server\x20','\x20already\x20exists.\x20\x20Use\x20--force\x20to\x20replace\x20it.','service','/opt/google/chrome/chrome','tunnel','serverPublicKey','device\x20name','systemctl\x20status\x20ztedge','now','auto','assign','padEnd','any','Got\x20http\x20response\x20','launch','Invalid\x20credentials','\x20--verbose','Tunnel\x20is\x20not\x20running\x20...\x20','Proxy\x20settings\x20cleared','authenticationType','lsb_release\x20-d\x20-s','new\x20<cloudId>\x20<user>','gatewayDns','argv','Connected\x20as:\x20','Logout\x20failed:\x20','import','sudo\x20wg\x20show\x20ztedge\x20dump','private','echo\x201\x20|\x20sudo\x20tee\x20/proc/sys/net/ipv4/ip_forward','get','.\x20\x20Perhaps\x20there\x20is\x20a\x20certificate\x20issue.','/tmp/ztedge-client.log','join','upgrade\x20if\x20available','Tunnel\x20not\x20functioning\x20properly','code','SIGTERM','verbose','Stopping\x20tunnel','Multiple\x20profiles\x20match','Cannot\x20resolve\x20','--no-start','-gateway.zerotrustedge.com','Saved\x20','<h1>Authentication\x20Succeeded</h1>','[\x20short\x20times\x20]','[Unit]\x0a','connector','--health-check-port\x20<port>','extname','--connector','healthCheckPort','session_state','assignedIpAddress','username\x20is\x20required\x20for\x20a\x20pre-3.5\x20server\x20and/or\x20if\x20a\x20password\x20is\x20required\x20to\x20authenticate','--password\x20<password>','--health-check-path\x20<path>','\x22\x20\x22','newApiTemplate','hide','inform','webAuthenticate','contains','downloadProgress','authentication\x20redirect\x20error:\x20','/clientLogout','isConnector','SIGINT','log','clientSettings','--browser','Logging\x20to\x20','sudo\x20resolvconf\x20-d\x20ztedge','\x20seconds\x20...\x20','action','4.0.6','--reconnectTimeoutSec\x20<num>','^(.*)','browser','sudo\x20ip\x20link\x20delete\x20dev\x20','AllowedIps\x20=\x20','ZTEDGE','mkdir','findSpanningList','filter','Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20was\x20not\x20specified.','--device-name\x20<name>','Cannot\x20contact\x20tenant.\x20','systemctl\x20daemon-reload','isTTY','keepAlive','gsettings\x20get\x20org.gnome.system.proxy\x20autoconfig-url','-\x20\x20create\x20and\x20start\x20the\x20service\x20with\x20\x22sudo\x20ztedge-client\x20createService\x20...\x22','Tunnel\x20did\x20not\x20start.\x20\x20Install\x20openresolv\x20with\x20\x27sudo\x20apt\x20install\x20openresolv\x27','#\x20deviceInfo\x20=\x20','send','wg-quick\x20down\x20','-f|--force','Aborting\x20ztedge-client','pubkey','min','length','version','publicKey','stderr','access','deviceName','background','pipe','networkInterfaces','json','authenticated','----\x20GET\x20','ztedge-client','http://127.0.0.1:','--authenticateOnly|--authenticate-only','PrivateKey\x20=\x20','${api}','$body$','Created\x20','--listen-port\x20<port>','\x20--ca-certificates\x20\x22','getLoginInformationUrl','DEFAULT_CLOUD_NATIVE','postureCheckFrequencySec','incoming\x20UDP\x20port','state','No\x20saved\x20profiles','sleepTill','createDevice','WantedBy=multi-user.target\x0a','statusMessage','--service','Will\x20match\x20an\x20existing\x20profile\x20based\x20on\x20the\x20supplied\x20<cloudId>\x20and\x20<user>.\x0a','username\x20must\x20be\x20specified','parse','Running\x20as\x20a\x20service','RestartSec=15s\x0a','user','Run\x20connection\x20in\x20the\x20background','Upgrade\x20log\x20will\x20be\x20in\x20','restorePac','Will\x20try\x20to\x20reconnect\x20in\x20','_name','url','/api/v1/ztedge/client/authenticated/','DNS\x20=\x20','gatewayServicesUrl','rm\x20-f\x20','----\x20POST\x20','deviceInfo','systemctl\x20start\x20ztedge','--health-check-timeout\x20<sec>','ExecStart=','error','ipHeuristicsEnabled','Show\x20the\x20current\x20tunnel\x20status','AuthenticateDevice','doNewApiLaunchTunnel\x20wg-quick\x20result','https://','do\x20not\x20monitor\x20the\x20connection.\x20\x20When\x20monitored,\x20exit\x20with\x20SIGTERM\x20or\x20SIGINT\x20or\x20\x22ztedge-client\x20down\x22','gsettings\x20set\x20org.gnome.system.proxy\x20autoconfig-url\x20\x27','\x20not\x20found.','post','readFile','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a\x20\x20<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22utf-8\x22>\x0a\x20\x20\x20\x20<title>ZTEdge</title>\x0a\x20\x20</head>\x0a\x20\x20<body>\x0a\x20\x20\x20\x20$body$\x0a</html>','Tunnel\x20did\x20not\x20start:\x0a','Upgrade\x20failed:\x20','query','read\x20from\x20the\x20root\x20user\x27s\x20profile\x20folder','ignore\x20certificate\x20errors','Upgrade\x20by\x20running\x20the\x20command:\x20','authenticationInfo','16249419buViND','Cannot\x20contact\x20tenant\x20','/api/v1/ztedge/client/SystemVersionAndTenantFeatures/','oldMode','message','command','name','createService','Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20is\x20needed\x20and\x20was\x20not\x20specified.','Send\x20shutdown\x20again\x20to\x20force\x20immediate\x20shutdown','createPeer','ZTEdge\x20tunnel\x20is\x20not\x20currently\x20active','devicePrivateKey','readdir','/api/v1/ztedge/client/${api}/','Create\x20a\x20service\x20named\x20\x22ztedge\x22\x20which\x20will\x20control\x20the\x20specified\x20connection.\x0a','application/x-www-form-urlencoded','includes','Did\x20not\x20get\x20expected\x20status.\x20\x20Received\x20','/32','The\x20configuration\x20file\x20for\x20the\x20current\x20tunnel\x20has\x20been\x20deleted.\x20\x20Attempting\x20to\x20shutdown\x20anyway\x20...','up\x20[<cloudId>]\x20[<user>]','import\x20<file>\x20[<user>]','userId','wg\x20genkey','upgradeOnlyIfNotUsable','authenticatedUrl','env','deviceType','Enable\x20routing','serverEndpoint','exitCode','stdin','max','Cannot\x20update\x20client\x20settings:\x20','1022755hVMWkT','staging-zteapi.ericomcloud.net','Error\x20launching\x20external\x20browser:\x20','product','upgradeInfo','wg-quick\x20up\x20','write','endsWith','Tunnel\x20not\x20launched','Password\x20for\x20','monitorPid','ztedge\x20service\x20created,\x20but\x20not\x20started\x20or\x20enabled','\x20-j\x20MASQUERADE','(.*)','\x20up\x20\x22','Server\x20told\x20us\x20to\x20shutdown\x20connection:\x20','authentication','Only\x20one\x20such\x20service\x20can\x20be\x20in\x20effect.\x20\x20This\x20will\x20not\x20have\x20access\x20to\x20profiles\x20create\x20w/o\x20sudo.\x0a','Check\x20tunnel\x20handshake\x20=>\x20','2022713gQlfJm','ericomshield.crt','\x20----','healthCheckTimeout','resolve','ip\x20route\x20show\x20default','hostname','Tunnel\x20is\x20functioning\x20properly','Requires\x20ztedge\x20server\x20version\x20>=\x203.5','createServer','authenticationToken','1508616XdvoXE','start','padStart','PersistentKeepalive\x20=\x205\x0a','Do\x20everything\x20except\x20for\x20launching\x20the\x20tunnel','replace','Unable\x20to\x20start\x20ztedge\x20service:\x20','Request\x20PID\x20','userName','Tunnel\x20is\x20not\x20active','Starting\x20service\x20.','Exiting\x20because\x20this\x20software\x20version\x20cannot\x20be\x20used.','body','set-cookie','clientPing','CLOUD_NATIVE','healthCheckPath','gsettings\x20get\x20org.gnome.system.proxy\x20mode','waitFor','[Peer]\x0a','pid','caCertificates','/clientPing','addCAs','connectionAllowed','--pingIntervalSec\x20<num>','Unable\x20to\x20restore\x20system\x20proxy:\x20','string','data','Restart=on-failure\x0a','Health\x20check\x20listening\x20on\x20http://localhost:','end','/auth_resp','question','oldProxyPac','dnsServers','PAC\x20file\x20set:\x20','{installPackage}','\x20--debug','20GifITv','Error\x20talking\x20to\x20gateway:\x20','resolvconf:\x20command\x20not\x20found','match','2631QhYTYM','exit','Authorization\x20failed\x20(unknown\x20reason)','writeFile','How\x20often\x20to\x20ping\x20the\x20gateway','stringify','.ztedge','/usr/local/share/ca-certificates','.zerotrustedge.com:8444/api/client/authenticated','sleepMs','systemVersion','Would\x20you\x20like\x20to\x20upgrade\x20now\x20(y/n)\x20?\x20','---','Proxy\x20mode\x20restored\x20to\x20','cloud-native','--no-launch','force','Service\x20creation\x20error:\x20','<h1>Authentication\x20Failed</h1>','---\x20system\x20info\x20----','push','supportsClientPing','How\x20long\x20(since\x20the\x20last\x20successful\x20ping\x20to\x20initiate\x20a\x20reconnect)\x20','1842852zPCLYZ'];a0_0x1848=function(){return _0x283213;};return a0_0x1848();}import a0_0x2c6bd5 from'os';import{promises as a0_0x57db88}from'dns';import{promises as a0_0x4d961d,createWriteStream}from'fs';import a0_0x3b0908 from'url';import a0_0x4bf477 from'readline-sync';import a0_0x20df04 from'got';import a0_0x575d30 from'find-free-port';import a0_0x464b7d from'password-prompt';import a0_0xcaf97e from'temp';import a0_0x18cda6 from'is-elevated';import*as a0_0x403324 from'commander';import*as a0_0xed0e70 from'syswide-cas';import*as a0_0x16d537 from'cidr-tools';import a0_0x2a42bf from'express';import*as a0_0x556804 from'./utils.js';const __dirname=a0_0x57d639['dirname'](a0_0x3b0908[a0_0x265bbc(0x251)](import.meta[a0_0x265bbc(0x14c)])),exec=a0_0xd23ba3['promisify'](a0_0x3ddb2a[a0_0x265bbc(0x20a)]),DEFAULT_CA_FOLDER=a0_0x265bbc(0x1dc),deviceFolder=a0_0x57d639[a0_0x265bbc(0x281)](a0_0x2c6bd5['homedir'](),a0_0x265bbc(0x1db)),TUNNEL_INTERFACE_NAME=a0_0x265bbc(0x25c),runningConfigFile=a0_0x57d639[a0_0x265bbc(0x281)](a0_0x2c6bd5[a0_0x265bbc(0x1f3)](),TUNNEL_INTERFACE_NAME+a0_0x265bbc(0x259)),sep=a0_0x265bbc(0x1e1),SHIELD_CA_CERTIFICATES=[a0_0x57d639[a0_0x265bbc(0x281)](__dirname,a0_0x265bbc(0x1a0))],PRODUCT={'ZTEDGE':a0_0x265bbc(0x25c),'CLOUD_NATIVE':a0_0x265bbc(0x1e3)},CLOUD_NATIVE_HOSTS={'dev':a0_0x265bbc(0x1fa),'qa':a0_0x265bbc(0x227),'staging':a0_0x265bbc(0x18d),'cloud':'zteapi.ericomcloud.net'};let REDIRECT_URL,REDIRECT_PORT,shutdownInProgress=0x0,DEFAULT_CLOUD_NATIVE=process[a0_0x265bbc(0x184)][a0_0x265bbc(0x137)]??'cloud';async function webGet(_0x3feaec,_0x5f4716,_0x1c4914){const _0x3d2f4e=a0_0x265bbc;debugLog(_0x1c4914,_0x3d2f4e(0x12c)+_0x3feaec+_0x3d2f4e(0x1a1));try{let _0x3ad2c9=await a0_0x20df04(_0x3feaec,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x3d2f4e(0x12a),'https':{'rejectUnauthorized':_0x5f4716},'timeout':{'request':0x1e*0x3e8}});return debugLog(_0x1c4914,_0x3ad2c9[_0x3d2f4e(0x1b6)]),debugLog(_0x1c4914,_0x3d2f4e(0x258)),_0x3ad2c9['body'];}catch(_0x52120e){debugLog(_0x1c4914,'Error:\x20'+_0x52120e[_0x3d2f4e(0x16d)]),debugLog(_0x1c4914,_0x3d2f4e(0x258));throw _0x52120e;}}async function isValidZteTenant(_0x857b03,_0x5ae289){const _0x579ab9=a0_0x265bbc;try{let _0x434c98=_0x579ab9(0x15b)+_0x857b03+'.zerotrustedge.com:8444/api/v1/ztedge/client/SystemVersionAndTenantFeatures/'+_0x857b03+'?version='+CLIENT_VERSION+_0x579ab9(0x24b)+CLIENT_PLATFORM,_0x1ede45=await webGet(_0x434c98,!_0x5ae289['ignoreCertificateErrors'],_0x5ae289);return _0x1ede45;}catch(_0x1378b4){return null;}}async function isValidCloudNativeTenant(_0x4d6061,_0x35fcf9,_0x568f65){const _0x49186b=a0_0x265bbc;let _0x3620b4=CLOUD_NATIVE_HOSTS[_0x35fcf9]??_0x35fcf9;try{let _0x28affd=_0x49186b(0x15b)+_0x3620b4+_0x49186b(0x16b)+_0x4d6061+'?version='+CLIENT_VERSION+'&platform='+CLIENT_PLATFORM,_0x158b88=await webGet(_0x28affd,!_0x568f65[_0x49186b(0x220)],_0x568f65);return _0x158b88;}catch(_0x1ce992){return null;}}async function adjustTenantName(_0x24a71a,_0x505ca7){const _0x456f15=a0_0x265bbc;let _0x5bd747=_0x24a71a['match'](/(.*)@(.*)/);if(_0x5bd747){let _0x36b560=await isValidCloudNativeTenant(_0x5bd747[0x1],_0x5bd747[0x2],_0x505ca7);if(_0x36b560)return{'tenant':_0x5bd747[0x1],'cloudNative':_0x5bd747[0x2],'systemInfo':_0x36b560};}else{let _0x1f0529=await isValidZteTenant(_0x24a71a,_0x505ca7);if(_0x1f0529)return{'tenant':_0x24a71a,'cloudNative':null,'systemInfo':_0x1f0529};let _0x9d7326=await isValidCloudNativeTenant(_0x24a71a,DEFAULT_CLOUD_NATIVE,_0x505ca7);if(_0x9d7326)return{'tenant':_0x24a71a,'cloudNative':DEFAULT_CLOUD_NATIVE,'systemInfo':_0x9d7326};}throw new ErrorWithoutStacktrace(_0x456f15(0x16a)+_0x24a71a+_0x456f15(0x27f));}async function getCloudData(_0x67cff2,_0x297401){const _0x3b982f=a0_0x265bbc;let {tenant:_0x5c3e34,cloudNative:_0x456a9b,systemInfo:_0x4c7b1b}=await adjustTenantName(_0x67cff2,_0x297401),_0x83905e;if(_0x456a9b){let _0x4b1913=CLOUD_NATIVE_HOSTS[_0x456a9b]??_0x456a9b;_0x83905e={'tenant':_0x5c3e34,'getLoginInformationUrl':_0x3b982f(0x15b)+_0x4b1913+'/api/v1/ztedge/client/getlogininformation/'+_0x5c3e34,'authenticatedUrl':_0x3b982f(0x15b)+_0x4b1913+_0x3b982f(0x14d)+_0x5c3e34,'gwName':null,'newApiTemplate':'https://'+_0x4b1913+_0x3b982f(0x177)+_0x5c3e34};}else _0x83905e={'tenant':_0x5c3e34,'getLoginInformationUrl':_0x3b982f(0x15b)+_0x5c3e34+_0x3b982f(0x215),'authenticatedUrl':_0x3b982f(0x15b)+_0x5c3e34+_0x3b982f(0x1dd),'gwName':_0x5c3e34+_0x3b982f(0x28b),'newApiTemplate':_0x3b982f(0x15b)+_0x5c3e34+_0x3b982f(0x229)+_0x5c3e34};return{'cloudData':_0x83905e,'systemInfo':_0x4c7b1b};}class ErrorWithoutStacktrace extends Error{constructor(_0x505a45){const _0xf1eaa1=a0_0x265bbc;super(_0x505a45),this[_0xf1eaa1(0x16f)]=_0xf1eaa1(0x1f1);}}async function callZteApi(_0x32b1e6,_0x4ad1ad,_0x44b1e1,_0x29b711){const _0x123806=a0_0x265bbc;let _0x2c234e;_0x32b1e6=_0x44b1e1[_0x123806(0xf6)]['replace'](_0x123806(0x131),_0x32b1e6);try{debugLog(_0x29b711,_0x123806(0x151)+_0x32b1e6+_0x123806(0x1a1)),debugLog(_0x29b711,_0x4ad1ad),_0x2c234e=await a0_0x20df04[_0x123806(0x15f)](_0x32b1e6,{'json':_0x4ad1ad,'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x123806(0x12a),'https':{'rejectUnauthorized':!_0x44b1e1['ignoreCertificateErrors']},'timeout':{'request':0x1e*0x3e8}}),debugLog(_0x29b711,_0x2c234e['body']),debugLog(_0x29b711,_0x123806(0x258));}catch(_0x47324b){debugLog(_0x29b711,_0x47324b['message']),debugLog(_0x29b711,'------------------------');throw new ErrorWithoutStacktrace(_0x123806(0x113)+_0x47324b['message']);}if(_0x2c234e[_0x123806(0x20f)]!==0xc8)throw new ErrorWithoutStacktrace(_0x123806(0x26d)+_0x2c234e['statusCode']+':\x20'+_0x2c234e[_0x123806(0x13f)]);return _0x2c234e[_0x123806(0x1b6)];}async function readPassword(_0x50726b,_0x1c8e2a=a0_0x265bbc(0xf7)){const _0x26ffb6=a0_0x265bbc;if(process[_0x26ffb6(0x189)][_0x26ffb6(0x115)])return await a0_0x464b7d(_0x50726b,{'method':_0x1c8e2a});else throw new ErrorWithoutStacktrace('Password\x20can\x20only\x20be\x20read\x20from\x20a\x20tty');}function canonicalizeVersionString(_0x50ef70,_0x6e0eff){const _0x3b5f6e=a0_0x265bbc;let _0x236a6d=_0x50ef70[_0x3b5f6e(0x1d4)](/(\d+)[.](\d+)(?:[.](\d+))?/);if(_0x236a6d){const [,_0x1deaf7,_0x3d1b7e,_0x20d2d2]=_0x236a6d;return _0x1deaf7[_0x3b5f6e(0x1ac)](0x4,'0')+_0x3d1b7e[_0x3b5f6e(0x1ac)](0x4,'0')+(_0x20d2d2??'0')[_0x3b5f6e(0x1ac)](0x4,'0');}else return _0x6e0eff&&newError(_0x3b5f6e(0x156),_0x3b5f6e(0x238)+_0x50ef70),null;}function versionLTE(_0x6ded71,_0xa2016c){let _0xf95e6c=canonicalizeVersionString(_0x6ded71,!![]),_0xcc2bf6=canonicalizeVersionString(_0xa2016c,!![]);return _0xf95e6c<=_0xcc2bf6;}function versionLT(_0x49be02,_0x5c806e){let _0x466191=canonicalizeVersionString(_0x49be02,!![]),_0x4451ee=canonicalizeVersionString(_0x5c806e,!![]);return _0x466191<_0x4451ee;}function versionGTE(_0x39712a,_0x26af20){let _0x59b9c2=canonicalizeVersionString(_0x39712a,!![]),_0x15e104=canonicalizeVersionString(_0x26af20,!![]);return _0x59b9c2>=_0x15e104;}const PAGE_FRAME=a0_0x265bbc(0x161);function startHttpListener(_0x434586,_0x35ed13){const _0x36c862=a0_0x265bbc;let _0x54be0a=a0_0x5c60c8[_0x36c862(0x1a8)](function(_0x19e4b8,_0x4a8f78){const _0xec7746=_0x36c862;let _0x22a7f9='';_0x19e4b8['on'](_0xec7746(0x1c6),_0x4819e0=>{_0x22a7f9+=_0x4819e0;}),_0x19e4b8['on'](_0xec7746(0x1c9),()=>{const _0x4eba88=_0xec7746;let _0xdc33ce=_0x35ed13(_0x19e4b8[_0x4eba88(0x14c)],_0x22a7f9);_0x22a7f9='',_0x4a8f78['writeHead'](0xc8,{'Content-Type':_0x4eba88(0x23d)});let _0x48baf4=PAGE_FRAME[_0x4eba88(0x1af)](_0x4eba88(0x132),_0xdc33ce);_0x4a8f78['end'](_0x48baf4);});});return _0x54be0a[_0x36c862(0x21b)](_0x434586),_0x54be0a;}async function handleBrowser(_0x144798,_0x4a46a7,_0x127090,_0x434d2f,_0x656509){const _0x3db227=a0_0x265bbc;let _0x36eefe;const _0x1c2674=new Promise((_0x18d2e0,_0x5c38da)=>{let _0x240130=startHttpListener(REDIRECT_PORT,(_0x13fb98,_0x510912)=>{const _0x33b037=a0_0xfaa5;return _0x36eefe=a0_0x3b0908['parse'](_0x13fb98,!![])[_0x33b037(0x164)],(!_0x36eefe[_0x33b037(0x13a)]||!_0x36eefe[_0x33b037(0x284)]||!_0x36eefe[_0x33b037(0xf0)])&&(_0x36eefe=null),_0x18d2e0(),_0x36eefe?_0x33b037(0xe8):_0x33b037(0x1e7);});});let _0x574bac=_0x4a46a7+(_0x3db227(0x24d)+REDIRECT_URL);if(![]&&await fileExists(_0x3db227(0x263)))exec(_0x3db227(0x22a)+_0x574bac+'\x22');else{if(Promise[_0x3db227(0x26c)]){let _0x176595,_0x34a60c=0x3e8;try{_0x176595=await Promise[_0x3db227(0x26c)]([execNoThrow('sensible-browser\x20\x22'+_0x574bac+'\x22'),a0_0x556804[_0x3db227(0x1de)](_0x34a60c)]);}catch(_0x3c8038){throw new ErrorWithoutStacktrace('Error\x20launching\x20external\x20browser:\x20'+_0x3c8038[_0x3db227(0x16d)]);}if(_0x176595!==_0x34a60c&&_0x176595[_0x3db227(0x284)]!==0x0){let _0x41de86=_0x176595['stdout'][_0x3db227(0x217)]();_0x41de86&&(_0x41de86+='\x0a');_0x41de86+=_0x176595['stderr'][_0x3db227(0x217)]();throw new ErrorWithoutStacktrace(_0x3db227(0x18e)+_0x41de86);}}else execNoThrow('sensible-browser\x20\x22'+_0x574bac+'\x22');}await _0x1c2674;if(!_0x36eefe)throw new ErrorWithoutStacktrace(_0x3db227(0x1d7));return _0x36eefe;}async function handleUserPassword(_0x1b3caf,_0x3d94fc,_0x2050d5,_0xa99676){const _0x44a729=a0_0x265bbc;let _0x491cc7=_0x3d94fc+(_0x44a729(0x24d)+REDIRECT_URL),_0x2bd7c9;if(!_0xa99676&&!process['stdin']['isTTY'])throw new ErrorWithoutStacktrace('Can\x20only\x20read\x20password\x20from\x20a\x20TTY');try{_0x2bd7c9=await a0_0x20df04(_0x491cc7,{'throwHttpErrors':![],'retry':{'limit':0x0},'https':{'rejectUnauthorized':!_0x1b3caf[_0x44a729(0x220)]},'timeout':{'request':0xf*0x3e8}});if(_0x2bd7c9['statusCode']!==0xc8)throw new ErrorWithoutStacktrace(_0x44a729(0xfc)+_0x2bd7c9[_0x44a729(0x20f)]+':\x20'+_0x2bd7c9[_0x44a729(0x13f)]);!_0xa99676&&(_0xa99676=await readPassword(_0x44a729(0x195)+_0x2050d5+':\x20'));}catch(_0x44e76){let _0x1c62d6=new URL(_0x3d94fc);throw new ErrorWithoutStacktrace(_0x44a729(0x260)+_0x1c62d6['hostname']+':\x20'+_0x44e76[_0x44a729(0x16d)]);}let _0x1e77d9=_0x2bd7c9[_0x44a729(0x1b6)]['match'](/action="(.*?)"/),_0x5ca15e=_0x1e77d9[0x1][_0x44a729(0x1af)](/&amp;/g,'&'),_0x4ffb4d=_0x2bd7c9[_0x44a729(0x21f)][_0x44a729(0x1b7)][_0x44a729(0x25e)](_0x42bc27=>{let _0x537ec6=_0x42bc27['match'](/^(.*?)=(.*?);/);return _0x537ec6[0x1]+'='+_0x537ec6[0x2];})[_0x44a729(0x281)](';\x20'),_0x5a13c1=await a0_0x20df04[_0x44a729(0x15f)](_0x5ca15e,{'headers':{'cookie':_0x4ffb4d,'content-type':_0x44a729(0x179)},'form':{'username':_0x2050d5,'password':_0xa99676},'throwHttpErrors':![],'retry':{'limit':0x0},'followRedirect':![],'https':{'rejectUnauthorized':!_0x1b3caf[_0x44a729(0x220)]}});if(_0x5a13c1[_0x44a729(0x20f)]===0xc8){let _0x499538=_0x5a13c1[_0x44a729(0x1b6)][_0x44a729(0x17a)](_0x44a729(0x1fc));if(_0x499538)throw new ErrorWithoutStacktrace(_0x44a729(0x26f));}else{if(_0x5a13c1[_0x44a729(0x20f)]!==0x12e)throw new ErrorWithoutStacktrace(_0x44a729(0x17b)+_0x5a13c1[_0x44a729(0x20f)]+':\x20'+_0x5a13c1['statusMessage']);}if(!_0x5a13c1[_0x44a729(0x21f)][_0x44a729(0x200)])throw new ErrorWithoutStacktrace('Did\x20not\x20receive\x20authentication\x20information');let _0x3869d6=a0_0x3b0908['parse'](_0x5a13c1[_0x44a729(0x21f)][_0x44a729(0x200)],!![])['query'];if(!_0x3869d6[_0x44a729(0x13a)]||!_0x3869d6['code']||!_0x3869d6[_0x44a729(0xf0)])throw new ErrorWithoutStacktrace('Authorization\x20failed\x20(unknown\x20reason)');return _0x3869d6;}async function getOs(){const _0x14139f=a0_0x265bbc;let _0x3d2945=a0_0x2c6bd5['platform']()+'\x20'+a0_0x2c6bd5[_0x14139f(0x243)]();try{let _0x22ceb2=await exec(_0x14139f(0x274));_0x3d2945=_0x22ceb2[_0x14139f(0x248)]?.[_0x14139f(0x217)]()??_0x3d2945;}catch{}return _0x3d2945;}async function doUpgrade(_0x65847f,_0x52dcc7){const _0x3639a9=a0_0x265bbc;try{console[_0x3639a9(0x100)](_0x3639a9(0x25a));let _0x5615b0=a0_0xcaf97e['path']({'suffix':a0_0x57d639[_0x3639a9(0xed)](_0x65847f[_0x3639a9(0x14c)])}),_0x39c9f2=createWriteStream(_0x5615b0),_0x1c8ca3=a0_0x20df04[_0x3639a9(0x24f)](_0x65847f[_0x3639a9(0x14c)]),_0x54dd0c=new Promise(function(_0x53ae37,_0x5c071a){const _0x550c00=_0x3639a9;_0x1c8ca3['on'](_0x550c00(0xfb),({transferred:_0x2d85dc,total:_0x45de53,percent:_0x30c8ca})=>{}),_0x1c8ca3['on'](_0x550c00(0x156),_0x780c87=>_0x5c071a(_0x780c87)),_0x39c9f2['on']('finish',()=>_0x53ae37()),_0x39c9f2['on']('error',_0x51c48d=>_0x5c071a(_0x51c48d)),_0x1c8ca3[_0x550c00(0x128)](_0x39c9f2);});await _0x54dd0c;let _0x518ce7=_0x65847f[_0x3639a9(0x244)]?_0x65847f[_0x3639a9(0x244)]:'sudo\x20bash\x20\x22{installPackage}\x22';_0x518ce7=_0x518ce7[_0x3639a9(0x1af)](_0x3639a9(0x1cf),_0x5615b0);if(_0x52dcc7[_0x3639a9(0x262)]){let _0x3d967b='/tmp/zte-upgrade.log';await fileExists(_0x3d967b)&&await a0_0x4d961d[_0x3639a9(0x247)](_0x3d967b),console[_0x3639a9(0x100)](_0x3639a9(0x148)+_0x3d967b),a0_0x3ddb2a['spawnSync']('at',[_0x3639a9(0x268)],{'input':_0x518ce7+_0x3639a9(0x239)+_0x3d967b}),process['exit'](0x0);}else{if(process['env'][_0x3639a9(0x250)]){let _0x2d1908=_0x518ce7+'\x0a'+(_0x3639a9(0x150)+_0x5615b0+'\x20'+process[_0x3639a9(0x184)][_0x3639a9(0x250)]+'\x0a');await a0_0x4d961d['writeFile'](process[_0x3639a9(0x184)]['ZTE_UPGRADE_FILE'],_0x2d1908,'utf8'),process[_0x3639a9(0x1d6)](0x0);}else console[_0x3639a9(0x100)](_0x3639a9(0x167)+_0x518ce7),process[_0x3639a9(0x1d6)](0x0);}}catch(_0x5dbe59){console['error'](_0x3639a9(0x163)+_0x5dbe59[_0x3639a9(0x16d)]);}}let didInform=![];async function processUpgrade(_0x52482d,_0x4d5681){const _0x49d3c7=a0_0x265bbc;debugLog(_0x49d3c7(0x203)+_0x4d5681?.[_0x49d3c7(0x262)]+_0x49d3c7(0x222)+_0x52482d?.[_0x49d3c7(0x24c)]);if(_0x4d5681?.[_0x49d3c7(0x182)]&&_0x52482d?.[_0x49d3c7(0x252)]===!![])return;if((_0x52482d?.[_0x49d3c7(0x24c)]??_0x49d3c7(0x23f))===_0x49d3c7(0x23f))return;else{if(!_0x4d5681[_0x49d3c7(0x262)]&&_0x52482d[_0x49d3c7(0x24c)]===_0x49d3c7(0xf8)){if(didInform&&_0x52482d[_0x49d3c7(0x252)])return;didInform=!![];let _0xc60a76;if(_0x4d5681['upgrade'])_0xc60a76=!![];else{console['log'](_0x52482d[_0x49d3c7(0x16d)]);let _0x4ba74a=a0_0x4bf477[_0x49d3c7(0x1cb)](_0x49d3c7(0x1e0));_0xc60a76=_0x4ba74a==='y';}_0xc60a76&&await doUpgrade(_0x52482d,_0x4d5681);}else await doUpgrade(_0x52482d,_0x4d5681);}!_0x52482d['currentVersionCanConnect']&&(console[_0x49d3c7(0x100)](_0x49d3c7(0x1b5)),process[_0x49d3c7(0x1d6)](0x1));}async function getSystemInfo(_0x58fb05,_0x228de5){const _0x11115f=a0_0x265bbc;let {cloudData:_0x4388db,systemInfo:_0x3db6d0}=await getCloudData(_0x58fb05,_0x228de5);!_0x3db6d0[_0x11115f(0x18f)]&&(_0x3db6d0[_0x11115f(0x18f)]=PRODUCT[_0x11115f(0x10d)]);_0x3db6d0['product']===PRODUCT[_0x11115f(0x1b9)]&&(_0x3db6d0[_0x11115f(0x1df)]=_0x3db6d0[_0x11115f(0x1df)]['replace'](/^.*-/,''));Object[_0x11115f(0x26a)](_0x3db6d0,_0x4388db);if(_0x3db6d0[_0x11115f(0x18f)]===PRODUCT[_0x11115f(0x1b9)])_0x3db6d0['sendGatewayIp']=![],_0x3db6d0[_0x11115f(0x220)]=_0x228de5[_0x11115f(0x220)]||![],_0x3db6d0[_0x11115f(0x1ea)]=!![];else{if(versionLT(_0x3db6d0[_0x11115f(0x1df)],_0x11115f(0x1f9)))throw new ErrorWithoutStacktrace(_0x11115f(0x1a7));_0x3db6d0['sendGatewayIp']=!![],_0x3db6d0[_0x11115f(0x220)]=_0x228de5[_0x11115f(0x220)]||versionLT(_0x3db6d0[_0x11115f(0x1df)],'3.5.0'),_0x3db6d0[_0x11115f(0x1ea)]=versionGTE(_0x3db6d0[_0x11115f(0x1df)],'3.4.0');}_0x3db6d0[_0x11115f(0x136)]=null,_0x3db6d0[_0x11115f(0x183)]=null,debugLog(_0x228de5,_0x11115f(0x1e8)),debugLog(_0x228de5,_0x3db6d0);let _0x1c7f3e=_0x3db6d0[_0x11115f(0x190)];return _0x1c7f3e&&_0x1c7f3e['mode']!==_0x11115f(0x23f)&&await processUpgrade(_0x1c7f3e,_0x228de5),_0x3db6d0;}async function generateKeyPair(){const _0x1f26db=a0_0x265bbc;let _0x353f6d=(await exec(_0x1f26db(0x181)))[_0x1f26db(0x248)][_0x1f26db(0x217)]();const _0x6d9b37=a0_0x3ddb2a['spawnSync']('wg',[_0x1f26db(0x11f)],{'input':_0x353f6d+'\x0a'});if(_0x6d9b37[_0x1f26db(0x225)]!==0x0)throw new ErrorWithoutStacktrace('cannot\x20generate\x20keypair');return{'public':_0x6d9b37[_0x1f26db(0x248)][_0x1f26db(0x218)]()[_0x1f26db(0x217)](),'private':_0x353f6d};}async function newApiCreateDevice(_0x176228,_0xea7d1,_0x14f1d9,_0xef4e32,_0x1851be){const _0x59dfb1=a0_0x265bbc;let _0xecea68=await generateKeyPair(),_0x3eefb2={'platform':CLIENT_PLATFORM,'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'deviceName':_0xea7d1,'deviceType':_0x1851be[_0x59dfb1(0xeb)]?'connector':_0x59dfb1(0x146),'devicePublicKey':_0xecea68['public']};_0x3eefb2[_0x59dfb1(0x185)]===_0x59dfb1(0xeb)&&(_0x3eefb2[_0x59dfb1(0x19c)]={'name':_0x14f1d9,'password':_0xef4e32});let _0x3240fe=await callZteApi(_0x59dfb1(0x13d),_0x3eefb2,_0x176228,_0x1851be);return _0x3240fe=await newApiCompleteAuthentication(_0x176228,_0x3240fe,_0x14f1d9,_0xef4e32,_0x1851be),{'authenticationInfo':_0x3240fe,'keyPair':_0xecea68,'deviceType':_0x3eefb2[_0x59dfb1(0x185)]};}function a0_0xfaa5(_0x4b55c7,_0x3e2b20){const _0x18489b=a0_0x1848();return a0_0xfaa5=function(_0xfaa52a,_0x5bb5a7){_0xfaa52a=_0xfaa52a-0xe8;let _0x15fb33=_0x18489b[_0xfaa52a];return _0x15fb33;},a0_0xfaa5(_0x4b55c7,_0x3e2b20);}async function newApiCompleteAuthentication(_0x4dd658,_0x4d76e7,_0x779d52,_0x2acfdd,_0x4f02ac){const _0x124dae=a0_0x265bbc;if(_0x4d76e7[_0x124dae(0x273)]===_0x124dae(0xf9)){if(_0x4f02ac[_0x124dae(0x262)]&&!_0x2acfdd)throw new ErrorWithoutStacktrace('Cannot\x20launch\x20ztedge\x20as\x20a\x20service\x20because\x20a\x20password\x20is\x20required');REDIRECT_PORT=(await a0_0x575d30(0xbb8))[0x0],REDIRECT_URL=_0x124dae(0x12e)+REDIRECT_PORT+_0x124dae(0x1ca);let _0x32d769;_0x4f02ac[_0x124dae(0x10a)]?_0x32d769=await handleBrowser(_0x4dd658,_0x4d76e7[_0x124dae(0x232)],_0x779d52,_0x2acfdd):_0x32d769=await handleUserPassword(_0x4dd658,_0x4d76e7['authenticationURL'],_0x779d52,_0x2acfdd),_0x4d76e7=await callZteApi('authenticationCompleted',{'code':_0x32d769[_0x124dae(0x284)],'state':_0x32d769['state'],'redirect_uri':REDIRECT_URL},_0x4dd658,_0x4f02ac);}if(_0x4d76e7['authenticationType']!==_0x124dae(0x12b))throw new ErrorWithoutStacktrace(_0x124dae(0x224)+JSON[_0x124dae(0x1da)](_0x4d76e7));return _0x4d76e7;}async function newApiAuthenticateDevice(_0x3d2adf,_0x2d9b53,_0x1cd4da,_0x559a1c){const _0x563dd6=a0_0x265bbc;let _0x561f46={'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'devicePublicKey':_0x2d9b53[_0x563dd6(0x123)],'userId':_0x2d9b53['userId']??''},_0xa5cdf7=await callZteApi(_0x563dd6(0x159),_0x561f46,_0x3d2adf,_0x559a1c);return _0xa5cdf7=await newApiCompleteAuthentication(_0x3d2adf,_0xa5cdf7,_0x2d9b53['user'],_0x1cd4da,_0x559a1c),_0xa5cdf7;}let lastSuccessfulPing=null,tunnelStartTime=null;function startHealthCheckListener(_0x52e45d){const _0x4acadc=a0_0x265bbc;let _0x42c0c0=_0x52e45d[_0x4acadc(0x1ba)];!_0x42c0c0[_0x4acadc(0x212)]('/')&&(_0x42c0c0='/'+_0x42c0c0);let _0x2da60d=_0x52e45d[_0x4acadc(0xef)],_0x146f8e=a0_0x2a42bf();_0x146f8e[_0x4acadc(0x27e)](_0x42c0c0,(_0x51a59d,_0x5915a1)=>{const _0x43081f=_0x4acadc;try{let _0x136913=lastSuccessfulPing??tunnelStartTime,_0x5457b1=(Date[_0x43081f(0x268)]()-_0x136913)/0x3e8,_0x3b2f59=_0x5457b1>_0x52e45d[_0x43081f(0x1a2)]?0x1f7:0xc8;_0x5915a1[_0x43081f(0x225)](_0x3b2f59)['send']('');}catch(_0x5f470b){console[_0x43081f(0x100)](_0x5f470b),_0x5915a1['status'](0x1f7)[_0x43081f(0x11b)]('');}});let _0x26b403=a0_0x5c60c8['createServer'](_0x146f8e);_0x26b403['on'](_0x4acadc(0x23a),()=>{const _0x4f2a62=_0x4acadc;console[_0x4f2a62(0x100)](_0x4f2a62(0x1c8)+_0x2da60d+_0x42c0c0);}),_0x26b403['listen'](_0x2da60d);}async function newApiLaunchTunnel(_0x579fdd,_0x71863d,_0xd8e21d,_0x2bcd2b){const _0x91c8db=a0_0x265bbc;if(_0x2bcd2b[_0x91c8db(0x1fe)]){process['on'](_0x91c8db(0x285),()=>initiateShutdown(_0x2bcd2b)),process['on'](_0x91c8db(0xff),()=>initiateShutdown(_0x2bcd2b)),tunnelStartTime=Date[_0x91c8db(0x268)]();_0x2bcd2b[_0x91c8db(0xef)]&&startHealthCheckListener(_0x2bcd2b);let _0x502e4a;try{_0x502e4a=await doNewApiLaunchTunnel(_0x579fdd,_0x71863d,_0xd8e21d,_0x2bcd2b);}catch(_0x242761){if(!_0x2bcd2b[_0x91c8db(0x262)])throw _0x242761;_0x2bcd2b[_0x91c8db(0x1f8)]?console[_0x91c8db(0x100)](_0x242761):console['log'](_0x242761[_0x91c8db(0x16d)]);}if(!_0x2bcd2b[_0x91c8db(0x26e)]){console[_0x91c8db(0x100)](_0x91c8db(0x194));return;}if(shutdownInProgress)return;await newApiMonitorTunnel(_0x71863d,_0xd8e21d,_0x2bcd2b,_0x502e4a?.[_0x91c8db(0x152)],_0x502e4a?.[_0x91c8db(0x101)]);}else await doNewApiLaunchTunnel(_0x579fdd,_0x71863d,_0xd8e21d,_0x2bcd2b);}async function newApiMonitorTunnel(_0x21ac35,_0x33c6a0,_0x5e4538,_0x2c280f,_0x5db523){const _0xab2c79=a0_0x265bbc;console[_0xab2c79(0x100)](_0xab2c79(0x208));let _0x291af3=Date['now'](),_0x441c42=_0x291af3,_0x4a66c0=_0x291af3;process['env'][_0xab2c79(0x255)]&&console[_0xab2c79(0x100)](_0xab2c79(0xe9));let _0x421461=Boolean(_0x5db523),_0x28549f=0x5;while(!shutdownInProgress){if(_0x421461)try{process['env'][_0xab2c79(0x255)]&&(_0x5db523[_0xab2c79(0x116)]['keepAliveFrequencySec']=0x5,_0x5db523[_0xab2c79(0x221)][_0xab2c79(0x138)]=0x1e,_0x5db523[_0xab2c79(0x101)][_0xab2c79(0x246)]=0xf);let _0x1bd8ae=_0x291af3+_0x5db523[_0xab2c79(0x116)][_0xab2c79(0x1f4)]*0x3e8,_0x10b4c2=_0x441c42+_0x5db523[_0xab2c79(0x221)][_0xab2c79(0x138)]*0x3e8,_0x2a23e0=_0x4a66c0+_0x5db523['clientSettings']['getClientSettingsFrequencySec']*0x3e8,_0xaa8059=Date[_0xab2c79(0x268)](),_0x5914c3=Math['max'](_0xaa8059+0x3e8,Math[_0xab2c79(0x120)](_0x1bd8ae,_0x10b4c2,_0x2a23e0));await a0_0x556804[_0xab2c79(0x13c)](_0x5914c3);if(shutdownInProgress)break;if(Date[_0xab2c79(0x268)]()>_0x2a23e0){try{_0x5db523=await getGatewayServices(_0xab2c79(0x101),_0x2c280f,_0x21ac35,_0x5e4538);}catch(_0x3f99ad){console[_0xab2c79(0x100)](_0xab2c79(0x18b)+_0x3f99ad['message']);}_0x4a66c0=Date[_0xab2c79(0x268)]();}if(shutdownInProgress)break;if(Date[_0xab2c79(0x268)]()>_0x1bd8ae){let _0x34ca74=await getGatewayServices(_0xab2c79(0x1b8),_0x2c280f,_0x21ac35,_0x5e4538);lastSuccessfulPing=_0x291af3=Date['now']();}if(shutdownInProgress)break;if(Date[_0xab2c79(0x268)]()>_0x10b4c2){let _0x7d450b={'postureCheckResults':{'results':[]}},_0x10ab70=await postGatewayServices(_0xab2c79(0x231),_0x7d450b,_0x2c280f,_0x21ac35,_0x5e4538);_0x441c42=Date[_0xab2c79(0x268)]();if(!_0x10ab70[_0xab2c79(0x1c2)])throw new ErrorWithoutStacktrace(_0xab2c79(0x19b)+_0x10ab70[_0xab2c79(0x1ee)]);}}catch(_0x130db5){_0x421461=![],console[_0xab2c79(0x100)](_0xab2c79(0x1d2)+_0x130db5[_0xab2c79(0x16d)]);}if(!_0x421461){process[_0xab2c79(0x248)]['write'](_0xab2c79(0x14a)+_0x28549f+_0xab2c79(0x105)),await a0_0x556804[_0xab2c79(0x1de)](_0x28549f*0x3e8);if(shutdownInProgress)break;console[_0xab2c79(0x100)]('reconnecting\x20...');try{await stopTunnel(_0x5e4538),_0x5e4538['upgradeOnlyIfNotUsable']=!![];let _0x3a7427=await getSystemInfo(_0x33c6a0[_0xab2c79(0x20e)],_0x5e4538),_0x5d1717=await newApiAuthenticateDevice(_0x3a7427,_0x33c6a0,null,_0x5e4538),_0x2f1beb=await doNewApiLaunchTunnel(_0x5d1717[_0xab2c79(0x1a9)],_0x3a7427,_0x33c6a0,_0x5e4538);_0x2c280f=_0x2f1beb[_0xab2c79(0x152)],_0x5db523=_0x2f1beb[_0xab2c79(0x101)],lastSuccessfulPing=_0x291af3=_0x441c42=_0x4a66c0=Date[_0xab2c79(0x268)](),_0x421461=!![],_0x28549f=0x5,console[_0xab2c79(0x100)]('Reconnect\x20succeeded');}catch(_0x285cbf){_0x28549f=Math[_0xab2c79(0x120)](_0x28549f*0x2,0x12c),console[_0xab2c79(0x100)]('Reconnect\x20failed:\x20'+_0x285cbf[_0xab2c79(0x16d)]);}}}}async function setPacFile(_0x4d2ac1,_0x43e9c4){const _0xc4eb6a=a0_0x265bbc;let _0x474122=await exec(_0xc4eb6a(0x1f0)+_0x4d2ac1),_0x42c82d=(await exec(_0xc4eb6a(0x1bb)))?.[_0xc4eb6a(0x248)]?.[_0xc4eb6a(0x217)]()['replace'](/'/g,'');if(_0x42c82d!==_0x4d2ac1)throw new Error(_0x474122[_0xc4eb6a(0x124)][_0xc4eb6a(0x217)]());_0x474122=await exec(_0xc4eb6a(0x15d)+_0x43e9c4+'\x27');let _0x2639fa=(await exec('gsettings\x20get\x20org.gnome.system.proxy\x20autoconfig-url'))?.[_0xc4eb6a(0x248)]?.[_0xc4eb6a(0x217)]()[_0xc4eb6a(0x1af)](/'/g,'');if(_0x2639fa!==_0x43e9c4)throw new Error(_0x474122['stderr'][_0xc4eb6a(0x217)]());}async function doNewApiLaunchTunnel(_0x13fca7,_0x17ca74,_0x14a980,_0x5c773f){const _0x462ef1=a0_0x265bbc;let _0x1b1256={'authenticationToken':_0x13fca7},_0x195be8=await callZteApi('GetPreLaunchInfo',_0x1b1256,_0x17ca74,_0x5c773f),_0x2d0eb8='';if(_0x195be8['gatewayDns']){let _0x3fe0ad=await a0_0x57db88[_0x462ef1(0x1a3)](_0x195be8['gatewayDns']);if(_0x3fe0ad[_0x462ef1(0x121)]===0x0)throw new ErrorWithoutStacktrace(_0x462ef1(0x289)+_0x195be8[_0x462ef1(0x276)]);let _0x5a77ff=Math[_0x462ef1(0x22e)](Math[_0x462ef1(0x202)]()*_0x3fe0ad[_0x462ef1(0x121)]);_0x2d0eb8=_0x3fe0ad[_0x5a77ff];}_0x1b1256={'authenticationToken':_0x13fca7,'preferredGatewayIp':_0x2d0eb8,'postureCheckResults':{'results':[]}};let _0x29e739=await callZteApi(_0x462ef1(0x173),_0x1b1256,_0x17ca74,_0x5c773f);if(!_0x29e739[_0x462ef1(0x1c2)])throw new ErrorWithoutStacktrace(_0x462ef1(0x235)+_0x29e739[_0x462ef1(0x1ee)]);_0x29e739[_0x462ef1(0xeb)]&&await connectorPreConnectConfigNewApi(_0x29e739,_0x5c773f,_0x17ca74);let _0x1d1d3f='';_0x29e739[_0x462ef1(0x264)][_0x462ef1(0x1cd)]&&(_0x1d1d3f=_0x462ef1(0x14e)+_0x29e739[_0x462ef1(0x264)]['dnsServers'][_0x462ef1(0x281)](',\x20')+'\x0a');let _0x7ab8db=null,_0x111c52=null;try{_0x7ab8db=(await exec(_0x462ef1(0x1bb)))?.[_0x462ef1(0x248)]?.[_0x462ef1(0x217)]()[_0x462ef1(0x1af)](/'/g,''),_0x111c52=(await exec(_0x462ef1(0x117)))?.[_0x462ef1(0x248)]?.[_0x462ef1(0x217)]()[_0x462ef1(0x1af)](/'/g,''),(_0x111c52[_0x462ef1(0x1d4)](/10\.201\.201\.201|10\.10\.201\.1|zerotrustedge/i)||_0x29e739['proxySettings'][_0x462ef1(0x226)]&&_0x29e739[_0x462ef1(0x23b)][_0x462ef1(0x226)]===_0x111c52)&&(_0x7ab8db='none',_0x111c52='');}catch{}let _0x19893d=_0x29e739[_0x462ef1(0x264)]['allowedIPs'];if(_0x19893d[_0x462ef1(0x121)]===0x1&&_0x19893d[0x0]==='0.0.0.0/0'||_0x19893d[_0x462ef1(0x121)]===0x2&&(_0x19893d[0x0]===_0x462ef1(0x1ed)&&_0x19893d[0x1]===_0x462ef1(0x214))){}else{if(_0x29e739[_0x462ef1(0x264)][_0x462ef1(0x157)]){let _0x3aa70a=new URL(_0x29e739[_0x462ef1(0x14f)]),_0x27f336=_0x3aa70a[_0x462ef1(0x1a5)];!a0_0x16d537[_0x462ef1(0xfa)](_0x19893d,_0x27f336)&&_0x19893d[_0x462ef1(0x1e9)](_0x27f336+_0x462ef1(0x17c));let _0x2276d8=_0x29e739[_0x462ef1(0x264)][_0x462ef1(0x187)]['replace'](/:.*/,'');a0_0x16d537[_0x462ef1(0xfa)](_0x19893d,_0x2276d8)&&(_0x19893d=a0_0x556804[_0x462ef1(0x10f)](['!'+_0x2276d8+'/32',..._0x19893d]));}}let _0x1f8797={'gatewayServicesUrl':_0x29e739[_0x462ef1(0x14f)],'defaultInterface':_0x29e739[_0x462ef1(0x213)],'userName':_0x14a980[_0x462ef1(0x146)],'tenant':_0x14a980[_0x462ef1(0x20e)],'setPacFile':Boolean(_0x29e739[_0x462ef1(0x23b)][_0x462ef1(0x226)]),'connector':Boolean(_0x29e739[_0x462ef1(0xeb)]),'monitorPid':_0x5c773f[_0x462ef1(0x1fe)]?process['pid']:null},_0x451f66={'oldMode':_0x7ab8db,'oldProxyPac':_0x111c52},_0x18e145='';_0x5c773f['listenPort']&&(_0x18e145=_0x462ef1(0x1f7)+_0x5c773f['listenPort']+'\x0a');let _0x23910f='[Interface]\x0a'+(_0x462ef1(0x130)+_0x14a980['privateKey']+'\x0a')+(_0x462ef1(0x1f2)+_0x29e739[_0x462ef1(0x264)][_0x462ef1(0xf1)]+'\x0a')+_0x18e145+_0x1d1d3f+_0x462ef1(0x1bd)+(_0x462ef1(0x253)+_0x29e739[_0x462ef1(0x264)]['serverPublicKey']+'\x0a')+('Endpoint\x20=\x20'+_0x29e739[_0x462ef1(0x264)][_0x462ef1(0x187)]+'\x0a')+_0x462ef1(0x1ad)+(_0x462ef1(0x10c)+_0x19893d[_0x462ef1(0x281)](',\x20')+'\x0a')+('#\x20systemInfo\x20=\x20'+JSON['stringify'](_0x17ca74)+'\x0a')+(_0x462ef1(0x11a)+JSON[_0x462ef1(0x1da)](_0x1f8797)+'\x0a')+('#\x20restorePac\x20=\x20'+JSON[_0x462ef1(0x1da)](_0x451f66)+'\x0a');await a0_0x4d961d[_0x462ef1(0x1d8)](runningConfigFile,_0x23910f,{'encoding':_0x462ef1(0x25d),'mode':parseInt(_0x462ef1(0x249),0x8)});if(!_0x5c773f[_0x462ef1(0x26e)])return;let _0x3b31aa=await execNoThrow(_0x462ef1(0x191)+runningConfigFile);if(_0x3b31aa['code']!==0x0||!tunnelActive()){if(_0x3b31aa[_0x462ef1(0x124)]['includes'](_0x462ef1(0x1d3)))throw new ErrorWithoutStacktrace(_0x462ef1(0x119));else throw new ErrorWithoutStacktrace(_0x462ef1(0x162)+_0x3b31aa[_0x462ef1(0x124)][_0x462ef1(0x217)]());}else{verboseLog(_0x5c773f,_0x462ef1(0x15a)),verboseLog(_0x5c773f,_0x3b31aa);if(_0x29e739[_0x462ef1(0x23b)][_0x462ef1(0x226)])try{await setPacFile(_0x462ef1(0x269),_0x29e739[_0x462ef1(0x23b)]['pacFile']),console[_0x462ef1(0x100)](_0x462ef1(0x1ce)+_0x29e739['proxySettings']['pacFile']);}catch(_0x561079){console[_0x462ef1(0x100)]('Unable\x20to\x20set\x20PAC\x20file:\x20'+_0x561079[_0x462ef1(0x16d)]);}console['log']('Waiting\x20for\x20tunnel\x20to\x20come\x20online\x20...\x20');let _0xdff006=_0x29e739[_0x462ef1(0x264)][_0x462ef1(0x265)]['replace'](/[-[\]{}()*+?.,\\^$|#\s]/g,'\x5c$&'),_0xfcdd74=new RegExp('^'+_0xdff006+_0x462ef1(0x20b),'m'),_0xe80556=await a0_0x556804[_0x462ef1(0x1bc)](async()=>{const _0x426274=_0x462ef1;if(shutdownInProgress)return![];let _0x419fbe=await execNoThrow(_0x426274(0x27b)),_0x3d826c=(_0x419fbe[_0x426274(0x248)]??'')[_0x426274(0x1d4)](_0xfcdd74),_0xf05f50=_0x3d826c?_0x3d826c[0x4]:'no-data',_0x504819=_0x3d826c&&_0x3d826c[0x4]!=='0';return debugLog(_0x5c773f,_0x426274(0x19e)+_0xf05f50+_0x426274(0x1ef)+_0x504819),_0x504819;},{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0xe80556){try{await stopTunnel(_0x5c773f);}catch{}throw new ErrorWithoutStacktrace('Tunnel\x20not\x20functioning\x20properly.\x20No\x20handshake.\x20\x20Perhaps\x20a\x20connectivity\x20problem\x20to\x20the\x20POP');}let _0x532655=await a0_0x556804['waitFor'](async()=>shutdownInProgress||await getGatewayServices(_0x462ef1(0x101),_0x1f8797,_0x17ca74,_0x5c773f,{'throwIfError':![]}),{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0x532655){try{await stopTunnel(_0x5c773f);}catch{}throw new ErrorWithoutStacktrace(_0x462ef1(0x283));}return _0x29e739[_0x462ef1(0xeb)]?(await connectorPostConnectConfigNewApi(_0x29e739,_0x5c773f,_0x17ca74),console[_0x462ef1(0x100)]('Connector\x20started')):console[_0x462ef1(0x100)](_0x462ef1(0x20c)),{'clientSettings':_0x532655,'deviceInfo':_0x1f8797};}}async function postGatewayServices(_0xf2b13,_0x1502b1,_0x526c8e,_0x35cdc2,_0x40757a,{throwIfError:throwIfError=!![]}={}){const _0x2bd2c7=a0_0x265bbc;try{let _0x4647f5=_0x526c8e[_0x2bd2c7(0x14f)]+'/'+_0xf2b13;debugLog(_0x40757a,_0x2bd2c7(0x151)+_0x4647f5+_0x2bd2c7(0x1a1)),debugLog(_0x40757a,_0x1502b1);let _0x18acf2=await a0_0x20df04['post'](_0x4647f5,{'json':_0x1502b1,'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x2bd2c7(0x12a),'timeout':{'request':0x5*0x3e8}});return debugLog(_0x40757a,_0x18acf2[_0x2bd2c7(0x1b6)]),debugLog(_0x40757a,_0x2bd2c7(0x258)),_0x18acf2['body'];}catch(_0x1055eb){debugLog(_0x40757a,'Error:\x20'+_0x1055eb[_0x2bd2c7(0x16d)]),debugLog(_0x40757a,_0x2bd2c7(0x258));if(throwIfError)throw new ErrorWithoutStacktrace(_0xf2b13+'\x20failed:\x20'+_0x1055eb[_0x2bd2c7(0x16d)]);}}async function getGatewayServices(_0x490870,_0x15f5a6,_0x129eda,_0x132dd1,{throwIfError:throwIfError=!![]}={}){const _0x5ac500=a0_0x265bbc;try{let _0x305fd1=_0x15f5a6['gatewayServicesUrl']+'/'+_0x490870;debugLog(_0x132dd1,_0x5ac500(0x12c)+_0x305fd1+'\x20----');let _0x36e952=await a0_0x20df04(_0x305fd1,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x5ac500(0x12a),'timeout':{'request':0x5*0x3e8}});return debugLog(_0x132dd1,_0x36e952[_0x5ac500(0x1b6)]),debugLog(_0x132dd1,'------------------------'),_0x36e952[_0x5ac500(0x1b6)];}catch(_0x294525){debugLog(_0x132dd1,_0x5ac500(0x1f6)+_0x294525[_0x5ac500(0x16d)]),debugLog(_0x132dd1,_0x5ac500(0x258));if(throwIfError)throw new ErrorWithoutStacktrace(_0x490870+'\x20failed:\x20'+_0x294525[_0x5ac500(0x16d)]);}}function devNameToFileName(_0x333be7,_0x35e1fc,_0x4a4869){const _0x3a14af=a0_0x265bbc;_0x35e1fc=_0x35e1fc[_0x3a14af(0x1af)](/[/\\]/g,'');let _0x30a747=a0_0x57d639[_0x3a14af(0x281)](deviceFolder,''+_0x333be7+sep+_0x35e1fc+sep+_0x4a4869+_0x3a14af(0x259));return _0x30a747;}async function saveProfile(_0x51af6d,_0x3414e4,_0x379f5e){const _0x336a0c=a0_0x265bbc;!await fileExists(deviceFolder)&&(await a0_0x4d961d[_0x336a0c(0x10e)](deviceFolder),console[_0x336a0c(0x100)](_0x336a0c(0x133)+deviceFolder));let _0x5971ed=devNameToFileName(_0x51af6d,_0x3414e4['userName'],_0x379f5e),_0x34695d={'version':CLIENT_VERSION,'privateKey':_0x3414e4[_0x336a0c(0x175)],'tenant':_0x51af6d,'isConnector':_0x3414e4[_0x336a0c(0xfe)],'user':_0x3414e4[_0x336a0c(0x1b2)],'userId':_0x3414e4['userId'],'deviceName':_0x379f5e};return await a0_0x4d961d[_0x336a0c(0x1d8)](_0x5971ed,JSON[_0x336a0c(0x1da)](_0x34695d,null,0x2)+'\x0a',{'encoding':_0x336a0c(0x25d),'mode':parseInt(_0x336a0c(0x249),0x8)}),_0x5971ed;}async function readProfile(_0x536d41){const _0x30ef7d=a0_0x265bbc;let _0x2c7b04=await a0_0x4d961d['readFile'](_0x536d41,_0x30ef7d(0x25d)),_0x11239f=JSON[_0x30ef7d(0x143)](_0x2c7b04);return _0x11239f[_0x30ef7d(0x123)]=await getPublicKey(_0x11239f[_0x30ef7d(0x1fd)]),_0x11239f;}async function getCurrentConnectionInfo(){const _0x1f2bab=a0_0x265bbc;let _0x54b1b3=await a0_0x4d961d[_0x1f2bab(0x160)](runningConfigFile,_0x1f2bab(0x25d)),_0xdac1cd={'privateKey':_0x54b1b3[_0x1f2bab(0x1d4)](/PrivateKey = (.*)/)?.[0x1],'ip':_0x54b1b3['match'](/Address = (.*)/)?.[0x1],'systemInfo':JSON[_0x1f2bab(0x143)](_0x54b1b3[_0x1f2bab(0x1d4)](/systemInfo = (.*)/)?.[0x1]),'deviceInfo':JSON[_0x1f2bab(0x143)](_0x54b1b3['match'](/deviceInfo = (.*)/)?.[0x1]),'restorePac':JSON[_0x1f2bab(0x143)](_0x54b1b3['match'](/restorePac = (.*)/)?.[0x1])};return _0xdac1cd[_0x1f2bab(0x123)]=await getPublicKey(_0xdac1cd[_0x1f2bab(0x1fd)]),_0xdac1cd;}async function execNoThrow(_0xa77c74){const _0x5d6282=a0_0x265bbc;try{let _0x30c9f3=await exec(_0xa77c74);return _0x30c9f3[_0x5d6282(0x284)]=0x0,_0x30c9f3;}catch(_0x59f6d2){return{'code':_0x59f6d2[_0x5d6282(0x284)]??-0x1,'stderr':_0x59f6d2[_0x5d6282(0x124)]??'','stdout':_0x59f6d2[_0x5d6282(0x248)]??''};}}async function fileExists(_0x3f1da1){const _0x20b795=a0_0x265bbc;try{return await a0_0x4d961d[_0x20b795(0x125)](_0x3f1da1),!![];}catch{return![];}}function isString(_0x47461e){const _0x35e806=a0_0x265bbc;return typeof _0x47461e===_0x35e806(0x1c5);}function doLog(_0x1dac76){const _0x3ec152=a0_0x265bbc;if(_0x1dac76[_0x3ec152(0x248)]||_0x1dac76['stderr']){let _0x58ccff=_0x1dac76['stdout']?.['trim']();_0x58ccff&&console['log'](_0x58ccff);let _0x1d7703=_0x1dac76['stderr']?.[_0x3ec152(0x217)]();_0x1d7703&&console['log'](_0x1d7703);}else isString(_0x1dac76)?console[_0x3ec152(0x100)](_0x1dac76):console['log'](JSON[_0x3ec152(0x1da)](_0x1dac76,null,0x2));}function debugLog(_0x341fd7,_0x4653fb){const _0xad4ed=a0_0x265bbc;_0x341fd7?.[_0xad4ed(0x1f8)]&&doLog(_0x4653fb);}function verboseLog(_0x51c150,_0x1c5664){const _0x1d9d7b=a0_0x265bbc;(_0x51c150?.['verbose']||_0x51c150?.[_0x1d9d7b(0x1f8)])&&doLog(_0x1c5664);}async function stopTunnel(_0x17a440){const _0x50c364=a0_0x265bbc;let _0x16983f;if(!tunnelActive()){await execNoThrow(_0x50c364(0x104));return;}else{if(!await fileExists(runningConfigFile))console[_0x50c364(0x100)](_0x50c364(0x17d)),await execNoThrow('sudo\x20resolvconf\x20-d\x20ztedge'),_0x16983f=await execNoThrow(_0x50c364(0x10b)+TUNNEL_INTERFACE_NAME);else{let _0x1e8c4a=await getCurrentConnectionInfo();if(_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0x196)]&&_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0x196)]!==process[_0x50c364(0x1be)]){console[_0x50c364(0x100)](_0x50c364(0x1b1)+_0x1e8c4a[_0x50c364(0x152)]['monitorPid']+'\x20to\x20shutdown');try{process['kill'](_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0x196)],_0x50c364(0x285));return;}catch(_0x5437e8){console[_0x50c364(0x100)]('Failed\x20to\x20signal.\x20\x20Trying\x20local\x20kill');}}try{let _0x2edc09=await a0_0x20df04[_0x50c364(0x15f)](_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0x14f)]+_0x50c364(0xfd),{'json':{'key':_0x1e8c4a[_0x50c364(0x123)]},'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x50c364(0x12a),'timeout':{'request':0x5*0x3e8}});_0x2edc09[_0x50c364(0x20f)]!==0xc8&&console[_0x50c364(0x100)]('Logout\x20failed:\x20'+_0x2edc09[_0x50c364(0x1b6)]);}catch(_0x193f1a){console[_0x50c364(0x100)](_0x50c364(0x279)+_0x193f1a[_0x50c364(0x16d)]);}_0x16983f=await execNoThrow(_0x50c364(0x11c)+runningConfigFile),await a0_0x4d961d[_0x50c364(0x247)](runningConfigFile);if(_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0xeb)]){console['log'](_0x50c364(0x25b));let _0x12f37d=await execNoThrow(_0x50c364(0x20d)+_0x1e8c4a['deviceInfo']['defaultInterface']+_0x50c364(0x198));}if(_0x1e8c4a[_0x50c364(0x152)][_0x50c364(0x219)])try{await setPacFile(_0x1e8c4a[_0x50c364(0x149)][_0x50c364(0x16c)],_0x1e8c4a[_0x50c364(0x149)][_0x50c364(0x1cc)]);if(_0x1e8c4a[_0x50c364(0x149)][_0x50c364(0x16c)]===_0x50c364(0x23f))console[_0x50c364(0x100)](_0x50c364(0x272));else _0x1e8c4a[_0x50c364(0x149)][_0x50c364(0x16c)]===_0x50c364(0x269)?console['log']('Proxy\x20restored\x20to\x20'+_0x1e8c4a['restorePac']['oldProxyPac']):console[_0x50c364(0x100)](_0x50c364(0x1e2)+_0x1e8c4a[_0x50c364(0x149)][_0x50c364(0x16c)]);}catch(_0x86534e){console[_0x50c364(0x100)](_0x50c364(0x1c4)+_0x86534e[_0x50c364(0x16d)]);}}}if(_0x16983f[_0x50c364(0x284)]!==0x0||tunnelActive())throw new ErrorWithoutStacktrace('Tunnel\x20did\x20not\x20shutdown:\x0a'+_0x16983f[_0x50c364(0x124)]['trim']());else verboseLog(_0x17a440,_0x16983f);}async function initiateShutdown(_0x12fb0a){const _0x1ec265=a0_0x265bbc;try{console['log'](),++shutdownInProgress;if(shutdownInProgress===0x2){console[_0x1ec265(0x100)](_0x1ec265(0x172));return;}else shutdownInProgress===0x3&&(console[_0x1ec265(0x100)](_0x1ec265(0x11e)),process[_0x1ec265(0x1d6)](0x1));!tunnelActive()?console[_0x1ec265(0x100)](_0x1ec265(0x271)):(console['log'](_0x1ec265(0x287)),await stopTunnel(_0x12fb0a)),console['log']('Exiting\x20ztedge-client'),process['exit'](0x0);}catch(_0x41a17b){console[_0x1ec265(0x100)](_0x41a17b),console[_0x1ec265(0x100)]('Exiting\x20ztedge-client'),process[_0x1ec265(0x1d6)](0x0);}}async function doPing(_0x5dfbfe){const _0x450820=a0_0x265bbc;let _0x3b2ccd=![];try{let _0x402fc7=await a0_0x20df04(_0x5dfbfe[_0x450820(0x152)][_0x450820(0x14f)]+_0x450820(0x1c0),{'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x450820(0x12a),'timeout':{'request':0x5*0x3e8}});_0x3b2ccd=_0x402fc7?.[_0x450820(0x20f)]===0xc8;}catch(_0x2659c){console[_0x450820(0x100)]('Ping\x20failure:\x20'+_0x2659c['message']);}return _0x3b2ccd;}async function connectorPreConnectConfigNewApi(_0x1315a4,_0xb07c22,_0x12941b){const _0x2fee3a=a0_0x265bbc;let _0xc64878=await exec(_0x2fee3a(0x1a4)),_0x1e5e5a=_0xc64878['stdout'][_0x2fee3a(0x1d4)](/ dev (\w+) /)?.[0x1];if(!_0x1e5e5a)throw new Error('cannot\x20determine\x20default\x20device');_0x1315a4['defaultInterface']=_0x1e5e5a;}async function connectorPostConnectConfigNewApi(_0x3c883f,_0x234869,_0x3d6462){const _0x38ca2d=a0_0x265bbc;console[_0x38ca2d(0x100)]('Use\x20MASQUERADE\x20to\x20'+_0x3c883f['defaultInterface']),console[_0x38ca2d(0x100)](_0x38ca2d(0x186));try{await exec('sudo\x20iptables\x20-A\x20POSTROUTING\x20-t\x20nat\x20-o\x20'+_0x3c883f['defaultInterface']+_0x38ca2d(0x198)),await exec(_0x38ca2d(0x27d));}catch(_0xf5e5f6){console[_0x38ca2d(0x100)]('Error\x20configuring\x20connector:\x20'+_0xf5e5f6[_0x38ca2d(0x16d)]);}}function tunnelActive(){const _0x3edc5d=a0_0x265bbc;let _0xf1fc1b=a0_0x2c6bd5[_0x3edc5d(0x129)]();return Boolean(_0xf1fc1b[TUNNEL_INTERFACE_NAME]);}async function findMatchingProfile(_0x120c9e,_0x485ba6,_0x1cd692){const _0x1cf117=a0_0x265bbc;let _0x333d52;if(_0x120c9e&&_0x485ba6&&_0x1cd692){let _0x31ee2d=devNameToFileName(_0x120c9e,_0x485ba6,_0x1cd692);if(!await fileExists(_0x31ee2d))throw new ErrorWithoutStacktrace(_0x1cf117(0x22c));_0x333d52=await readProfile(devNameToFileName(_0x120c9e,_0x485ba6,_0x1cd692));}else{let _0x53db15=await fileExists(deviceFolder)&&await a0_0x4d961d[_0x1cf117(0x176)](deviceFolder);if(!_0x53db15)throw new ErrorWithoutStacktrace(_0x1cf117(0x204));let _0x596450;_0x120c9e&&!_0x485ba6?_0x596450=_0x120c9e+sep+'.*'+(_0x1cd692??'.*'):_0x596450=(_0x120c9e??'.*')+sep+(_0x485ba6??'.*')+sep+(_0x1cd692??'.*');let _0x43a3d4=_0x53db15['filter'](_0x492744=>_0x492744['match'](_0x596450));if(_0x43a3d4[_0x1cf117(0x121)]===0x0)throw new ErrorWithoutStacktrace('No\x20matching\x20profiles');else{if(_0x43a3d4[_0x1cf117(0x121)]===0x1){let _0x2211b2=_0x43a3d4[0x0][_0x1cf117(0x1d4)](_0x1cf117(0x109)+sep+_0x1cf117(0x199)+sep+'(.*)[.]conf'),_0x538eef=a0_0x57d639[_0x1cf117(0x281)](deviceFolder,_0x43a3d4[0x0]);_0x333d52=await readProfile(_0x538eef),console[_0x1cf117(0x100)]('Using\x20profile:\x20'+_0x333d52[_0x1cf117(0x20e)]+'\x20'+_0x333d52[_0x1cf117(0x146)]);}else throw new ErrorWithoutStacktrace(_0x1cf117(0x288));}}return _0x333d52;}async function getPublicKey(_0x24df98){const _0x5d8854=a0_0x265bbc,_0x5d33b4=a0_0x3ddb2a['spawnSync']('wg',[_0x5d8854(0x11f)],{'input':_0x24df98+'\x0a'});if(_0x5d33b4[_0x5d8854(0x225)]!==0x0)throw new ErrorWithoutStacktrace('cannot\x20generate\x20publickey');return _0x5d33b4['stdout'][_0x5d8854(0x218)]()[_0x5d8854(0x217)]();}async function setupShieldCertificate(_0x16d66e){const _0xc805c5=a0_0x265bbc;_0x16d66e[_0xc805c5(0x1bf)]&&a0_0xed0e70[_0xc805c5(0x1c1)](_0x16d66e[_0xc805c5(0x1bf)]['split'](','));for(let _0x36f03c of SHIELD_CA_CERTIFICATES){await fileExists(_0x36f03c)?a0_0xed0e70[_0xc805c5(0x1c1)](_0x36f03c):console[_0xc805c5(0x100)](_0xc805c5(0x234)+_0x36f03c+_0xc805c5(0x15e));}}function myParseInt(_0x2c9a70,_0x1e46a8){return parseInt(_0x2c9a70);}function myParseString(_0x51bc8c,_0x5c52b9){return _0x51bc8c;}function addConnectOptions(_0x13c8d4,_0x32437b){const _0x5ec469=a0_0x265bbc;let _0xd1530f=_0x13c8d4[_0x5ec469(0x23c)][_0x5ec469(0x25f)](_0xcae0b6=>_0xcae0b6[_0x5ec469(0x14b)]===_0x32437b);_0xd1530f['option'](_0x5ec469(0xf3),_0x5ec469(0x111),null)[_0x5ec469(0x1ff)]('--browser',_0x5ec469(0x23e),![])[_0x5ec469(0x1ff)](_0x5ec469(0x12f),'Only\x20do\x20the\x20authentication/profileManagement\x20and\x20do\x20not\x20launch\x20the\x20tunnel',![])['option'](_0x5ec469(0x1e4),_0x5ec469(0x1ae),!![])[_0x5ec469(0x1ff)]('--no-monitor',_0x5ec469(0x15c))['option'](_0x5ec469(0x1c3),_0x5ec469(0x1d9),myParseInt,0xf)['option'](_0x5ec469(0x108),_0x5ec469(0x1eb),myParseInt,0x3c)[_0x5ec469(0x1ff)]('--upgrade',_0x5ec469(0x282),![])[_0x5ec469(0x1ff)](_0x5ec469(0x112),'device\x20name',myParseString,a0_0x2c6bd5[_0x5ec469(0x1a5)]())[_0x5ec469(0x1ff)](_0x5ec469(0x134),_0x5ec469(0x139),myParseInt,0x0)[_0x5ec469(0x1ff)](_0x5ec469(0xec),_0x5ec469(0x1fb),myParseInt,0x0)[_0x5ec469(0x1ff)](_0x5ec469(0xf4),_0x5ec469(0x240),myParseString,'/health')[_0x5ec469(0x1ff)](_0x5ec469(0x154),_0x5ec469(0x241),myParseInt,0x3c),addCommonOptions(_0x13c8d4,_0x32437b);}function addCommonOptions(_0x3e465b,_0x57ce4d){const _0xca4b=a0_0x265bbc;let _0x27c0c3=_0x3e465b['commands']['find'](_0x5e2fa8=>_0x5e2fa8[_0xca4b(0x14b)]===_0x57ce4d);_0x27c0c3['option']('--ignoreCertificateErrors',_0xca4b(0x166),![])['option'](_0xca4b(0x223),_0xca4b(0x216),DEFAULT_CA_FOLDER)[_0xca4b(0x1ff)](_0xca4b(0x211),'Show\x20details',![])[_0xca4b(0x1ff)]('-d|--debug','Show\x20debug\x20output',![]);}function execError(_0x4e5620){const _0x2cd3c7=a0_0x265bbc;let _0xa601b2=_0x4e5620['stdout'][_0x2cd3c7(0x217)](),_0x251a2a=_0x4e5620['stderr'][_0x2cd3c7(0x217)]();if(!_0xa601b2)return _0x251a2a;else return!_0x251a2a?_0xa601b2:_0xa601b2+'\x0a'+_0x251a2a;}async function launchFromToken(_0x3f8d0e,_0x24a03d,_0x288e42,_0x417723){const _0x2b4731=a0_0x265bbc;let _0x494c8d='';_0x417723[_0x2b4731(0x1f8)]&&(_0x494c8d+=_0x2b4731(0x1d0));_0x417723[_0x2b4731(0x126)]&&(_0x494c8d+=_0x2b4731(0x201)+_0x417723[_0x2b4731(0x126)]);let _0x211d55=_0x2b4731(0x280);await fileExists(_0x211d55)&&await a0_0x4d961d[_0x2b4731(0x247)](_0x211d55);let _0x373fa6='ztedge-client\x20launchFromToken\x20\x22'+_0x3f8d0e+'\x22\x20\x22'+_0x24a03d+_0x2b4731(0xf5)+_0x288e42+'\x22\x20'+_0x494c8d+_0x2b4731(0x239)+_0x211d55;execNoThrow(_0x373fa6),console[_0x2b4731(0x100)](_0x2b4731(0x103)+_0x211d55),process['stdout']['write']('Waiting\x20for\x20tunnel\x20to\x20start\x20...');for(;;){if(!tunnelActive())process[_0x2b4731(0x248)][_0x2b4731(0x192)]('.');else{let _0x9d7f7a=await getCurrentConnectionInfo(),_0x1f283f=await doPing(_0x9d7f7a);if(_0x1f283f){console[_0x2b4731(0x100)](),console[_0x2b4731(0x100)](_0x2b4731(0x236)+_0x9d7f7a['ip']),console['log'](_0x2b4731(0x1f5)+_0x9d7f7a['deviceInfo'][_0x2b4731(0x20e)]),console['log'](_0x2b4731(0x278)+_0x9d7f7a[_0x2b4731(0x152)][_0x2b4731(0x1b2)]),console[_0x2b4731(0x100)]('Tunnel\x20is\x20functioning\x20properly');break;}else process[_0x2b4731(0x248)][_0x2b4731(0x192)]('.');}await a0_0x556804['sleepMs'](0x3e8);}}async function main(){const _0x506a0a=a0_0x265bbc;try{const _0x4abb35=new a0_0x403324['Command']();_0x4abb35['description'](_0x506a0a(0x21d))['allowExcessArguments'](![])[_0x506a0a(0x122)](CLIENT_VERSION),_0x4abb35[_0x506a0a(0x16e)](_0x506a0a(0x275))['description'](_0x506a0a(0x257)+'You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20if\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a'+_0x506a0a(0x165))[_0x506a0a(0x1ff)](_0x506a0a(0x11d),'Replace\x20existing\x20profile',![])[_0x506a0a(0x1ff)](_0x506a0a(0xee),'To\x20be\x20used\x20as\x20a\x20cloud-native\x20connector',![])[_0x506a0a(0x1ff)](_0x506a0a(0x237),'Run\x20connection\x20in\x20the\x20background')[_0x506a0a(0x106)](async function(_0x579168,_0x31d4b9,_0x37b950){const _0x2b3c1b=_0x506a0a;await setupShieldCertificate(_0x37b950);if(tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20currently\x20active');_0x31d4b9=_0x31d4b9?.[_0x2b3c1b(0x217)]();let _0x5e4f9d=_0x37b950[_0x2b3c1b(0x228)]?.[_0x2b3c1b(0x217)](),_0x18cd50=_0x37b950[_0x2b3c1b(0x126)],_0x3a6e06=devNameToFileName(_0x579168,_0x31d4b9,_0x18cd50);if(!_0x37b950[_0x2b3c1b(0x1e5)]&&await fileExists(_0x3a6e06))throw new ErrorWithoutStacktrace(_0x3a6e06+_0x2b3c1b(0x261));let _0x5f0566=await getSystemInfo(_0x579168,_0x37b950),_0x3a5df9=await newApiCreateDevice(_0x5f0566,_0x18cd50,_0x31d4b9,_0x5e4f9d,_0x37b950),_0x3a186c={'devicePrivateKey':_0x3a5df9[_0x2b3c1b(0x22b)][_0x2b3c1b(0x27c)],'isConnector':_0x37b950['connector'],'userName':_0x3a5df9['authenticationInfo'][_0x2b3c1b(0x1b2)],'userId':_0x3a5df9[_0x2b3c1b(0x168)][_0x2b3c1b(0x180)]},_0xe538f8=await saveProfile(_0x579168,_0x3a186c,_0x18cd50);console[_0x2b3c1b(0x100)](_0x2b3c1b(0x28c)+_0xe538f8);if(_0x37b950[_0x2b3c1b(0x127)])await launchFromToken(_0x579168,_0x31d4b9,_0x3a5df9[_0x2b3c1b(0x168)][_0x2b3c1b(0x1a9)],_0x37b950);else{if(!_0x37b950['authenticateOnly']){let _0x331533=await readProfile(_0xe538f8);await newApiLaunchTunnel(_0x3a5df9['authenticationInfo']['authenticationToken'],_0x5f0566,_0x331533,_0x37b950);}else console[_0x2b3c1b(0x100)]('Authenticated\x20and\x20authorized');}}),addConnectOptions(_0x4abb35,'new'),_0x4abb35['command'](_0x506a0a(0x17e))['description'](_0x506a0a(0x21e)+_0x506a0a(0x141)+_0x506a0a(0x233)+'read\x20from\x20the\x20root\x20user\x27s\x20profile\x20folder')[_0x506a0a(0x1ff)](_0x506a0a(0x140),_0x506a0a(0x144),![])['option'](_0x506a0a(0x237),_0x506a0a(0x147))[_0x506a0a(0x106)](async function(_0x49efe4,_0x343581,_0xb4789e){const _0x2297c0=_0x506a0a;await setupShieldCertificate(_0xb4789e);if(tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20currently\x20active');_0x343581=_0x343581?.[_0x2297c0(0x217)]();let _0x17a4a6=_0xb4789e[_0x2297c0(0x228)]?.[_0x2297c0(0x217)](),_0x4fa63b=_0xb4789e[_0x2297c0(0x126)],_0x3fda1f=await findMatchingProfile(_0x49efe4,_0x343581,_0x4fa63b),_0x433936=await getSystemInfo(_0x3fda1f[_0x2297c0(0x20e)],_0xb4789e),_0x28f4c0=await newApiAuthenticateDevice(_0x433936,_0x3fda1f,_0x17a4a6,_0xb4789e);if(_0xb4789e['background'])await launchFromToken(_0x3fda1f[_0x2297c0(0x20e)],_0x343581,_0x28f4c0[_0x2297c0(0x1a9)],_0xb4789e);else!_0xb4789e[_0x2297c0(0x256)]?await newApiLaunchTunnel(_0x28f4c0['authenticationToken'],_0x433936,_0x3fda1f,_0xb4789e):console['log'](_0x2297c0(0x22f));}),addConnectOptions(_0x4abb35,'up'),_0x4abb35[_0x506a0a(0x16e)](_0x506a0a(0x205))[_0x506a0a(0x24a)]('Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x20with\x20authentication\x20token\x0a'+_0x506a0a(0x141)+_0x506a0a(0x233)+'read\x20from\x20the\x20root\x20user\x27s\x20profile\x20folder')[_0x506a0a(0x106)](async function(_0x2d0bb0,_0x26daba,_0x4b154d,_0x5b82c8){const _0x77b675=_0x506a0a;await setupShieldCertificate(_0x5b82c8);if(tunnelActive())throw new ErrorWithoutStacktrace(_0x77b675(0x209));let _0x30c497=_0x5b82c8[_0x77b675(0x126)],_0x4a5c6a=await findMatchingProfile(_0x2d0bb0,_0x26daba,_0x30c497);_0x5b82c8[_0x77b675(0x262)]=!![];let _0x38a0b7=await getSystemInfo(_0x4a5c6a[_0x77b675(0x20e)],_0x5b82c8);await newApiLaunchTunnel(_0x4b154d,_0x38a0b7,_0x4a5c6a,_0x5b82c8);}),addConnectOptions(_0x4abb35,_0x506a0a(0x242)),_0x4abb35['command'](_0x506a0a(0x24e))['description']('Stop\x20the\x20currently\x20running\x20tunnel\x0a')['action'](async function(_0x1e3255){const _0x239100=_0x506a0a;await setupShieldCertificate(_0x1e3255);if(!tunnelActive())throw new ErrorWithoutStacktrace(_0x239100(0x174));await stopTunnel(_0x1e3255);}),addCommonOptions(_0x4abb35,_0x506a0a(0x24e)),_0x4abb35[_0x506a0a(0x16e)](_0x506a0a(0x17f))[_0x506a0a(0x24a)]('Import\x20a\x20configuration\x20file\x20generated\x20by\x20the\x20provisioning\x20portal.\x20Authentication\x20is\x20done\x20during\x20import.\x0a'+_0x506a0a(0xf2))[_0x506a0a(0x1ff)](_0x506a0a(0xf3),_0x506a0a(0x171),null)['option'](_0x506a0a(0x102),'Use\x20browser\x20based\x20authentication',![])[_0x506a0a(0x106)](async function(_0x177857,_0x548395,_0x170307){const _0x598841=_0x506a0a;await setupShieldCertificate(_0x170307);let _0x8a13bf=await a0_0x4d961d[_0x598841(0x160)](_0x177857,_0x598841(0x25d)),_0x205582=_0x8a13bf[_0x598841(0x1d4)](/PrivateKey = (.*)/)[0x1],_0xd0a055=_0x8a13bf['match'](/host = ([^.]*)/)[0x1],_0x54d9e9=a0_0x2c6bd5['hostname'](),_0x1151bc=await getSystemInfo(_0xd0a055,_0x170307),_0x3deea5={'version':CLIENT_VERSION,'tenant':_0xd0a055,'deviceName':_0x54d9e9,'publicKey':await getPublicKey(_0x205582),'user':_0x548395},_0x33988d=await newApiAuthenticateDevice(_0x1151bc,_0x3deea5,_0x170307[_0x598841(0x228)],_0x170307);if(!_0x33988d[_0x598841(0x1b2)]){if(!_0x548395)throw new ErrorWithoutStacktrace(_0x598841(0x142));_0x33988d[_0x598841(0x1b2)]=_0x548395;}_0x33988d[_0x598841(0x175)]=_0x205582;let _0x41f8c0=await saveProfile(_0xd0a055,_0x33988d,_0x54d9e9);console['log'](_0x598841(0x28c)+_0x41f8c0);}),addCommonOptions(_0x4abb35,_0x506a0a(0x27a)),_0x4abb35[_0x506a0a(0x16e)]('ls')[_0x506a0a(0x24a)](_0x506a0a(0x21a))[_0x506a0a(0x106)](async function(_0x28822b){const _0x158409=_0x506a0a;await setupShieldCertificate(_0x28822b);let _0x5548bd=await fileExists(deviceFolder)?await a0_0x4d961d['readdir'](deviceFolder):[];console[_0x158409(0x100)]('Profiles\x20are\x20stored\x20in\x20'+deviceFolder),_0x5548bd=_0x5548bd[_0x158409(0x110)](_0x4ab790=>_0x4ab790[_0x158409(0x193)](_0x158409(0x259)));if(_0x5548bd[_0x158409(0x121)]){let _0x4d2eef=await Promise[_0x158409(0x230)](_0x5548bd[_0x158409(0x25e)](_0x29c7c1=>readProfile(a0_0x57d639[_0x158409(0x281)](deviceFolder,_0x29c7c1)))),_0x490186=Math[_0x158409(0x18a)](..._0x4d2eef['map'](_0x37bcb9=>_0x37bcb9[_0x158409(0x20e)][_0x158409(0x121)]));for(let _0x330f90 of _0x4d2eef){console['log'](_0x330f90[_0x158409(0x20e)][_0x158409(0x26b)](_0x490186+0x5,'\x20')+_0x330f90[_0x158409(0x146)]);}}else console['log'](_0x158409(0x13b));}),addCommonOptions(_0x4abb35,'ls'),_0x4abb35['command'](_0x506a0a(0x225))[_0x506a0a(0x24a)](_0x506a0a(0x158))[_0x506a0a(0x106)](async function(_0x5250cf){const _0x59b91e=_0x506a0a;await setupShieldCertificate(_0x5250cf);if(!tunnelActive())console[_0x59b91e(0x100)](_0x59b91e(0x1b3));else{let _0x4fc72d=await getCurrentConnectionInfo(),_0x55eb09=await doPing(_0x4fc72d);console[_0x59b91e(0x100)](_0x59b91e(0x1f5)+_0x4fc72d[_0x59b91e(0x152)][_0x59b91e(0x20e)]),console['log'](_0x59b91e(0x278)+_0x4fc72d[_0x59b91e(0x152)][_0x59b91e(0x1b2)]),console[_0x59b91e(0x100)](_0x59b91e(0x236)+_0x4fc72d['ip']),_0x55eb09?console['log'](_0x59b91e(0x1a6)):console[_0x59b91e(0x100)]('Tunnel\x20is\x20not\x20functioning\x20properly'),_0x4fc72d[_0x59b91e(0x152)][_0x59b91e(0x196)]&&console['log']('Being\x20monitored\x20by\x20'+_0x4fc72d['deviceInfo']['monitorPid']);}}),addCommonOptions(_0x4abb35,_0x506a0a(0x225)),_0x4abb35[_0x506a0a(0x16e)]('createService\x20[<cloudId>]\x20[<user>]')[_0x506a0a(0x24a)](_0x506a0a(0x178)+_0x506a0a(0x19d)+'-\x20\x20create\x20a\x20profile\x20with\x20\x22sudo\x20ztedge-client\x20new\x20tenant\x20user\x20[--connector]\x20--authenticate-only\x20...\x22\x0a'+_0x506a0a(0x118))['option'](_0x506a0a(0x28a),'do\x20not\x20enable\x20and\x20start\x20the\x20service')[_0x506a0a(0x1ff)]('--device-name\x20<name>',_0x506a0a(0x266),myParseString,a0_0x2c6bd5[_0x506a0a(0x1a5)]())[_0x506a0a(0x106)](async function(_0x26bc17,_0x3de4e7,_0x1cc141){const _0x4a44f8=_0x506a0a;if(!await a0_0x18cda6())throw new ErrorWithoutStacktrace(_0x4a44f8(0x210));if(tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20currently\x20active');let _0x487b5a=_0x1cc141['deviceName'],_0x5e00d7=await findMatchingProfile(_0x26bc17,_0x3de4e7,_0x487b5a),_0x4ef54f=_0x4a44f8(0x135)+_0x1cc141[_0x4a44f8(0x1bf)]+'\x22';_0x1cc141[_0x4a44f8(0x220)]&&(_0x4ef54f+='\x20--ignoreCertificateErrors');_0x1cc141[_0x4a44f8(0x286)]&&(_0x4ef54f+=_0x4a44f8(0x270));_0x1cc141[_0x4a44f8(0x1f8)]&&(_0x4ef54f+=_0x4a44f8(0x1d0));_0x1cc141[_0x4a44f8(0x126)]&&(_0x4ef54f+='\x20--device-name\x20\x22'+_0x1cc141['deviceName']+'\x22');_0x4ef54f+='\x20--service';let _0x415376=a0_0x57d639['join'](__dirname,_0x4a44f8(0x12d)),_0x3c6851=_0x4a44f8(0xea)+_0x4a44f8(0x245)+'\x0a'+'[Service]\x0a'+_0x4a44f8(0x1c7)+_0x4a44f8(0x145)+(_0x4a44f8(0x155)+_0x415376+_0x4a44f8(0x19a)+_0x5e00d7[_0x4a44f8(0x20e)]+_0x4a44f8(0xf5)+_0x5e00d7[_0x4a44f8(0x146)]+'\x22\x20'+_0x4ef54f+'\x0a')+'\x0a'+'[Install]\x0a'+_0x4a44f8(0x13e);await a0_0x4d961d[_0x4a44f8(0x1d8)]('/etc/systemd/system/ztedge.service',_0x3c6851,_0x4a44f8(0x25d));let _0x5ef117=await execNoThrow(_0x4a44f8(0x114));if(_0x5ef117[_0x4a44f8(0x284)])throw new ErrorWithoutStacktrace(_0x4a44f8(0x1e6)+execError(_0x5ef117));if(_0x1cc141[_0x4a44f8(0x1ab)]){_0x5ef117=await execNoThrow('systemctl\x20enable\x20ztedge');if(_0x5ef117[_0x4a44f8(0x284)])throw new ErrorWithoutStacktrace('Unable\x20to\x20enable\x20ztedge\x20service:\x20'+execError(_0x5ef117));_0x5ef117=await execNoThrow(_0x4a44f8(0x153));if(_0x5ef117[_0x4a44f8(0x284)])throw new ErrorWithoutStacktrace(_0x4a44f8(0x1b0)+execError(_0x5ef117));process['stdout'][_0x4a44f8(0x192)](_0x4a44f8(0x1b4));for(let _0x273de6=0x0;_0x273de6<0x5;++_0x273de6){await a0_0x556804[_0x4a44f8(0x1de)](0x3e8),process[_0x4a44f8(0x248)][_0x4a44f8(0x192)]('.');}console[_0x4a44f8(0x100)](),_0x5ef117=await execNoThrow(_0x4a44f8(0x267)),console[_0x4a44f8(0x100)](execError(_0x5ef117)),console[_0x4a44f8(0x100)](_0x4a44f8(0x21c));}else console[_0x4a44f8(0x100)](_0x4a44f8(0x197));}),addCommonOptions(_0x4abb35,_0x506a0a(0x170)),![]&&process[_0x506a0a(0x277)][_0x506a0a(0x121)]===0x2&&__dirname[_0x506a0a(0x17a)]('wireguard/linux-client')&&(console[_0x506a0a(0x100)](_0x506a0a(0x206)),process[_0x506a0a(0x277)]=['','',...cmd[_0x506a0a(0x217)]()['split'](/ +/)]),await _0x4abb35['parseAsync'](process[_0x506a0a(0x277)]);}catch(_0x1ede70){_0x1ede70[_0x506a0a(0x16f)]===_0x506a0a(0x1f1)?console[_0x506a0a(0x100)](_0x1ede70['message']):console[_0x506a0a(0x100)](_0x1ede70),process[_0x506a0a(0x188)]=0x1;}!shutdownInProgress&&process[_0x506a0a(0x1d6)]();}main();