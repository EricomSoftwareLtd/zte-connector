const a0_0x5a6806=a0_0x2d17;(function(_0x34e04b,_0x2eb597){const _0x21f6a8=a0_0x2d17,_0x5d30c5=_0x34e04b();while(!![]){try{const _0x27af7c=-parseInt(_0x21f6a8(0x306))/0x1+-parseInt(_0x21f6a8(0x237))/0x2*(parseInt(_0x21f6a8(0x2b2))/0x3)+parseInt(_0x21f6a8(0x1d3))/0x4+-parseInt(_0x21f6a8(0x251))/0x5*(-parseInt(_0x21f6a8(0x222))/0x6)+-parseInt(_0x21f6a8(0x30e))/0x7+parseInt(_0x21f6a8(0x257))/0x8*(-parseInt(_0x21f6a8(0x1f4))/0x9)+parseInt(_0x21f6a8(0x229))/0xa;if(_0x27af7c===_0x2eb597)break;else _0x5d30c5['push'](_0x5d30c5['shift']());}catch(_0x32fd58){_0x5d30c5['push'](_0x5d30c5['shift']());}}}(a0_0x3f62,0x82b0b));const CLIENT_VERSION=a0_0x5a6806(0x292),CLIENT_PLATFORM=a0_0x5a6806(0x34b);import a0_0x3fbf27 from'util';import a0_0x41ff0b from'child_process';import a0_0x42919a from'path';import a0_0x53eb06 from'http';import a0_0x58da01 from'os';import{promises as a0_0x3785f6}from'dns';import{promises as a0_0x39e7c3,createWriteStream}from'fs';import a0_0xfb3f92 from'url';import a0_0x73d9d8 from'readline-sync';import a0_0x35baa7 from'got';import a0_0x37ec35 from'find-free-port';import a0_0x501593 from'password-prompt';import a0_0x951157 from'temp';import a0_0x504fcb from'is-elevated';import*as a0_0x23e9c3 from'commander';import*as a0_0x389de6 from'syswide-cas';import*as a0_0x5de313 from'cidr-tools';import*as a0_0x2f99f5 from'./utils.js';const __dirname=a0_0x42919a[a0_0x5a6806(0x1cc)](a0_0xfb3f92[a0_0x5a6806(0x296)](import.meta['url'])),exec=a0_0x3fbf27[a0_0x5a6806(0x214)](a0_0x41ff0b['exec']),DEFAULT_CA_FOLDER=a0_0x5a6806(0x29b),deviceFolder=a0_0x42919a['join'](a0_0x58da01['homedir'](),a0_0x5a6806(0x289)),TUNNEL_INTERFACE_NAME=a0_0x5a6806(0x22e),runningConfigFile=a0_0x42919a['join'](a0_0x58da01[a0_0x5a6806(0x2b8)](),TUNNEL_INTERFACE_NAME+a0_0x5a6806(0x33d)),sep=a0_0x5a6806(0x31c),SHIELD_CA_CERTIFICATES=[a0_0x42919a['join'](__dirname,a0_0x5a6806(0x274)),a0_0x42919a['join'](__dirname,a0_0x5a6806(0x321))],PRODUCT={'ZTEDGE':a0_0x5a6806(0x22e),'CLOUD_NATIVE':a0_0x5a6806(0x27d)},CLOUD_NATIVE_HOSTS={'dev':a0_0x5a6806(0x239),'qa':a0_0x5a6806(0x242),'staging':'staging-zteapi.ericomcloud.net','cloud':a0_0x5a6806(0x31a)};let REDIRECT_URL,REDIRECT_PORT,shutdownInProgress=0x0,DEFAULT_CLOUD_NATIVE=process[a0_0x5a6806(0x249)][a0_0x5a6806(0x2a0)]??a0_0x5a6806(0x2dc);async function webGet(_0x568bfb,_0x26e41c,_0x3aade4){const _0x54c851=a0_0x5a6806;debugLog(_0x3aade4,'----\x20GET\x20'+_0x568bfb+_0x54c851(0x286));try{let _0x3b26a5=await a0_0x35baa7(_0x568bfb,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x54c851(0x1cb),'https':{'rejectUnauthorized':_0x26e41c},'timeout':{'request':0x1e*0x3e8}});return debugLog(_0x3aade4,_0x3b26a5['body']),debugLog(_0x3aade4,'------------------------'),_0x3b26a5[_0x54c851(0x28f)];}catch(_0x52ed6e){debugLog(_0x3aade4,_0x54c851(0x1f3)+_0x52ed6e[_0x54c851(0x305)]),debugLog(_0x3aade4,'------------------------');throw _0x52ed6e;}}async function isValidZteTenant(_0x867345,_0x135056){const _0x34ed1b=a0_0x5a6806;try{let _0x1ab84b=_0x34ed1b(0x273)+_0x867345+_0x34ed1b(0x34f)+_0x867345+_0x34ed1b(0x25a)+CLIENT_VERSION+_0x34ed1b(0x28e)+CLIENT_PLATFORM,_0x341b92=await webGet(_0x1ab84b,!_0x135056[_0x34ed1b(0x2c3)],_0x135056);return _0x341b92;}catch(_0x5a317e){return null;}}async function isValidCloudNativeTenant(_0x2d78fe,_0xe50989,_0x140fa0){const _0x4ed899=a0_0x5a6806;let _0x56fa1b=CLOUD_NATIVE_HOSTS[_0xe50989]??_0xe50989;try{let _0x5758da=_0x4ed899(0x273)+_0x56fa1b+'/api/v1/ztedge/client/SystemVersionAndTenantFeatures/'+_0x2d78fe+_0x4ed899(0x25a)+CLIENT_VERSION+_0x4ed899(0x28e)+CLIENT_PLATFORM,_0x64e535=await webGet(_0x5758da,!_0x140fa0[_0x4ed899(0x2c3)],_0x140fa0);return _0x64e535;}catch(_0x2108dc){return null;}}async function adjustTenantName(_0xa92661,_0x346f66){const _0x5e52c2=a0_0x5a6806;let _0x3357d9=_0xa92661[_0x5e52c2(0x245)](/(.*)@(.*)/);if(_0x3357d9){let _0x35bdac=await isValidCloudNativeTenant(_0x3357d9[0x1],_0x3357d9[0x2],_0x346f66);if(_0x35bdac)return{'tenant':_0x3357d9[0x1],'cloudNative':_0x3357d9[0x2],'systemInfo':_0x35bdac};}else{let _0x5a31ee=await isValidZteTenant(_0xa92661,_0x346f66);if(_0x5a31ee)return{'tenant':_0xa92661,'cloudNative':null,'systemInfo':_0x5a31ee};let _0x48da44=await isValidCloudNativeTenant(_0xa92661,DEFAULT_CLOUD_NATIVE,_0x346f66);if(_0x48da44)return{'tenant':_0xa92661,'cloudNative':DEFAULT_CLOUD_NATIVE,'systemInfo':_0x48da44};}throw new ErrorWithoutStacktrace('Cannot\x20contact\x20tenant\x20'+_0xa92661+'.\x20\x20Perhaps\x20there\x20is\x20a\x20certificate\x20issue.');}async function getCloudData(_0x39533e,_0x15bc28){const _0x900ab9=a0_0x5a6806;let {tenant:_0x11461d,cloudNative:_0x1ee623,systemInfo:_0x28ef03}=await adjustTenantName(_0x39533e,_0x15bc28),_0x466d81;if(_0x1ee623){let _0x109447=CLOUD_NATIVE_HOSTS[_0x1ee623]??_0x1ee623;_0x466d81={'tenant':_0x11461d,'getLoginInformationUrl':_0x900ab9(0x273)+_0x109447+_0x900ab9(0x2d3)+_0x11461d,'authenticatedUrl':'https://'+_0x109447+_0x900ab9(0x2da)+_0x11461d,'gwName':null,'newApiTemplate':_0x900ab9(0x273)+_0x109447+_0x900ab9(0x1e2)+_0x11461d};}else _0x466d81={'tenant':_0x11461d,'getLoginInformationUrl':_0x900ab9(0x273)+_0x11461d+_0x900ab9(0x322),'authenticatedUrl':_0x900ab9(0x273)+_0x11461d+_0x900ab9(0x32a),'gwName':_0x11461d+_0x900ab9(0x350),'newApiTemplate':_0x900ab9(0x273)+_0x11461d+_0x900ab9(0x219)+_0x11461d};return{'cloudData':_0x466d81,'systemInfo':_0x28ef03};}class ErrorWithoutStacktrace extends Error{constructor(_0x4ee2b2){const _0x3d141f=a0_0x5a6806;super(_0x4ee2b2),this[_0x3d141f(0x246)]=_0x3d141f(0x332);}}async function callZteApi(_0x186dbf,_0x4e4522,_0xec9655,_0x2f5218){const _0x38c413=a0_0x5a6806;let _0x1a9a29;_0x186dbf=_0xec9655['newApiTemplate'][_0x38c413(0x233)](_0x38c413(0x316),_0x186dbf);try{debugLog(_0x2f5218,_0x38c413(0x2aa)+_0x186dbf+_0x38c413(0x286)),debugLog(_0x2f5218,_0x4e4522),_0x1a9a29=await a0_0x35baa7[_0x38c413(0x34e)](_0x186dbf,{'json':_0x4e4522,'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':'json','https':{'rejectUnauthorized':!_0xec9655['ignoreCertificateErrors']},'timeout':{'request':0x1e*0x3e8}}),debugLog(_0x2f5218,_0x1a9a29[_0x38c413(0x28f)]),debugLog(_0x2f5218,'------------------------');}catch(_0x34af12){debugLog(_0x2f5218,_0x34af12[_0x38c413(0x305)]),debugLog(_0x2f5218,_0x38c413(0x235));throw new ErrorWithoutStacktrace('Cannot\x20contact\x20tenant.\x20'+_0x34af12['message']);}if(_0x1a9a29[_0x38c413(0x2c2)]!==0xc8)throw new ErrorWithoutStacktrace('Got\x20http\x20response\x20'+_0x1a9a29['statusCode']+':\x20'+_0x1a9a29[_0x38c413(0x340)]);return _0x1a9a29[_0x38c413(0x28f)];}async function readPassword(_0x2f9b16,_0x5dab7c=a0_0x5a6806(0x201)){const _0x2266f8=a0_0x5a6806;if(process['stdin'][_0x2266f8(0x238)])return await a0_0x501593(_0x2f9b16,{'method':_0x5dab7c});else throw new ErrorWithoutStacktrace(_0x2266f8(0x202));}function canonicalizeVersionString(_0x4edab1,_0x5149cc){const _0x2e153b=a0_0x5a6806;let _0x2a9e45=_0x4edab1[_0x2e153b(0x245)](/(\d+)[.](\d+)(?:[.](\d+))?/);if(_0x2a9e45){const [,_0x235b27,_0x4adc2c,_0x2c5ee3]=_0x2a9e45;return _0x235b27[_0x2e153b(0x263)](0x4,'0')+_0x4adc2c['padStart'](0x4,'0')+(_0x2c5ee3??'0')['padStart'](0x4,'0');}else return _0x5149cc&&newError('error',_0x2e153b(0x326)+_0x4edab1),null;}function versionLTE(_0x35b26d,_0x326fe9){let _0x5ad1cb=canonicalizeVersionString(_0x35b26d,!![]),_0x194011=canonicalizeVersionString(_0x326fe9,!![]);return _0x5ad1cb<=_0x194011;}function versionLT(_0x5dc742,_0x4a3f51){let _0x10c8d1=canonicalizeVersionString(_0x5dc742,!![]),_0x9e89ae=canonicalizeVersionString(_0x4a3f51,!![]);return _0x10c8d1<_0x9e89ae;}function versionGTE(_0x453595,_0x436f18){let _0x11580d=canonicalizeVersionString(_0x453595,!![]),_0x3514d6=canonicalizeVersionString(_0x436f18,!![]);return _0x11580d>=_0x3514d6;}const PAGE_FRAME=a0_0x5a6806(0x20a);function startHttpListener(_0x243f34,_0x389eb5){const _0x34949a=a0_0x5a6806;let _0x9ae33f=a0_0x53eb06[_0x34949a(0x293)](function(_0x8b57de,_0x567ddf){const _0x250f8c=_0x34949a;let _0x327c53='';_0x8b57de['on'](_0x250f8c(0x2a8),_0x437a62=>{_0x327c53+=_0x437a62;}),_0x8b57de['on'](_0x250f8c(0x32e),()=>{const _0x24c94a=_0x250f8c;let _0x5de9f7=_0x389eb5(_0x8b57de[_0x24c94a(0x1fa)],_0x327c53);_0x327c53='',_0x567ddf[_0x24c94a(0x209)](0xc8,{'Content-Type':_0x24c94a(0x30c)});let _0x1e5ea8=PAGE_FRAME[_0x24c94a(0x233)](_0x24c94a(0x1c7),_0x5de9f7);_0x567ddf['end'](_0x1e5ea8);});});return _0x9ae33f[_0x34949a(0x206)](_0x243f34),_0x9ae33f;}async function handleBrowser(_0x5ea6d5,_0x4075c7,_0x55dbbd,_0x565e6d,_0x2ebaab){const _0x423cb7=a0_0x5a6806;let _0x4d8892;const _0x49815=new Promise((_0x14efa2,_0x7b1ceb)=>{let _0x2bf133=startHttpListener(REDIRECT_PORT,(_0x51cfad,_0x54aa2d)=>{const _0xff2d10=a0_0x2d17;return _0x4d8892=a0_0xfb3f92[_0xff2d10(0x21f)](_0x51cfad,!![])[_0xff2d10(0x28d)],(!_0x4d8892['state']||!_0x4d8892[_0xff2d10(0x1ea)]||!_0x4d8892[_0xff2d10(0x338)])&&(_0x4d8892=null),_0x14efa2(),_0x4d8892?_0xff2d10(0x2a7):_0xff2d10(0x247);});});let _0x2fac78=_0x4075c7+(_0x423cb7(0x2df)+REDIRECT_URL);if(![]&&await fileExists('/opt/google/chrome/chrome'))exec(_0x423cb7(0x2a6)+_0x2fac78+'\x22');else{if(Promise[_0x423cb7(0x298)]){let _0x394a1a,_0xb1456f=0x3e8;try{_0x394a1a=await Promise[_0x423cb7(0x298)]([execNoThrow('sensible-browser\x20\x22'+_0x2fac78+'\x22'),a0_0x2f99f5[_0x423cb7(0x34c)](_0xb1456f)]);}catch(_0x4f18a8){throw new ErrorWithoutStacktrace('Error\x20launching\x20external\x20browser:\x20'+_0x4f18a8[_0x423cb7(0x305)]);}if(_0x394a1a!==_0xb1456f&&_0x394a1a['code']!==0x0){let _0x5a338b=_0x394a1a[_0x423cb7(0x1fc)]['trim']();_0x5a338b&&(_0x5a338b+='\x0a');_0x5a338b+=_0x394a1a['stderr'][_0x423cb7(0x218)]();throw new ErrorWithoutStacktrace('Error\x20launching\x20external\x20browser:\x20'+_0x5a338b);}}else execNoThrow(_0x423cb7(0x2ee)+_0x2fac78+'\x22');}await _0x49815;if(!_0x4d8892)throw new ErrorWithoutStacktrace(_0x423cb7(0x259));return _0x4d8892;}async function handleUserPassword(_0x43b5bf,_0x1dae06,_0x587423,_0x42ae5d){const _0x4e0a73=a0_0x5a6806;let _0x94ab1b=_0x1dae06+('&redirect_uri='+REDIRECT_URL),_0x21e1be;if(!_0x42ae5d&&!process['stdin'][_0x4e0a73(0x238)])throw new ErrorWithoutStacktrace(_0x4e0a73(0x28b));try{_0x21e1be=await a0_0x35baa7(_0x94ab1b,{'throwHttpErrors':![],'retry':{'limit':0x0},'https':{'rejectUnauthorized':!_0x43b5bf[_0x4e0a73(0x2c3)]},'timeout':{'request':0xf*0x3e8}});if(_0x21e1be[_0x4e0a73(0x2c2)]!==0xc8)throw new ErrorWithoutStacktrace(_0x4e0a73(0x2d4)+_0x21e1be['statusCode']+':\x20'+_0x21e1be[_0x4e0a73(0x340)]);!_0x42ae5d&&(_0x42ae5d=await readPassword(_0x4e0a73(0x290)+_0x587423+':\x20'));}catch(_0x467105){let _0x3d896d=new URL(_0x1dae06);throw new ErrorWithoutStacktrace('Unable\x20to\x20connect\x20to\x20IAM\x20server\x20'+_0x3d896d[_0x4e0a73(0x234)]+':\x20'+_0x467105[_0x4e0a73(0x305)]);}let _0xeba80c=_0x21e1be[_0x4e0a73(0x28f)][_0x4e0a73(0x245)](/action="(.*?)"/),_0x428b39=_0xeba80c[0x1]['replace'](/&amp;/g,'&'),_0x4312aa=_0x21e1be['headers']['set-cookie'][_0x4e0a73(0x2d0)](_0x6c96cd=>{const _0x53d99d=_0x4e0a73;let _0x2a15d5=_0x6c96cd[_0x53d99d(0x245)](/^(.*?)=(.*?);/);return _0x2a15d5[0x1]+'='+_0x2a15d5[0x2];})['join'](';\x20'),_0x43141f=await a0_0x35baa7[_0x4e0a73(0x34e)](_0x428b39,{'headers':{'cookie':_0x4312aa,'content-type':_0x4e0a73(0x1c8)},'form':{'username':_0x587423,'password':_0x42ae5d},'throwHttpErrors':![],'retry':{'limit':0x0},'followRedirect':![],'https':{'rejectUnauthorized':!_0x43b5bf[_0x4e0a73(0x2c3)]}});if(_0x43141f[_0x4e0a73(0x2c2)]===0xc8){let _0x1c2d5d=_0x43141f[_0x4e0a73(0x28f)]['includes'](_0x4e0a73(0x1dc));if(_0x1c2d5d)throw new ErrorWithoutStacktrace(_0x4e0a73(0x32f));}else{if(_0x43141f[_0x4e0a73(0x2c2)]!==0x12e)throw new ErrorWithoutStacktrace(_0x4e0a73(0x226)+_0x43141f[_0x4e0a73(0x2c2)]+':\x20'+_0x43141f[_0x4e0a73(0x340)]);}if(!_0x43141f['headers'][_0x4e0a73(0x32d)])throw new ErrorWithoutStacktrace(_0x4e0a73(0x262));let _0x21ad06=a0_0xfb3f92[_0x4e0a73(0x21f)](_0x43141f[_0x4e0a73(0x319)][_0x4e0a73(0x32d)],!![])['query'];if(!_0x21ad06[_0x4e0a73(0x330)]||!_0x21ad06[_0x4e0a73(0x1ea)]||!_0x21ad06[_0x4e0a73(0x338)])throw new ErrorWithoutStacktrace(_0x4e0a73(0x259));return _0x21ad06;}async function getOs(){const _0x124a44=a0_0x5a6806;let _0x15949d=a0_0x58da01[_0x124a44(0x207)]()+'\x20'+a0_0x58da01[_0x124a44(0x258)]();try{let _0x4fb31e=await exec('lsb_release\x20-d\x20-s');_0x15949d=_0x4fb31e['stdout']?.[_0x124a44(0x218)]()??_0x15949d;}catch{}return _0x15949d;}async function doUpgrade(_0x5723ad,_0x597629){const _0x2ed1ca=a0_0x5a6806;try{console['log']('Downloading\x20update\x20package.');let _0x120eaa=a0_0x951157[_0x2ed1ca(0x2b3)]({'suffix':a0_0x42919a[_0x2ed1ca(0x2ae)](_0x5723ad[_0x2ed1ca(0x1fa)])}),_0x3a8bad=createWriteStream(_0x120eaa),_0x45b418=a0_0x35baa7[_0x2ed1ca(0x333)](_0x5723ad[_0x2ed1ca(0x1fa)]),_0x2049c0=new Promise(function(_0xa918aa,_0x462f2e){const _0x14bcd8=_0x2ed1ca;_0x45b418['on'](_0x14bcd8(0x203),({transferred:_0xb58a0b,total:_0x12fa9e,percent:_0x113e9a})=>{}),_0x45b418['on'](_0x14bcd8(0x21d),_0x112d64=>_0x462f2e(_0x112d64)),_0x3a8bad['on'](_0x14bcd8(0x1ee),()=>_0xa918aa()),_0x3a8bad['on'](_0x14bcd8(0x21d),_0x511efa=>_0x462f2e(_0x511efa)),_0x45b418[_0x14bcd8(0x1fd)](_0x3a8bad);});await _0x2049c0;let _0x5d804b=_0x5723ad[_0x2ed1ca(0x1e6)]?_0x5723ad[_0x2ed1ca(0x1e6)]:_0x2ed1ca(0x313);_0x5d804b=_0x5d804b[_0x2ed1ca(0x233)](_0x2ed1ca(0x1cd),_0x120eaa);if(_0x597629['service']){let _0x4da154=_0x2ed1ca(0x256);await fileExists(_0x4da154)&&await a0_0x39e7c3[_0x2ed1ca(0x2e6)](_0x4da154),console[_0x2ed1ca(0x281)](_0x2ed1ca(0x2b7)+_0x4da154),a0_0x41ff0b[_0x2ed1ca(0x329)]('at',[_0x2ed1ca(0x227)],{'input':_0x5d804b+'\x20>\x20'+_0x4da154}),process['exit'](0x0);}else{if(process['env']['ZTE_UPGRADE_FILE']){let _0x540151=_0x5d804b+'\x0a'+(_0x2ed1ca(0x346)+_0x120eaa+'\x20'+process['env'][_0x2ed1ca(0x337)]+'\x0a');await a0_0x39e7c3[_0x2ed1ca(0x2bf)](process[_0x2ed1ca(0x249)][_0x2ed1ca(0x337)],_0x540151,_0x2ed1ca(0x32c)),process['exit'](0x0);}else console[_0x2ed1ca(0x281)](_0x2ed1ca(0x1e4)+_0x5d804b),process[_0x2ed1ca(0x272)](0x0);}}catch(_0x542ebe){console[_0x2ed1ca(0x21d)](_0x2ed1ca(0x2bc)+_0x542ebe[_0x2ed1ca(0x305)]);}}let didInform=![];async function processUpgrade(_0x216124,_0x130ebb){const _0x47108b=a0_0x5a6806;debugLog('Process\x20upgrade\x20isService='+_0x130ebb?.['service']+_0x47108b(0x243)+_0x216124?.[_0x47108b(0x33f)]);if(_0x130ebb?.[_0x47108b(0x1fe)]&&_0x216124?.[_0x47108b(0x211)]===!![])return;if((_0x216124?.[_0x47108b(0x33f)]??'none')===_0x47108b(0x2fc))return;else{if(!_0x130ebb['service']&&_0x216124['mode']==='inform'){if(didInform&&_0x216124[_0x47108b(0x211)])return;didInform=!![];let _0x537f26;if(_0x130ebb[_0x47108b(0x221)])_0x537f26=!![];else{console[_0x47108b(0x281)](_0x216124[_0x47108b(0x305)]);let _0x25e7d5=a0_0x73d9d8[_0x47108b(0x2f1)](_0x47108b(0x1e0));_0x537f26=_0x25e7d5==='y';}_0x537f26&&await doUpgrade(_0x216124,_0x130ebb);}else await doUpgrade(_0x216124,_0x130ebb);}!_0x216124[_0x47108b(0x211)]&&(console[_0x47108b(0x281)]('Exiting\x20because\x20this\x20software\x20version\x20cannot\x20be\x20used.'),process['exit'](0x1));}function a0_0x3f62(){const _0x2f8f06=['Create\x20a\x20service\x20named\x20\x22ztedge\x22\x20which\x20will\x20control\x20the\x20specified\x20connection.\x0a','restorePac','extname','password','auto','systemVersion','3ZgyWQa','path','Proxy\x20settings\x20cleared','Tunnel\x20is\x20not\x20running\x20...\x20','pacFile','Upgrade\x20log\x20will\x20be\x20in\x20','tmpdir','proxySettings','verbose','action','Upgrade\x20failed:\x20','systemctl\x20status\x20ztedge','up\x20[<cloudId>]\x20[<user>]','writeFile','Request\x20PID\x20','max','statusCode','ignoreCertificateErrors','\x20not\x20found.','ZTEdge\x20tunnel\x20is\x20currently\x20active','Show\x20debug\x20output','Being\x20monitored\x20by\x20','defaultInterface','Only\x20one\x20such\x20service\x20can\x20be\x20in\x20effect.\x20\x20This\x20will\x20not\x20have\x20access\x20to\x20profiles\x20create\x20w/o\x20sudo.\x0a','clientPing','createService\x20[<cloudId>]\x20[<user>]','networkInterfaces','Server\x20told\x20us\x20to\x20shutdown\x20connection:\x20','PersistentKeepalive\x20=\x205\x0a','ipHeuristicsEnabled','map','Create\x20and\x20maintain\x20connections\x20to\x20ZTEdge','no-data','/api/v1/ztedge/client/getlogininformation/','authentication\x20redirect\x20error:\x20','[Interface]\x0a','public','tunnel','Stop\x20the\x20currently\x20running\x20tunnel\x0a','Tunnel\x20is\x20functioning\x20properly','/api/v1/ztedge/client/authenticated/','(.*)[.]conf','cloud','caCertificates','/32','&redirect_uri=','sudo\x20ip\x20link\x20delete\x20dev\x20','cannot\x20generate\x20publickey','\x20--verbose','authenticationCompleted','systemctl\x20start\x20ztedge','addCAs','unlink','import','--connector','filter','gsettings\x20set\x20org.gnome.system.proxy\x20autoconfig-url\x20\x27','IP:\x20','[Service]\x0a','authenticationToken','sensible-browser\x20\x22','Use\x20\x22journalctl\x20-u\x20ztedge\x20|\x20tail\x22\x20to\x20see\x20any\x20service\x20messages','-v|--verbose','question','clientSettings','Profiles\x20are\x20stored\x20in\x20','No\x20matching\x20profiles','serverEndpoint','authenticateOnly','resolvconf:\x20command\x20not\x20found','createPeer','createService','-b|--background','wireguard/linux-client','none','new\x20<cloudId>\x20<user>','launchFromToken\x20<cloudId>\x20<user>\x20<token>','getClientSettingsFrequencySec','authenticationURL','--password\x20<password>','pubkey','deviceInfo','private','message','656001xoHJWk','parseAsync','Create\x20a\x20new\x20profile\x20and\x20start\x20the\x20tunnel.\x0a','Send\x20shutdown\x20again\x20to\x20force\x20immediate\x20shutdown','oldProxyPac','privateKey','text/html;\x20charset=UTF-8','Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x20with\x20authentication\x20token\x0a','2541987pfqFXV','^(.*)','SHORT_TIMES','\x20seconds\x20...\x20','wg-quick\x20up\x20','sudo\x20bash\x20\x22{installPackage}\x22','down','Use\x20MASQUERADE\x20to\x20','${api}','authenticationType','reconnecting\x20...','headers','zteapi.ericomcloud.net','Failed\x20to\x20signal.\x20\x20Trying\x20local\x20kill','---','min','monitorPid','padEnd','--reconnectTimeoutSec\x20<num>','ericomshield-new.crt','.zerotrustedge.com:8444/api/client/getlogininformation','gsettings\x20get\x20org.gnome.system.proxy\x20mode','Tunnel\x20did\x20not\x20start:\x0a','user','cannot\x20parse\x20version\x20','deviceType','Shutdown\x20connector\x20routing','spawnSync','.zerotrustedge.com:8444/api/client/authenticated','\x20--device-name\x20\x22','utf8','location','end','Invalid\x20credentials','state','3.4.0','ErrorWithoutStacktrace','stream','Cannot\x20update\x20client\x20settings:\x20','ztedge-client\x20launchFromToken\x20\x22','connectionAllowed','ZTE_UPGRADE_FILE','session_state','Proxy\x20mode\x20restored\x20to\x20','The\x20configuration\x20file\x20for\x20the\x20current\x20tunnel\x20has\x20been\x20deleted.\x20\x20Attempting\x20to\x20shutdown\x20anyway\x20...','argv','3.5.0','.conf','You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20If\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a','mode','statusMessage','--service','ztedge\x20service\x20created,\x20but\x20not\x20started\x20or\x20enabled','Reconnect\x20failed:\x20','keyPair','::/0','rm\x20-f\x20','allowExcessArguments','Service\x20creation\x20error:\x20','Tunnel\x20not\x20launched','DNS\x20=\x20','linux','sleepMs','--ignoreCertificateErrors','post','.zerotrustedge.com:8444/api/v1/ztedge/client/SystemVersionAndTenantFeatures/','-gateway.zerotrustedge.com','Logout\x20failed:\x20','You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20if\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a','Address\x20=\x20','readFile','List\x20the\x20currently\x20available\x20profiles\x0a','command','$body$','application/x-www-form-urlencoded','Tunnel\x20did\x20not\x20shutdown:\x0a','\x09(.+?)\x09(.+?)\x09(.+?)\x09(.+?)\x09','json','dirname','{installPackage}','\x22\x20\x22','userName','userId','\x20already\x20exists.\x20\x20Use\x20--force\x20to\x20replace\x20it.','description','1622072acmsoK','keepAliveFrequencySec','Saved\x20','ignore\x20certificate\x20errors','new','keepAlive','includes','Error\x20talking\x20to\x20gateway:\x20','clientData','Invalid\x20username\x20or\x20password','length','Start\x20monitoring','Comma\x20separated\x20list\x20of\x20folders\x20and\x20files\x20containing\x20additional\x20CA\x20certificates.','Would\x20you\x20like\x20to\x20upgrade\x20now\x20(y/n)\x20?\x20','[Install]\x0a','/api/v1/ztedge/client/${api}/','Replace\x20existing\x20profile','Upgrade\x20by\x20running\x20the\x20command:\x20','Warning:\x20','installerCommandLine','/etc/systemd/system/ztedge.service','authenticationInfo','push','code','username\x20must\x20be\x20specified','---\x20system\x20info\x20----','WantedBy=multi-user.target\x0a','finish','Authentication\x20failed:\x20','PublicKey\x20=\x20','join','sudo\x20iptables\x20-A\x20POSTROUTING\x20-t\x20nat\x20-o\x20','Error:\x20','108CNbjHb','Connected\x20as:\x20','serverPublicKey','status','Connector\x20started','--device-name\x20<name>','url','--ca-certificates\x20<certs>','stdout','pipe','upgradeOnlyIfNotUsable','devicePrivateKey','-\x20\x20create\x20and\x20start\x20the\x20service\x20with\x20\x22sudo\x20ztedge-client\x20createService\x20...\x22','hide','Password\x20can\x20only\x20be\x20read\x20from\x20a\x20tty','downloadProgress','_name','write','listen','platform','service','writeHead','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a\x20\x20<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22utf-8\x22>\x0a\x20\x20\x20\x20<title>ZTEdge</title>\x0a\x20\x20</head>\x0a\x20\x20<body>\x0a\x20\x20\x20\x20$body$\x0a</html>','tenant','Exiting\x20ztedge-client','supportsClientPing','sendGatewayIp','Tunnel\x20started','#\x20systemInfo\x20=\x20','currentVersionCanConnect','[\x20short\x20times\x20]','0.0.0.0/0','promisify','/auth_resp','contains','product','trim','.zerotrustedge.com:8444/api/v1/ztedge/client/${api}/','RestartSec=15s\x0a','\x20-j\x20MASQUERADE','Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20was\x20not\x20specified.','error','createDevice','parse','stderr','upgrade','30ZKVScy','0600','--pingIntervalSec\x20<num>','postureCheckFrequencySec','Did\x20not\x20get\x20expected\x20status.\x20\x20Received\x20','now','--browser','14721300pcVUpo','(.*)','Unable\x20to\x20start\x20ztedge\x20service:\x20','debug','Unable\x20to\x20enable\x20ztedge\x20service:\x20','ztedge','-\x20\x20create\x20a\x20profile\x20with\x20\x22sudo\x20ztedge-client\x20new\x20tenant\x20user\x20[--connector]\x20--authenticate-only\x20...\x22\x0a','browser','[Unit]\x0a','doNewApiLaunchTunnel\x20wg-quick\x20result','replace','hostname','------------------------','toString','835912qHRScp','isTTY','dev-zteapi.ericomcloud.net','ExecStart=','ZTEDGE','kill','username\x20is\x20required\x20for\x20a\x20pre-3.5\x20server\x20and/or\x20if\x20a\x20password\x20is\x20required\x20to\x20authenticate','GetPreLaunchInfo','gatewayServicesUrl','\x20up\x20\x22','do\x20not\x20enable\x20and\x20start\x20the\x20service','qa-zteapi.ericomcloud.net',';\x20\x20upgradeMode=','SIGTERM','match','name','<h1>Authentication\x20Failed</h1>','gsettings\x20get\x20org.gnome.system.proxy\x20autoconfig-url','env','oldMode','/tmp/ztedge-client.log','--no-launch','CLOUD_NATIVE','\x20--debug','start','background','1067945KVsJni','publicKey','deviceName','No\x20saved\x20profiles','upgrade\x20if\x20available','/tmp/zte-upgrade.log','648792HyIzwU','release','Authorization\x20failed\x20(unknown\x20reason)','?version=','\x20failed:\x20','Only\x20used\x20if\x20--browser\x20is\x20not\x20specified.\x20Password\x20for\x20the\x20ZTEdge\x20user.\x0aYou\x20will\x20be\x20prompted\x20if\x20a\x20password\x20is\x20needed\x20and\x20was\x20not\x20specified.','launch','upgradeInfo','Start\x20a\x20tunnel\x20using\x20an\x20existing\x20profile\x0a','Authenticated\x20and\x20authorized','dnsServers','Did\x20not\x20receive\x20authentication\x20information','padStart','pid','read\x20from\x20the\x20root\x20user\x27s\x20profile\x20folder','echo\x201\x20|\x20sudo\x20tee\x20/proc/sys/net/ipv4/ip_forward','sudo\x20iptables\x20-D\x20POSTROUTING\x20-t\x20nat\x20-o\x20','Endpoint\x20=\x20','Only\x20do\x20the\x20authentication/profileManagement\x20and\x20do\x20not\x20launch\x20the\x20tunnel','Check\x20tunnel\x20handshake\x20=>\x20','gsettings\x20set\x20org.gnome.system.proxy\x20mode\x20','Logging\x20to\x20','findSpanningList','sudo\x20wg\x20show\x20ztedge\x20dump','Will\x20try\x20to\x20reconnect\x20in\x20','monitor','wg-quick\x20down\x20','exit','https://','ericomshield.crt','gatewayDns','device\x20name','How\x20long\x20(since\x20the\x20last\x20successful\x20ping\x20to\x20initiate\x20a\x20reconnect)\x20','Reconnect\x20succeeded','\x20--ignoreCertificateErrors','Show\x20details','Error\x20configuring\x20connector:\x20','--authenticateOnly|--authenticate-only','cloud-native','postureChecks','find','readdir','log','access','Tunnel\x20did\x20not\x20start.\x20\x20Install\x20openresolv\x20with\x20\x27sudo\x20apt\x20install\x20openresolv\x27','split','Use\x20browser\x20based\x20authentication','\x20----','connector','sudo\x20resolvconf\x20-d\x20ztedge','.ztedge','/clientPing','Can\x20only\x20read\x20password\x20from\x20a\x20TTY','version','query','&platform=','body','Password\x20for\x20','exitCode','3.9.15','createServer','all','http://127.0.0.1:','fileURLToPath','Multiple\x20profiles\x20match','any','waitFor','\x20--ca-certificates\x20\x22','/usr/local/share/ca-certificates','\x5c$&','\x20--device-name\x20','sleepTill','\x20--service','DEFAULT_CLOUD_NATIVE','Peer\x20creation\x20failed:\x20','userMessage','force','stringify','option','/opt/google/chrome/chrome\x20--incognito\x20\x22','<h1>Authentication\x20Succeeded</h1>','data','Tunnel\x20is\x20not\x20functioning\x20properly','----\x20POST\x20','resolve'];a0_0x3f62=function(){return _0x2f8f06;};return a0_0x3f62();}async function getSystemInfo(_0x5d795d,_0x20dcf1){const _0x3002b6=a0_0x5a6806;let {cloudData:_0x304c9e,systemInfo:_0x582403}=await getCloudData(_0x5d795d,_0x20dcf1);!_0x582403['product']&&(_0x582403[_0x3002b6(0x217)]=PRODUCT[_0x3002b6(0x23b)]);_0x582403[_0x3002b6(0x217)]===PRODUCT[_0x3002b6(0x24d)]&&(_0x582403['systemVersion']=_0x582403[_0x3002b6(0x2b1)][_0x3002b6(0x233)](/^.*-/,''));Object['assign'](_0x582403,_0x304c9e);if(_0x582403[_0x3002b6(0x217)]===PRODUCT[_0x3002b6(0x24d)])_0x582403['sendGatewayIp']=![],_0x582403['ignoreCertificateErrors']=_0x20dcf1[_0x3002b6(0x2c3)]||![],_0x582403[_0x3002b6(0x20d)]=!![];else{if(versionLT(_0x582403[_0x3002b6(0x2b1)],'3.5.0'))throw new ErrorWithoutStacktrace('Requires\x20ztedge\x20server\x20version\x20>=\x203.5');_0x582403[_0x3002b6(0x20e)]=!![],_0x582403['ignoreCertificateErrors']=_0x20dcf1[_0x3002b6(0x2c3)]||versionLT(_0x582403[_0x3002b6(0x2b1)],_0x3002b6(0x33c)),_0x582403[_0x3002b6(0x20d)]=versionGTE(_0x582403[_0x3002b6(0x2b1)],_0x3002b6(0x331));}_0x582403['getLoginInformationUrl']=null,_0x582403['authenticatedUrl']=null,debugLog(_0x20dcf1,_0x3002b6(0x1ec)),debugLog(_0x20dcf1,_0x582403);let _0x5b5c00=_0x582403[_0x3002b6(0x25e)];return _0x5b5c00&&_0x5b5c00['mode']!==_0x3002b6(0x2fc)&&await processUpgrade(_0x5b5c00,_0x20dcf1),_0x582403;}async function generateKeyPair(){const _0x56121d=a0_0x5a6806;let _0x556a2c=(await exec('wg\x20genkey'))['stdout'][_0x56121d(0x218)]();const _0x4630b6=a0_0x41ff0b['spawnSync']('wg',[_0x56121d(0x302)],{'input':_0x556a2c+'\x0a'});if(_0x4630b6[_0x56121d(0x1f7)]!==0x0)throw new ErrorWithoutStacktrace('cannot\x20generate\x20keypair');return{'public':_0x4630b6['stdout'][_0x56121d(0x236)]()[_0x56121d(0x218)](),'private':_0x556a2c};}async function newApiCreateDevice(_0x544485,_0x283c62,_0xf8cf2f,_0x4d00d8,_0x37837b){const _0x16677b=a0_0x5a6806;let _0x32326b=await generateKeyPair(),_0x3310f8={'platform':CLIENT_PLATFORM,'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'deviceName':_0x283c62,'deviceType':_0x37837b['connector']?'connector':_0x16677b(0x325),'devicePublicKey':_0x32326b[_0x16677b(0x2d6)]};_0x3310f8['deviceType']===_0x16677b(0x287)&&(_0x3310f8['authentication']={'name':_0xf8cf2f,'password':_0x4d00d8});let _0xcbe845=await callZteApi(_0x16677b(0x21e),_0x3310f8,_0x544485,_0x37837b);return _0xcbe845=await newApiCompleteAuthentication(_0x544485,_0xcbe845,_0xf8cf2f,_0x4d00d8,_0x37837b),{'authenticationInfo':_0xcbe845,'keyPair':_0x32326b,'deviceType':_0x3310f8[_0x16677b(0x327)]};}async function newApiCompleteAuthentication(_0x2fcafa,_0x41653f,_0x3bfe97,_0x5e95fc,_0x352847){const _0x526c8e=a0_0x5a6806;if(_0x41653f[_0x526c8e(0x317)]==='webAuthenticate'){if(_0x352847[_0x526c8e(0x208)]&&!_0x5e95fc)throw new ErrorWithoutStacktrace('Cannot\x20launch\x20ztedge\x20as\x20a\x20service\x20because\x20a\x20password\x20is\x20required');REDIRECT_PORT=(await a0_0x37ec35(0xbb8))[0x0],REDIRECT_URL=_0x526c8e(0x295)+REDIRECT_PORT+_0x526c8e(0x215);let _0x442bc4;_0x352847[_0x526c8e(0x230)]?_0x442bc4=await handleBrowser(_0x2fcafa,_0x41653f[_0x526c8e(0x300)],_0x3bfe97,_0x5e95fc):_0x442bc4=await handleUserPassword(_0x2fcafa,_0x41653f[_0x526c8e(0x300)],_0x3bfe97,_0x5e95fc),_0x41653f=await callZteApi(_0x526c8e(0x2e3),{'code':_0x442bc4['code'],'state':_0x442bc4[_0x526c8e(0x330)],'redirect_uri':REDIRECT_URL},_0x2fcafa,_0x352847);}if(_0x41653f[_0x526c8e(0x317)]!=='authenticated')throw new ErrorWithoutStacktrace(_0x526c8e(0x1ef)+JSON[_0x526c8e(0x2a4)](_0x41653f));return _0x41653f;}async function newApiAuthenticateDevice(_0x50aeb4,_0x42f25e,_0x175188,_0x20ea62){const _0x26cb80=a0_0x5a6806;let _0x4c0c5c={'operatingSystemInformation':await getOs(),'clientVersion':CLIENT_VERSION,'devicePublicKey':_0x42f25e[_0x26cb80(0x252)],'userId':_0x42f25e['userId']??''},_0x3e8790=await callZteApi('AuthenticateDevice',_0x4c0c5c,_0x50aeb4,_0x20ea62);return _0x3e8790=await newApiCompleteAuthentication(_0x50aeb4,_0x3e8790,_0x42f25e[_0x26cb80(0x325)],_0x175188,_0x20ea62),_0x3e8790;}async function newApiLaunchTunnel(_0xfd2d8f,_0xa10448,_0x576c3f,_0x53f0c3){const _0x1901ac=a0_0x5a6806;if(_0x53f0c3[_0x1901ac(0x270)]){process['on'](_0x1901ac(0x244),()=>initiateShutdown(_0x53f0c3)),process['on']('SIGINT',()=>initiateShutdown(_0x53f0c3));let _0x7b3325;try{_0x7b3325=await doNewApiLaunchTunnel(_0xfd2d8f,_0xa10448,_0x576c3f,_0x53f0c3);}catch(_0x8dfe89){if(!_0x53f0c3[_0x1901ac(0x208)])throw _0x8dfe89;_0x53f0c3[_0x1901ac(0x22c)]?console['log'](_0x8dfe89):console[_0x1901ac(0x281)](_0x8dfe89['message']);}if(!_0x53f0c3[_0x1901ac(0x25d)]){console[_0x1901ac(0x281)](_0x1901ac(0x349));return;}if(shutdownInProgress)return;await newApiMonitorTunnel(_0xa10448,_0x576c3f,_0x53f0c3,_0x7b3325?.[_0x1901ac(0x303)],_0x7b3325?.['clientSettings']);}else await doNewApiLaunchTunnel(_0xfd2d8f,_0xa10448,_0x576c3f,_0x53f0c3);}async function newApiMonitorTunnel(_0x273088,_0x1c8e7a,_0x25a9b6,_0x2463af,_0x1a4dd1){const _0x141ef3=a0_0x5a6806;console[_0x141ef3(0x281)](_0x141ef3(0x1de));let _0x37c8ac=Date[_0x141ef3(0x227)](),_0x44d5bc=_0x37c8ac,_0x18c138=_0x37c8ac;process[_0x141ef3(0x249)][_0x141ef3(0x310)]&&console[_0x141ef3(0x281)](_0x141ef3(0x212));let _0x180470=Boolean(_0x1a4dd1),_0x221216=0x5;while(!shutdownInProgress){if(_0x180470)try{process['env'][_0x141ef3(0x310)]&&(_0x1a4dd1['keepAlive']['keepAliveFrequencySec']=0x5,_0x1a4dd1[_0x141ef3(0x27e)][_0x141ef3(0x225)]=0x1e,_0x1a4dd1[_0x141ef3(0x2f2)][_0x141ef3(0x2ff)]=0xf);let _0x431ea5=_0x37c8ac+_0x1a4dd1[_0x141ef3(0x1d8)][_0x141ef3(0x1d4)]*0x3e8,_0x42a748=_0x44d5bc+_0x1a4dd1[_0x141ef3(0x27e)][_0x141ef3(0x225)]*0x3e8,_0xef4b82=_0x18c138+_0x1a4dd1[_0x141ef3(0x2f2)]['getClientSettingsFrequencySec']*0x3e8,_0x5b88e1=Date['now'](),_0x4d82d9=Math[_0x141ef3(0x2c1)](_0x5b88e1+0x3e8,Math['min'](_0x431ea5,_0x42a748,_0xef4b82));await a0_0x2f99f5[_0x141ef3(0x29e)](_0x4d82d9);if(shutdownInProgress)break;if(Date[_0x141ef3(0x227)]()>_0xef4b82){try{_0x1a4dd1=await getGatewayServices(_0x141ef3(0x2f2),_0x2463af,_0x273088,_0x25a9b6);}catch(_0x2ec913){console['log'](_0x141ef3(0x334)+_0x2ec913[_0x141ef3(0x305)]);}_0x18c138=Date[_0x141ef3(0x227)]();}if(shutdownInProgress)break;if(Date[_0x141ef3(0x227)]()>_0x431ea5){let _0x19a4ee=await getGatewayServices(_0x141ef3(0x2ca),_0x2463af,_0x273088,_0x25a9b6);_0x37c8ac=Date[_0x141ef3(0x227)]();}if(shutdownInProgress)break;if(Date[_0x141ef3(0x227)]()>_0x42a748){let _0x141caf={'postureCheckResults':{'results':[]}},_0x5e0a9c=await postGatewayServices(_0x141ef3(0x1db),_0x141caf,_0x2463af,_0x273088,_0x25a9b6);_0x44d5bc=Date['now']();if(!_0x5e0a9c['connectionAllowed'])throw new ErrorWithoutStacktrace(_0x141ef3(0x2cd)+_0x5e0a9c['userMessage']);}}catch(_0x146427){_0x180470=![],console[_0x141ef3(0x281)](_0x141ef3(0x1da)+_0x146427['message']);}if(!_0x180470){process[_0x141ef3(0x1fc)][_0x141ef3(0x205)](_0x141ef3(0x26f)+_0x221216+_0x141ef3(0x311)),await a0_0x2f99f5[_0x141ef3(0x34c)](_0x221216*0x3e8);if(shutdownInProgress)break;console[_0x141ef3(0x281)](_0x141ef3(0x318));try{await stopTunnel(_0x25a9b6),_0x25a9b6[_0x141ef3(0x1fe)]=!![];let _0xae05bc=await getSystemInfo(_0x1c8e7a[_0x141ef3(0x20b)],_0x25a9b6),_0x544ddf=await newApiAuthenticateDevice(_0xae05bc,_0x1c8e7a,null,_0x25a9b6),_0x5871d3=await doNewApiLaunchTunnel(_0x544ddf[_0x141ef3(0x2ed)],_0xae05bc,_0x1c8e7a,_0x25a9b6);_0x2463af=_0x5871d3[_0x141ef3(0x303)],_0x1a4dd1=_0x5871d3[_0x141ef3(0x2f2)],_0x37c8ac=_0x44d5bc=_0x18c138=Date[_0x141ef3(0x227)](),_0x180470=!![],_0x221216=0x5,console[_0x141ef3(0x281)](_0x141ef3(0x278));}catch(_0x7f5b49){_0x221216=Math[_0x141ef3(0x31d)](_0x221216*0x2,0x12c),console[_0x141ef3(0x281)](_0x141ef3(0x343)+_0x7f5b49['message']);}}}}async function setPacFile(_0x524a38,_0x5d46a5){const _0x1e9a37=a0_0x5a6806;let _0x32a9a0=await exec(_0x1e9a37(0x26b)+_0x524a38),_0x4cbd16=(await exec(_0x1e9a37(0x323)))?.[_0x1e9a37(0x1fc)]?.[_0x1e9a37(0x218)]()['replace'](/'/g,'');if(_0x4cbd16!==_0x524a38)throw new Error(_0x32a9a0['stderr'][_0x1e9a37(0x218)]());_0x32a9a0=await exec(_0x1e9a37(0x2ea)+_0x5d46a5+'\x27');let _0x314ccc=(await exec(_0x1e9a37(0x248)))?.[_0x1e9a37(0x1fc)]?.['trim']()[_0x1e9a37(0x233)](/'/g,'');if(_0x314ccc!==_0x5d46a5)throw new Error(_0x32a9a0[_0x1e9a37(0x220)][_0x1e9a37(0x218)]());}async function doNewApiLaunchTunnel(_0x31b9e0,_0x4cc8ef,_0x524e38,_0x5871b7){const _0x4f1969=a0_0x5a6806;let _0x1f0dc4={'authenticationToken':_0x31b9e0},_0x32bde9=await callZteApi(_0x4f1969(0x23e),_0x1f0dc4,_0x4cc8ef,_0x5871b7),_0x406aa7='';if(_0x32bde9['gatewayDns']){let _0x5f2a3f=await a0_0x3785f6[_0x4f1969(0x2ab)](_0x32bde9[_0x4f1969(0x275)]);if(_0x5f2a3f[_0x4f1969(0x1dd)]===0x0)throw new ErrorWithoutStacktrace('Cannot\x20resolve\x20'+_0x32bde9['gatewayDns']);let _0x15bbb5=Math['floor'](Math['random']()*_0x5f2a3f[_0x4f1969(0x1dd)]);_0x406aa7=_0x5f2a3f[_0x15bbb5];}_0x1f0dc4={'authenticationToken':_0x31b9e0,'preferredGatewayIp':_0x406aa7,'postureCheckResults':{'results':[]}};let _0x218cd5=await callZteApi(_0x4f1969(0x2f8),_0x1f0dc4,_0x4cc8ef,_0x5871b7);if(!_0x218cd5[_0x4f1969(0x336)])throw new ErrorWithoutStacktrace(_0x4f1969(0x2a1)+_0x218cd5[_0x4f1969(0x2a2)]);_0x218cd5[_0x4f1969(0x287)]&&await connectorPreConnectConfigNewApi(_0x218cd5,_0x5871b7,_0x4cc8ef);let _0x245442='';_0x218cd5[_0x4f1969(0x2d7)][_0x4f1969(0x261)]&&(_0x245442=_0x4f1969(0x34a)+_0x218cd5[_0x4f1969(0x2d7)][_0x4f1969(0x261)]['join'](',\x20')+'\x0a');let _0x5aff78=null,_0x4972f0=null;try{_0x5aff78=(await exec(_0x4f1969(0x323)))?.[_0x4f1969(0x1fc)]?.[_0x4f1969(0x218)]()[_0x4f1969(0x233)](/'/g,''),_0x4972f0=(await exec('gsettings\x20get\x20org.gnome.system.proxy\x20autoconfig-url'))?.[_0x4f1969(0x1fc)]?.[_0x4f1969(0x218)]()['replace'](/'/g,''),(_0x4972f0[_0x4f1969(0x245)](/10\.201\.201\.201|10\.10\.201\.1|zerotrustedge/i)||_0x218cd5[_0x4f1969(0x2b9)][_0x4f1969(0x2b6)]&&_0x218cd5[_0x4f1969(0x2b9)][_0x4f1969(0x2b6)]===_0x4972f0)&&(_0x5aff78=_0x4f1969(0x2fc),_0x4972f0='');}catch{}let _0xc48806=_0x218cd5[_0x4f1969(0x2d7)]['allowedIPs'];if(_0xc48806[_0x4f1969(0x1dd)]===0x1&&_0xc48806[0x0]===_0x4f1969(0x213)||_0xc48806[_0x4f1969(0x1dd)]===0x2&&(_0xc48806[0x0]===_0x4f1969(0x213)&&_0xc48806[0x1]===_0x4f1969(0x345))){}else{if(_0x218cd5['tunnel'][_0x4f1969(0x2cf)]){let _0x12a745=new URL(_0x218cd5[_0x4f1969(0x23f)]),_0x3eb5d6=_0x12a745[_0x4f1969(0x234)];!a0_0x5de313['contains'](_0xc48806,_0x3eb5d6)&&_0xc48806[_0x4f1969(0x1e9)](_0x3eb5d6+_0x4f1969(0x2de));let _0xf4fafe=_0x218cd5['tunnel'][_0x4f1969(0x2f5)]['replace'](/:.*/,'');a0_0x5de313[_0x4f1969(0x216)](_0xc48806,_0xf4fafe)&&(_0xc48806=a0_0x2f99f5[_0x4f1969(0x26d)](['!'+_0xf4fafe+_0x4f1969(0x2de),..._0xc48806]));}}let _0x32e93c={'gatewayServicesUrl':_0x218cd5[_0x4f1969(0x23f)],'defaultInterface':_0x218cd5['defaultInterface'],'userName':_0x524e38[_0x4f1969(0x325)],'tenant':_0x524e38[_0x4f1969(0x20b)],'setPacFile':Boolean(_0x218cd5['proxySettings'][_0x4f1969(0x2b6)]),'connector':Boolean(_0x218cd5[_0x4f1969(0x287)]),'monitorPid':_0x5871b7[_0x4f1969(0x270)]?process[_0x4f1969(0x264)]:null},_0x1b51d4={'oldMode':_0x5aff78,'oldProxyPac':_0x4972f0},_0x44259a=_0x4f1969(0x2d5)+('PrivateKey\x20=\x20'+_0x524e38[_0x4f1969(0x30b)]+'\x0a')+(_0x4f1969(0x353)+_0x218cd5[_0x4f1969(0x2d7)]['assignedIpAddress']+'\x0a')+_0x245442+'[Peer]\x0a'+(_0x4f1969(0x1f0)+_0x218cd5[_0x4f1969(0x2d7)][_0x4f1969(0x1f6)]+'\x0a')+(_0x4f1969(0x268)+_0x218cd5[_0x4f1969(0x2d7)][_0x4f1969(0x2f5)]+'\x0a')+_0x4f1969(0x2ce)+('AllowedIps\x20=\x20'+_0xc48806[_0x4f1969(0x1f1)](',\x20')+'\x0a')+(_0x4f1969(0x210)+JSON[_0x4f1969(0x2a4)](_0x4cc8ef)+'\x0a')+('#\x20deviceInfo\x20=\x20'+JSON[_0x4f1969(0x2a4)](_0x32e93c)+'\x0a')+('#\x20restorePac\x20=\x20'+JSON[_0x4f1969(0x2a4)](_0x1b51d4)+'\x0a');await a0_0x39e7c3['writeFile'](runningConfigFile,_0x44259a,{'encoding':'utf8','mode':parseInt(_0x4f1969(0x223),0x8)});if(!_0x5871b7[_0x4f1969(0x25d)])return;let _0x25e0b3=await execNoThrow(_0x4f1969(0x312)+runningConfigFile);if(_0x25e0b3[_0x4f1969(0x1ea)]!==0x0||!tunnelActive()){if(_0x25e0b3['stderr']['includes'](_0x4f1969(0x2f7)))throw new ErrorWithoutStacktrace(_0x4f1969(0x283));else throw new ErrorWithoutStacktrace(_0x4f1969(0x324)+_0x25e0b3['stderr'][_0x4f1969(0x218)]());}else{verboseLog(_0x5871b7,_0x4f1969(0x232)),verboseLog(_0x5871b7,_0x25e0b3);if(_0x218cd5['proxySettings'][_0x4f1969(0x2b6)])try{await setPacFile(_0x4f1969(0x2b0),_0x218cd5['proxySettings'][_0x4f1969(0x2b6)]),console['log']('PAC\x20file\x20set:\x20'+_0x218cd5[_0x4f1969(0x2b9)][_0x4f1969(0x2b6)]);}catch(_0x2bd20e){console[_0x4f1969(0x281)]('Unable\x20to\x20set\x20PAC\x20file:\x20'+_0x2bd20e[_0x4f1969(0x305)]);}console['log']('Waiting\x20for\x20tunnel\x20to\x20come\x20online\x20...\x20');let _0x87bfa3=_0x218cd5[_0x4f1969(0x2d7)][_0x4f1969(0x1f6)][_0x4f1969(0x233)](/[-[\]{}()*+?.,\\^$|#\s]/g,_0x4f1969(0x29c)),_0x3bf95e=new RegExp('^'+_0x87bfa3+_0x4f1969(0x1ca),'m'),_0x388c8b=await a0_0x2f99f5['waitFor'](async()=>{const _0x6098f4=_0x4f1969;if(shutdownInProgress)return![];let _0x39a9be=await execNoThrow(_0x6098f4(0x26e)),_0x565109=(_0x39a9be[_0x6098f4(0x1fc)]??'')[_0x6098f4(0x245)](_0x3bf95e),_0xd5d727=_0x565109?_0x565109[0x4]:_0x6098f4(0x2d2),_0x14dcc9=_0x565109&&_0x565109[0x4]!=='0';return debugLog(_0x5871b7,_0x6098f4(0x26a)+_0xd5d727+'\x20=>\x20'+_0x14dcc9),_0x14dcc9;},{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0x388c8b){try{await stopTunnel(_0x5871b7);}catch{}throw new ErrorWithoutStacktrace('Tunnel\x20not\x20functioning\x20properly.\x20No\x20handshake.\x20\x20Perhaps\x20a\x20connectivity\x20problem\x20to\x20the\x20POP');}let _0x2afa0d=await a0_0x2f99f5[_0x4f1969(0x299)](async()=>shutdownInProgress||await getGatewayServices(_0x4f1969(0x2f2),_0x32e93c,_0x4cc8ef,_0x5871b7,{'throwIfError':![]}),{'timeoutSec':0x3c,'delayMs':0x3e8});if(shutdownInProgress)return;if(!_0x2afa0d){try{await stopTunnel(_0x5871b7);}catch{}throw new ErrorWithoutStacktrace('Tunnel\x20not\x20functioning\x20properly');}return _0x218cd5['connector']?(await connectorPostConnectConfigNewApi(_0x218cd5,_0x5871b7,_0x4cc8ef),console[_0x4f1969(0x281)](_0x4f1969(0x1f8))):console[_0x4f1969(0x281)](_0x4f1969(0x20f)),{'clientSettings':_0x2afa0d,'deviceInfo':_0x32e93c};}}function a0_0x2d17(_0x5b4e1e,_0x47e4c1){const _0x3f626d=a0_0x3f62();return a0_0x2d17=function(_0x2d1797,_0x13267b){_0x2d1797=_0x2d1797-0x1c5;let _0x9b460d=_0x3f626d[_0x2d1797];return _0x9b460d;},a0_0x2d17(_0x5b4e1e,_0x47e4c1);}async function postGatewayServices(_0x3ef3ec,_0x329b45,_0xff5a7,_0x328af7,_0x58a1b9,{throwIfError:throwIfError=!![]}={}){const _0x542251=a0_0x5a6806;try{let _0x4206b4=_0xff5a7[_0x542251(0x23f)]+'/'+_0x3ef3ec;debugLog(_0x58a1b9,'----\x20POST\x20'+_0x4206b4+'\x20----'),debugLog(_0x58a1b9,_0x329b45);let _0x4713b7=await a0_0x35baa7[_0x542251(0x34e)](_0x4206b4,{'json':_0x329b45,'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':'json','timeout':{'request':0x5*0x3e8}});return debugLog(_0x58a1b9,_0x4713b7[_0x542251(0x28f)]),debugLog(_0x58a1b9,_0x542251(0x235)),_0x4713b7['body'];}catch(_0x3da7b9){debugLog(_0x58a1b9,'Error:\x20'+_0x3da7b9[_0x542251(0x305)]),debugLog(_0x58a1b9,_0x542251(0x235));if(throwIfError)throw new ErrorWithoutStacktrace(_0x3ef3ec+'\x20failed:\x20'+_0x3da7b9[_0x542251(0x305)]);}}async function getGatewayServices(_0x57eb6d,_0x17ee2a,_0x180637,_0xf92765,{throwIfError:throwIfError=!![]}={}){const _0x4e132b=a0_0x5a6806;try{let _0x456ab1=_0x17ee2a[_0x4e132b(0x23f)]+'/'+_0x57eb6d;debugLog(_0xf92765,'----\x20GET\x20'+_0x456ab1+_0x4e132b(0x286));let _0x5e8627=await a0_0x35baa7(_0x456ab1,{'throwHttpErrors':!![],'retry':{'limit':0x0},'responseType':_0x4e132b(0x1cb),'timeout':{'request':0x5*0x3e8}});return debugLog(_0xf92765,_0x5e8627[_0x4e132b(0x28f)]),debugLog(_0xf92765,_0x4e132b(0x235)),_0x5e8627[_0x4e132b(0x28f)];}catch(_0x3eae19){debugLog(_0xf92765,_0x4e132b(0x1f3)+_0x3eae19['message']),debugLog(_0xf92765,_0x4e132b(0x235));if(throwIfError)throw new ErrorWithoutStacktrace(_0x57eb6d+_0x4e132b(0x25b)+_0x3eae19[_0x4e132b(0x305)]);}}function devNameToFileName(_0x343503,_0x3c6bc9,_0x377225){const _0x48d20a=a0_0x5a6806;_0x3c6bc9=_0x3c6bc9[_0x48d20a(0x233)](/[/\\]/g,'');let _0x159885=a0_0x42919a[_0x48d20a(0x1f1)](deviceFolder,''+_0x343503+sep+_0x3c6bc9+sep+_0x377225+_0x48d20a(0x33d));return _0x159885;}async function saveProfile(_0x5b8136,_0x74699a,_0x4e292e){const _0x3b5e25=a0_0x5a6806;!await fileExists(deviceFolder)&&(await a0_0x39e7c3['mkdir'](deviceFolder),console['log']('Created\x20'+deviceFolder));let _0x70ab85=devNameToFileName(_0x5b8136,_0x74699a[_0x3b5e25(0x1cf)],_0x4e292e),_0x527ef7={'version':CLIENT_VERSION,'privateKey':_0x74699a[_0x3b5e25(0x1ff)],'tenant':_0x5b8136,'isConnector':_0x74699a['isConnector'],'user':_0x74699a['userName'],'userId':_0x74699a[_0x3b5e25(0x1d0)],'deviceName':_0x4e292e};return await a0_0x39e7c3[_0x3b5e25(0x2bf)](_0x70ab85,JSON[_0x3b5e25(0x2a4)](_0x527ef7,null,0x2)+'\x0a',{'encoding':'utf8','mode':parseInt(_0x3b5e25(0x223),0x8)}),_0x70ab85;}async function readProfile(_0x542c83){const _0x1011e6=a0_0x5a6806;let _0x47b9de=await a0_0x39e7c3[_0x1011e6(0x354)](_0x542c83,_0x1011e6(0x32c)),_0x32ae69=JSON[_0x1011e6(0x21f)](_0x47b9de);return _0x32ae69[_0x1011e6(0x252)]=await getPublicKey(_0x32ae69[_0x1011e6(0x30b)]),_0x32ae69;}async function getCurrentConnectionInfo(){const _0x37c572=a0_0x5a6806;let _0x148455=await a0_0x39e7c3[_0x37c572(0x354)](runningConfigFile,_0x37c572(0x32c)),_0x33088d={'privateKey':_0x148455['match'](/PrivateKey = (.*)/)?.[0x1],'ip':_0x148455[_0x37c572(0x245)](/Address = (.*)/)?.[0x1],'systemInfo':JSON['parse'](_0x148455[_0x37c572(0x245)](/systemInfo = (.*)/)?.[0x1]),'deviceInfo':JSON[_0x37c572(0x21f)](_0x148455['match'](/deviceInfo = (.*)/)?.[0x1]),'restorePac':JSON[_0x37c572(0x21f)](_0x148455[_0x37c572(0x245)](/restorePac = (.*)/)?.[0x1])};return _0x33088d['publicKey']=await getPublicKey(_0x33088d[_0x37c572(0x30b)]),_0x33088d;}async function execNoThrow(_0x96b9a4){const _0x52c647=a0_0x5a6806;try{let _0xb797b5=await exec(_0x96b9a4);return _0xb797b5[_0x52c647(0x1ea)]=0x0,_0xb797b5;}catch(_0x78ca72){return{'code':_0x78ca72[_0x52c647(0x1ea)]??-0x1,'stderr':_0x78ca72[_0x52c647(0x220)]??'','stdout':_0x78ca72['stdout']??''};}}async function fileExists(_0x4e3266){const _0x5b663c=a0_0x5a6806;try{return await a0_0x39e7c3[_0x5b663c(0x282)](_0x4e3266),!![];}catch{return![];}}function isString(_0xa415e6){return typeof _0xa415e6==='string';}function doLog(_0x2e1b71){const _0x3aa89d=a0_0x5a6806;if(_0x2e1b71['stdout']||_0x2e1b71[_0x3aa89d(0x220)]){let _0x23c8a3=_0x2e1b71[_0x3aa89d(0x1fc)]?.[_0x3aa89d(0x218)]();_0x23c8a3&&console['log'](_0x23c8a3);let _0x23d92c=_0x2e1b71[_0x3aa89d(0x220)]?.['trim']();_0x23d92c&&console[_0x3aa89d(0x281)](_0x23d92c);}else isString(_0x2e1b71)?console[_0x3aa89d(0x281)](_0x2e1b71):console[_0x3aa89d(0x281)](JSON['stringify'](_0x2e1b71,null,0x2));}function debugLog(_0x320c1a,_0x192fd8){const _0x58babc=a0_0x5a6806;_0x320c1a?.[_0x58babc(0x22c)]&&doLog(_0x192fd8);}function verboseLog(_0x13c6c2,_0x32177c){const _0x1b0e2b=a0_0x5a6806;(_0x13c6c2?.[_0x1b0e2b(0x2ba)]||_0x13c6c2?.[_0x1b0e2b(0x22c)])&&doLog(_0x32177c);}async function stopTunnel(_0x283919){const _0x3c683b=a0_0x5a6806;let _0x12fc70;if(!tunnelActive()){await execNoThrow(_0x3c683b(0x288));return;}else{if(!await fileExists(runningConfigFile))console[_0x3c683b(0x281)](_0x3c683b(0x33a)),await execNoThrow(_0x3c683b(0x288)),_0x12fc70=await execNoThrow(_0x3c683b(0x2e0)+TUNNEL_INTERFACE_NAME);else{let _0x1347be=await getCurrentConnectionInfo();if(_0x1347be[_0x3c683b(0x303)][_0x3c683b(0x31e)]&&_0x1347be[_0x3c683b(0x303)]['monitorPid']!==process[_0x3c683b(0x264)]){console[_0x3c683b(0x281)](_0x3c683b(0x2c0)+_0x1347be[_0x3c683b(0x303)][_0x3c683b(0x31e)]+'\x20to\x20shutdown');try{process[_0x3c683b(0x23c)](_0x1347be[_0x3c683b(0x303)]['monitorPid'],_0x3c683b(0x244));return;}catch(_0x372cf7){console[_0x3c683b(0x281)](_0x3c683b(0x31b));}}try{let _0x14059a=await a0_0x35baa7[_0x3c683b(0x34e)](_0x1347be[_0x3c683b(0x303)][_0x3c683b(0x23f)]+'/clientLogout',{'json':{'key':_0x1347be[_0x3c683b(0x252)]},'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':_0x3c683b(0x1cb),'timeout':{'request':0x5*0x3e8}});_0x14059a['statusCode']!==0xc8&&console[_0x3c683b(0x281)](_0x3c683b(0x351)+_0x14059a[_0x3c683b(0x28f)]);}catch(_0x2bfa5c){console[_0x3c683b(0x281)](_0x3c683b(0x351)+_0x2bfa5c[_0x3c683b(0x305)]);}_0x12fc70=await execNoThrow(_0x3c683b(0x271)+runningConfigFile),await a0_0x39e7c3[_0x3c683b(0x2e6)](runningConfigFile);if(_0x1347be['deviceInfo'][_0x3c683b(0x287)]){console[_0x3c683b(0x281)](_0x3c683b(0x328));let _0x646aae=await execNoThrow(_0x3c683b(0x267)+_0x1347be[_0x3c683b(0x303)][_0x3c683b(0x2c8)]+'\x20-j\x20MASQUERADE');}if(_0x1347be[_0x3c683b(0x303)]['setPacFile'])try{await setPacFile(_0x1347be[_0x3c683b(0x2ad)][_0x3c683b(0x24a)],_0x1347be['restorePac']['oldProxyPac']);if(_0x1347be[_0x3c683b(0x2ad)][_0x3c683b(0x24a)]==='none')console[_0x3c683b(0x281)](_0x3c683b(0x2b4));else _0x1347be[_0x3c683b(0x2ad)][_0x3c683b(0x24a)]===_0x3c683b(0x2b0)?console[_0x3c683b(0x281)]('Proxy\x20restored\x20to\x20'+_0x1347be[_0x3c683b(0x2ad)][_0x3c683b(0x30a)]):console[_0x3c683b(0x281)](_0x3c683b(0x339)+_0x1347be[_0x3c683b(0x2ad)][_0x3c683b(0x24a)]);}catch(_0x1b935c){console[_0x3c683b(0x281)]('Unable\x20to\x20restore\x20system\x20proxy:\x20'+_0x1b935c[_0x3c683b(0x305)]);}}}if(_0x12fc70[_0x3c683b(0x1ea)]!==0x0||tunnelActive())throw new ErrorWithoutStacktrace(_0x3c683b(0x1c9)+_0x12fc70[_0x3c683b(0x220)][_0x3c683b(0x218)]());else verboseLog(_0x283919,_0x12fc70);}async function initiateShutdown(_0x12be76){const _0x3c080d=a0_0x5a6806;try{console[_0x3c080d(0x281)](),++shutdownInProgress;if(shutdownInProgress===0x2){console['log'](_0x3c080d(0x309));return;}else shutdownInProgress===0x3&&(console[_0x3c080d(0x281)]('Aborting\x20ztedge-client'),process['exit'](0x1));!tunnelActive()?console['log'](_0x3c080d(0x2b5)):(console[_0x3c080d(0x281)]('Stopping\x20tunnel'),await stopTunnel(_0x12be76)),console[_0x3c080d(0x281)](_0x3c080d(0x20c)),process[_0x3c080d(0x272)](0x0);}catch(_0xf0a3b7){console[_0x3c080d(0x281)](_0xf0a3b7),console[_0x3c080d(0x281)](_0x3c080d(0x20c)),process[_0x3c080d(0x272)](0x0);}}async function doPing(_0x3cc4cb){const _0x4aa9a9=a0_0x5a6806;let _0x5ebf1a=![];try{let _0x3ff702=await a0_0x35baa7(_0x3cc4cb[_0x4aa9a9(0x303)][_0x4aa9a9(0x23f)]+_0x4aa9a9(0x28a),{'throwHttpErrors':![],'retry':{'limit':0x0},'responseType':'json','timeout':{'request':0x5*0x3e8}});_0x5ebf1a=_0x3ff702?.[_0x4aa9a9(0x2c2)]===0xc8;}catch(_0x505294){console[_0x4aa9a9(0x281)]('Ping\x20failure:\x20'+_0x505294[_0x4aa9a9(0x305)]);}return _0x5ebf1a;}async function connectorPreConnectConfigNewApi(_0x557e41,_0x44d18a,_0x36b2c1){const _0x2ead48=a0_0x5a6806;let _0x28625e=await exec('ip\x20route\x20show\x20default'),_0xfa4b80=_0x28625e[_0x2ead48(0x1fc)][_0x2ead48(0x245)](/ dev (\w+) /)?.[0x1];if(!_0xfa4b80)throw new Error('cannot\x20determine\x20default\x20device');_0x557e41[_0x2ead48(0x2c8)]=_0xfa4b80;}async function connectorPostConnectConfigNewApi(_0x3ee9ba,_0x12b36e,_0x210e01){const _0x568eaa=a0_0x5a6806;console[_0x568eaa(0x281)](_0x568eaa(0x315)+_0x3ee9ba['defaultInterface']),console[_0x568eaa(0x281)]('Enable\x20routing');try{await exec(_0x568eaa(0x1f2)+_0x3ee9ba[_0x568eaa(0x2c8)]+_0x568eaa(0x21b)),await exec(_0x568eaa(0x266));}catch(_0x326ddf){console['log'](_0x568eaa(0x27b)+_0x326ddf['message']);}}function tunnelActive(){const _0x4cef36=a0_0x5a6806;let _0x1b87f3=a0_0x58da01[_0x4cef36(0x2cc)]();return Boolean(_0x1b87f3[TUNNEL_INTERFACE_NAME]);}async function findMatchingProfile(_0x6f7125,_0x270a90,_0x5ed331){const _0x477d1b=a0_0x5a6806;let _0x14a995;if(_0x6f7125&&_0x270a90&&_0x5ed331){let _0x3b418a=devNameToFileName(_0x6f7125,_0x270a90,_0x5ed331);if(!await fileExists(_0x3b418a))throw new ErrorWithoutStacktrace('Profile\x20does\x20not\x20exist');_0x14a995=await readProfile(devNameToFileName(_0x6f7125,_0x270a90,_0x5ed331));}else{let _0x54894d=await fileExists(deviceFolder)&&await a0_0x39e7c3['readdir'](deviceFolder);if(!_0x54894d)throw new ErrorWithoutStacktrace(_0x477d1b(0x2f4));let _0xa31667;_0x6f7125&&!_0x270a90?_0xa31667=_0x6f7125+sep+'.*'+(_0x5ed331??'.*'):_0xa31667=(_0x6f7125??'.*')+sep+(_0x270a90??'.*')+sep+(_0x5ed331??'.*');let _0x43d1d9=_0x54894d[_0x477d1b(0x2e9)](_0x54d090=>_0x54d090[_0x477d1b(0x245)](_0xa31667));if(_0x43d1d9[_0x477d1b(0x1dd)]===0x0)throw new ErrorWithoutStacktrace(_0x477d1b(0x2f4));else{if(_0x43d1d9[_0x477d1b(0x1dd)]===0x1){let _0x1be8d5=_0x43d1d9[0x0][_0x477d1b(0x245)](_0x477d1b(0x30f)+sep+_0x477d1b(0x22a)+sep+_0x477d1b(0x2db)),_0x52d917=a0_0x42919a[_0x477d1b(0x1f1)](deviceFolder,_0x43d1d9[0x0]);_0x14a995=await readProfile(_0x52d917),console[_0x477d1b(0x281)]('Using\x20profile:\x20'+_0x14a995['tenant']+'\x20'+_0x14a995[_0x477d1b(0x325)]);}else throw new ErrorWithoutStacktrace(_0x477d1b(0x297));}}return _0x14a995;}async function getPublicKey(_0x39669e){const _0x406abd=a0_0x5a6806,_0x532b84=a0_0x41ff0b[_0x406abd(0x329)]('wg',['pubkey'],{'input':_0x39669e+'\x0a'});if(_0x532b84[_0x406abd(0x1f7)]!==0x0)throw new ErrorWithoutStacktrace(_0x406abd(0x2e1));return _0x532b84['stdout']['toString']()[_0x406abd(0x218)]();}async function setupShieldCertificate(_0x251920){const _0x13d876=a0_0x5a6806;_0x251920['caCertificates']&&a0_0x389de6[_0x13d876(0x2e5)](_0x251920['caCertificates'][_0x13d876(0x284)](','));for(let _0x4b4966 of SHIELD_CA_CERTIFICATES){await fileExists(_0x4b4966)?a0_0x389de6[_0x13d876(0x2e5)](_0x4b4966):console[_0x13d876(0x281)](_0x13d876(0x1e5)+_0x4b4966+_0x13d876(0x2c4));}}function myParseInt(_0x272b66,_0x484c1f){return parseInt(_0x272b66);}function myParseString(_0x369fd0,_0x34f279){return _0x369fd0;}function addConnectOptions(_0x577596,_0x1cad29){const _0xc53131=a0_0x5a6806;let _0xad3d34=_0x577596['commands']['find'](_0xfa7910=>_0xfa7910[_0xc53131(0x204)]===_0x1cad29);_0xad3d34[_0xc53131(0x2a5)](_0xc53131(0x301),_0xc53131(0x21c),null)[_0xc53131(0x2a5)](_0xc53131(0x228),_0xc53131(0x285),![])['option'](_0xc53131(0x27c),_0xc53131(0x269),![])['option'](_0xc53131(0x24c),'Do\x20everything\x20except\x20for\x20launching\x20the\x20tunnel',!![])[_0xc53131(0x2a5)]('--no-monitor','do\x20not\x20monitor\x20the\x20connection.\x20\x20When\x20monitored,\x20exit\x20with\x20SIGTERM\x20or\x20SIGINT\x20or\x20\x22ztedge-client\x20down\x22')[_0xc53131(0x2a5)](_0xc53131(0x224),'How\x20often\x20to\x20ping\x20the\x20gateway',myParseInt,0xf)[_0xc53131(0x2a5)](_0xc53131(0x320),_0xc53131(0x277),myParseInt,0x3c)[_0xc53131(0x2a5)]('--upgrade',_0xc53131(0x255),![])['option']('--device-name\x20<name>','device\x20name',myParseString,a0_0x58da01[_0xc53131(0x234)]()),addCommonOptions(_0x577596,_0x1cad29);}function addCommonOptions(_0x318fc1,_0x4a3c0c){const _0x38bf57=a0_0x5a6806;let _0x438d59=_0x318fc1['commands'][_0x38bf57(0x27f)](_0x399e25=>_0x399e25[_0x38bf57(0x204)]===_0x4a3c0c);_0x438d59[_0x38bf57(0x2a5)](_0x38bf57(0x34d),_0x38bf57(0x1d6),![])[_0x38bf57(0x2a5)](_0x38bf57(0x1fb),_0x38bf57(0x1df),DEFAULT_CA_FOLDER)[_0x38bf57(0x2a5)](_0x38bf57(0x2f0),_0x38bf57(0x27a),![])[_0x38bf57(0x2a5)]('-d|--debug',_0x38bf57(0x2c6),![]);}function execError(_0x1985a3){const _0x4d6176=a0_0x5a6806;let _0x5e07b7=_0x1985a3[_0x4d6176(0x1fc)][_0x4d6176(0x218)](),_0x23a9cc=_0x1985a3[_0x4d6176(0x220)][_0x4d6176(0x218)]();if(!_0x5e07b7)return _0x23a9cc;else return!_0x23a9cc?_0x5e07b7:_0x5e07b7+'\x0a'+_0x23a9cc;}async function launchFromToken(_0x486f28,_0x3c08b7,_0x17c16f,_0x5e9ce6){const _0x2299a0=a0_0x5a6806;let _0x384046='';_0x5e9ce6['debug']&&(_0x384046+='\x20--debug');_0x5e9ce6[_0x2299a0(0x253)]&&(_0x384046+=_0x2299a0(0x29d)+_0x5e9ce6[_0x2299a0(0x253)]);let _0x5552c2=_0x2299a0(0x24b);await fileExists(_0x5552c2)&&await a0_0x39e7c3['unlink'](_0x5552c2);let _0x340bb1=_0x2299a0(0x335)+_0x486f28+_0x2299a0(0x1ce)+_0x3c08b7+_0x2299a0(0x1ce)+_0x17c16f+'\x22\x20'+_0x384046+'\x20>\x20'+_0x5552c2;execNoThrow(_0x340bb1),console['log'](_0x2299a0(0x26c)+_0x5552c2),process[_0x2299a0(0x1fc)][_0x2299a0(0x205)]('Waiting\x20for\x20tunnel\x20to\x20start\x20...');for(;;){if(!tunnelActive())process[_0x2299a0(0x1fc)]['write']('.');else{let _0xe893d2=await getCurrentConnectionInfo(),_0x2b9d2f=await doPing(_0xe893d2);if(_0x2b9d2f){console[_0x2299a0(0x281)](),console['log'](_0x2299a0(0x2eb)+_0xe893d2['ip']),console[_0x2299a0(0x281)]('Connected\x20to:\x20'+_0xe893d2[_0x2299a0(0x303)][_0x2299a0(0x20b)]),console[_0x2299a0(0x281)](_0x2299a0(0x1f5)+_0xe893d2[_0x2299a0(0x303)]['userName']),console[_0x2299a0(0x281)](_0x2299a0(0x2d9));break;}else process[_0x2299a0(0x1fc)][_0x2299a0(0x205)]('.');}await a0_0x2f99f5[_0x2299a0(0x34c)](0x3e8);}}async function main(){const _0x349538=a0_0x5a6806;try{const _0x26a700=new a0_0x23e9c3['Command']();_0x26a700['description'](_0x349538(0x2d1))[_0x349538(0x347)](![])[_0x349538(0x28c)](CLIENT_VERSION),_0x26a700[_0x349538(0x1c6)](_0x349538(0x2fd))[_0x349538(0x1d2)](_0x349538(0x308)+_0x349538(0x352)+_0x349538(0x265))[_0x349538(0x2a5)]('-f|--force',_0x349538(0x1e3),![])[_0x349538(0x2a5)](_0x349538(0x2e8),'To\x20be\x20used\x20as\x20a\x20cloud-native\x20connector',![])[_0x349538(0x2a5)](_0x349538(0x2fa),'Run\x20connection\x20in\x20the\x20background')[_0x349538(0x2bb)](async function(_0x39e309,_0x2cfee2,_0x5a88ec){const _0x4ea2ee=_0x349538;await setupShieldCertificate(_0x5a88ec);if(tunnelActive())throw new ErrorWithoutStacktrace(_0x4ea2ee(0x2c5));_0x2cfee2=_0x2cfee2?.['trim']();let _0x5e4ec3=_0x5a88ec['password']?.[_0x4ea2ee(0x218)](),_0x3cf37a=_0x5a88ec[_0x4ea2ee(0x253)],_0x2ab5b9=devNameToFileName(_0x39e309,_0x2cfee2,_0x3cf37a);if(!_0x5a88ec[_0x4ea2ee(0x2a3)]&&await fileExists(_0x2ab5b9))throw new ErrorWithoutStacktrace(_0x2ab5b9+_0x4ea2ee(0x1d1));let _0xf849ad=await getSystemInfo(_0x39e309,_0x5a88ec),_0x3b7aff=await newApiCreateDevice(_0xf849ad,_0x3cf37a,_0x2cfee2,_0x5e4ec3,_0x5a88ec),_0x547f27={'devicePrivateKey':_0x3b7aff[_0x4ea2ee(0x344)][_0x4ea2ee(0x304)],'isConnector':_0x5a88ec['connector'],'userName':_0x3b7aff[_0x4ea2ee(0x1e8)][_0x4ea2ee(0x1cf)],'userId':_0x3b7aff[_0x4ea2ee(0x1e8)][_0x4ea2ee(0x1d0)]},_0x5f2565=await saveProfile(_0x39e309,_0x547f27,_0x3cf37a);console[_0x4ea2ee(0x281)](_0x4ea2ee(0x1d5)+_0x5f2565);if(_0x5a88ec[_0x4ea2ee(0x250)])await launchFromToken(_0x39e309,_0x2cfee2,_0x3b7aff[_0x4ea2ee(0x1e8)][_0x4ea2ee(0x2ed)],_0x5a88ec);else{if(!_0x5a88ec[_0x4ea2ee(0x2f6)]){let _0x3b83a1=await readProfile(_0x5f2565);await newApiLaunchTunnel(_0x3b7aff[_0x4ea2ee(0x1e8)][_0x4ea2ee(0x2ed)],_0xf849ad,_0x3b83a1,_0x5a88ec);}else console[_0x4ea2ee(0x281)](_0x4ea2ee(0x260));}}),addConnectOptions(_0x26a700,_0x349538(0x1d7)),_0x26a700[_0x349538(0x1c6)](_0x349538(0x2be))[_0x349538(0x1d2)](_0x349538(0x25f)+'Will\x20match\x20an\x20existing\x20profile\x20based\x20on\x20the\x20supplied\x20<cloudId>\x20and\x20<user>.\x0a'+'You\x20will\x20be\x20prompted\x20for\x20a\x20\x22sudo\x22\x20password\x20as\x20needed.\x20\x20If\x20you\x20launch\x20with\x20\x22sudo\x20ztedge-client\x22,\x20the\x20profiles\x20will\x20be\x0a'+_0x349538(0x265))[_0x349538(0x2a5)](_0x349538(0x341),'Running\x20as\x20a\x20service',![])['option']('-b|--background','Run\x20connection\x20in\x20the\x20background')[_0x349538(0x2bb)](async function(_0x3b867b,_0x39f44b,_0xc9aad4){const _0x3a371c=_0x349538;await setupShieldCertificate(_0xc9aad4);if(tunnelActive())throw new ErrorWithoutStacktrace(_0x3a371c(0x2c5));_0x39f44b=_0x39f44b?.['trim']();let _0x162e8c=_0xc9aad4['password']?.[_0x3a371c(0x218)](),_0x398492=_0xc9aad4[_0x3a371c(0x253)],_0x2a30d2=await findMatchingProfile(_0x3b867b,_0x39f44b,_0x398492),_0x404025=await getSystemInfo(_0x2a30d2[_0x3a371c(0x20b)],_0xc9aad4),_0x489772=await newApiAuthenticateDevice(_0x404025,_0x2a30d2,_0x162e8c,_0xc9aad4);if(_0xc9aad4['background'])await launchFromToken(_0x2a30d2['tenant'],_0x39f44b,_0x489772[_0x3a371c(0x2ed)],_0xc9aad4);else!_0xc9aad4[_0x3a371c(0x2f6)]?await newApiLaunchTunnel(_0x489772[_0x3a371c(0x2ed)],_0x404025,_0x2a30d2,_0xc9aad4):console[_0x3a371c(0x281)](_0x3a371c(0x260));}),addConnectOptions(_0x26a700,'up'),_0x26a700[_0x349538(0x1c6)](_0x349538(0x2fe))[_0x349538(0x1d2)](_0x349538(0x30d)+'Will\x20match\x20an\x20existing\x20profile\x20based\x20on\x20the\x20supplied\x20<cloudId>\x20and\x20<user>.\x0a'+_0x349538(0x33e)+_0x349538(0x265))[_0x349538(0x2bb)](async function(_0x5e5de7,_0x1f10df,_0xde101a,_0x557035){const _0x36999d=_0x349538;await setupShieldCertificate(_0x557035);if(tunnelActive())throw new ErrorWithoutStacktrace(_0x36999d(0x2c5));let _0x470909=_0x557035['deviceName'],_0x49799a=await findMatchingProfile(_0x5e5de7,_0x1f10df,_0x470909);_0x557035[_0x36999d(0x208)]=!![];let _0x5eeb61=await getSystemInfo(_0x49799a[_0x36999d(0x20b)],_0x557035);await newApiLaunchTunnel(_0xde101a,_0x5eeb61,_0x49799a,_0x557035);}),addConnectOptions(_0x26a700,'launchFromToken'),_0x26a700['command'](_0x349538(0x314))[_0x349538(0x1d2)](_0x349538(0x2d8))['action'](async function(_0x285f6a){await setupShieldCertificate(_0x285f6a);if(!tunnelActive())throw new ErrorWithoutStacktrace('ZTEdge\x20tunnel\x20is\x20not\x20currently\x20active');await stopTunnel(_0x285f6a);}),addCommonOptions(_0x26a700,'down'),_0x26a700['command']('import\x20<file>\x20[<user>]')[_0x349538(0x1d2)]('Import\x20a\x20configuration\x20file\x20generated\x20by\x20the\x20provisioning\x20portal.\x20Authentication\x20is\x20done\x20during\x20import.\x0a'+_0x349538(0x23d))['option'](_0x349538(0x301),_0x349538(0x25c),null)['option'](_0x349538(0x228),_0x349538(0x285),![])[_0x349538(0x2bb)](async function(_0x748668,_0xb8e37a,_0x1cfd0f){const _0x362a21=_0x349538;await setupShieldCertificate(_0x1cfd0f);let _0x349cda=await a0_0x39e7c3[_0x362a21(0x354)](_0x748668,_0x362a21(0x32c)),_0x5408b1=_0x349cda[_0x362a21(0x245)](/PrivateKey = (.*)/)[0x1],_0x501fc8=_0x349cda['match'](/host = ([^.]*)/)[0x1],_0x10973e=a0_0x58da01[_0x362a21(0x234)](),_0x441659=await getSystemInfo(_0x501fc8,_0x1cfd0f),_0x51d187={'version':CLIENT_VERSION,'tenant':_0x501fc8,'deviceName':_0x10973e,'publicKey':await getPublicKey(_0x5408b1),'user':_0xb8e37a},_0x52a962=await newApiAuthenticateDevice(_0x441659,_0x51d187,_0x1cfd0f[_0x362a21(0x2af)],_0x1cfd0f);if(!_0x52a962['userName']){if(!_0xb8e37a)throw new ErrorWithoutStacktrace(_0x362a21(0x1eb));_0x52a962[_0x362a21(0x1cf)]=_0xb8e37a;}_0x52a962['devicePrivateKey']=_0x5408b1;let _0x227779=await saveProfile(_0x501fc8,_0x52a962,_0x10973e);console[_0x362a21(0x281)](_0x362a21(0x1d5)+_0x227779);}),addCommonOptions(_0x26a700,_0x349538(0x2e7)),_0x26a700[_0x349538(0x1c6)]('ls')[_0x349538(0x1d2)](_0x349538(0x1c5))[_0x349538(0x2bb)](async function(_0x4c52a8){const _0x4ff1ac=_0x349538;await setupShieldCertificate(_0x4c52a8);let _0x2883e5=await fileExists(deviceFolder)?await a0_0x39e7c3[_0x4ff1ac(0x280)](deviceFolder):[];console[_0x4ff1ac(0x281)](_0x4ff1ac(0x2f3)+deviceFolder),_0x2883e5=_0x2883e5[_0x4ff1ac(0x2e9)](_0xf408a7=>_0xf408a7['endsWith'](_0x4ff1ac(0x33d)));if(_0x2883e5[_0x4ff1ac(0x1dd)]){let _0x6b28ab=await Promise[_0x4ff1ac(0x294)](_0x2883e5[_0x4ff1ac(0x2d0)](_0x3ca866=>readProfile(a0_0x42919a[_0x4ff1ac(0x1f1)](deviceFolder,_0x3ca866)))),_0x586d88=Math[_0x4ff1ac(0x2c1)](..._0x6b28ab['map'](_0x315286=>_0x315286[_0x4ff1ac(0x20b)]['length']));for(let _0x1771e6 of _0x6b28ab){console[_0x4ff1ac(0x281)](_0x1771e6['tenant'][_0x4ff1ac(0x31f)](_0x586d88+0x5,'\x20')+_0x1771e6[_0x4ff1ac(0x325)]);}}else console['log'](_0x4ff1ac(0x254));}),addCommonOptions(_0x26a700,'ls'),_0x26a700[_0x349538(0x1c6)]('status')[_0x349538(0x1d2)]('Show\x20the\x20current\x20tunnel\x20status')['action'](async function(_0x92e40c){const _0x208c3a=_0x349538;await setupShieldCertificate(_0x92e40c);if(!tunnelActive())console['log']('Tunnel\x20is\x20not\x20active');else{let _0x28cf94=await getCurrentConnectionInfo(),_0x108b7a=await doPing(_0x28cf94);console[_0x208c3a(0x281)]('Connected\x20to:\x20'+_0x28cf94[_0x208c3a(0x303)][_0x208c3a(0x20b)]),console[_0x208c3a(0x281)]('Connected\x20as:\x20'+_0x28cf94['deviceInfo']['userName']),console[_0x208c3a(0x281)]('IP:\x20'+_0x28cf94['ip']),_0x108b7a?console[_0x208c3a(0x281)](_0x208c3a(0x2d9)):console[_0x208c3a(0x281)](_0x208c3a(0x2a9)),_0x28cf94[_0x208c3a(0x303)][_0x208c3a(0x31e)]&&console[_0x208c3a(0x281)](_0x208c3a(0x2c7)+_0x28cf94[_0x208c3a(0x303)]['monitorPid']);}}),addCommonOptions(_0x26a700,_0x349538(0x1f7)),_0x26a700[_0x349538(0x1c6)](_0x349538(0x2cb))[_0x349538(0x1d2)](_0x349538(0x2ac)+_0x349538(0x2c9)+_0x349538(0x22f)+_0x349538(0x200))[_0x349538(0x2a5)]('--no-start',_0x349538(0x241))['option'](_0x349538(0x1f9),_0x349538(0x276),myParseString,a0_0x58da01[_0x349538(0x234)]())[_0x349538(0x2bb)](async function(_0x16b13f,_0x407cf1,_0x225d6c){const _0xd0656=_0x349538;if(!await a0_0x504fcb())throw new ErrorWithoutStacktrace('Must\x20be\x20run\x20as\x20sudo');if(tunnelActive())throw new ErrorWithoutStacktrace(_0xd0656(0x2c5));let _0xa299e5=_0x225d6c[_0xd0656(0x253)],_0x2900fb=await findMatchingProfile(_0x16b13f,_0x407cf1,_0xa299e5),_0x5a9a88=_0xd0656(0x29a)+_0x225d6c[_0xd0656(0x2dd)]+'\x22';_0x225d6c[_0xd0656(0x2c3)]&&(_0x5a9a88+=_0xd0656(0x279));_0x225d6c[_0xd0656(0x2ba)]&&(_0x5a9a88+=_0xd0656(0x2e2));_0x225d6c[_0xd0656(0x22c)]&&(_0x5a9a88+=_0xd0656(0x24e));_0x225d6c[_0xd0656(0x253)]&&(_0x5a9a88+=_0xd0656(0x32b)+_0x225d6c[_0xd0656(0x253)]+'\x22');_0x5a9a88+=_0xd0656(0x29f);let _0x260c6d=a0_0x42919a[_0xd0656(0x1f1)](__dirname,'ztedge-client'),_0xc94e0=_0xd0656(0x231)+'Description=ZTEdge\x0a'+'\x0a'+_0xd0656(0x2ec)+'Restart=on-failure\x0a'+_0xd0656(0x21a)+(_0xd0656(0x23a)+_0x260c6d+_0xd0656(0x240)+_0x2900fb[_0xd0656(0x20b)]+_0xd0656(0x1ce)+_0x2900fb[_0xd0656(0x325)]+'\x22\x20'+_0x5a9a88+'\x0a')+'\x0a'+_0xd0656(0x1e1)+_0xd0656(0x1ed);await a0_0x39e7c3['writeFile'](_0xd0656(0x1e7),_0xc94e0,_0xd0656(0x32c));let _0x4a3b57=await execNoThrow('systemctl\x20daemon-reload');if(_0x4a3b57['code'])throw new ErrorWithoutStacktrace(_0xd0656(0x348)+execError(_0x4a3b57));if(_0x225d6c[_0xd0656(0x24f)]){_0x4a3b57=await execNoThrow('systemctl\x20enable\x20ztedge');if(_0x4a3b57[_0xd0656(0x1ea)])throw new ErrorWithoutStacktrace(_0xd0656(0x22d)+execError(_0x4a3b57));_0x4a3b57=await execNoThrow(_0xd0656(0x2e4));if(_0x4a3b57['code'])throw new ErrorWithoutStacktrace(_0xd0656(0x22b)+execError(_0x4a3b57));process['stdout'][_0xd0656(0x205)]('Starting\x20service\x20.');for(let _0x1e5c89=0x0;_0x1e5c89<0x5;++_0x1e5c89){await a0_0x2f99f5[_0xd0656(0x34c)](0x3e8),process[_0xd0656(0x1fc)][_0xd0656(0x205)]('.');}console['log'](),_0x4a3b57=await execNoThrow(_0xd0656(0x2bd)),console[_0xd0656(0x281)](execError(_0x4a3b57)),console[_0xd0656(0x281)](_0xd0656(0x2ef));}else console[_0xd0656(0x281)](_0xd0656(0x342));}),addCommonOptions(_0x26a700,_0x349538(0x2f9)),![]&&process[_0x349538(0x33b)][_0x349538(0x1dd)]===0x2&&__dirname[_0x349538(0x1d9)](_0x349538(0x2fb))&&(console[_0x349538(0x281)]('*****\x20Using\x20hardwired\x20command\x20line\x20*****'),process[_0x349538(0x33b)]=['','',...cmd[_0x349538(0x218)]()[_0x349538(0x284)](/ +/)]),await _0x26a700[_0x349538(0x307)](process['argv']);}catch(_0x51c917){_0x51c917[_0x349538(0x246)]===_0x349538(0x332)?console['log'](_0x51c917[_0x349538(0x305)]):console[_0x349538(0x281)](_0x51c917),process[_0x349538(0x291)]=0x1;}!shutdownInProgress&&process[_0x349538(0x272)]();}main();